'use client'
import { useMemo, useState } from 'react'

import { NativeAddress } from 'src/lib/constants'
import type { UseTradeReturn } from 'src/lib/hooks/react-query'
import { useSimpleSwapTrade } from 'src/ui/swap/simple/derivedstate-simple-swap-provider'
import { type Fill, type Route, Token } from '../../../types'
import { SankeyDiagram } from '../SankeyDiagram'
import { SankeyLegend } from '../SankeyDiagram/SankeyLegend'
import {
  borderOverrideClass,
  headerContainerClass,
  headerTextClass,
  loadingSkeletonWrapper,
  previewContainerClass,
  sankeyContainerClass,
  sankeyLegendClass,
} from './index.css'

function LoadingSkeleton() {
  return (
    <div className={loadingSkeletonWrapper}>
      <svg
        width="361"
        height="115"
        viewBox="0 0 361 115"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <g opacity="0.99">
          <g opacity="0.7">
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M33.4946 0.6203V31.634C104.516 31.634 104.516 31.634 175.538 31.634V0.6203C104.516 0.6203 104.516 0.6203 33.4946 0.6203Z"
              fill="#F5F5F5"
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M44.6596 31.634V50.2423C106.067 50.2423 106.067 55.2045 167.474 55.2045V36.5962C106.067 36.5962 106.067 31.634 44.6596 31.634Z"
              fill="#F5F5F5"
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M44.6596 50.2423V62.6478C106.067 62.6478 106.067 74.433 167.474 74.433V62.0275C106.067 62.0275 106.067 50.2423 44.6596 50.2423Z"
              fill="#F5F5F5"
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M44.6596 62.6478V75.0533C105.447 75.0533 105.447 94.2818 166.233 94.2818V81.8763C105.447 81.8763 105.447 62.6478 44.6596 62.6478Z"
              fill="#F5F5F5"
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M39.0771 75.0533V87.4588C103.276 87.4588 103.276 114.131 167.474 114.131V101.725C103.276 101.725 103.276 75.0533 39.0771 75.0533Z"
              fill="#F5F5F5"
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M190.424 0.620315V31.6341C256.483 31.6341 256.483 31.6341 322.543 31.6341V0.620315C256.483 0.620315 256.483 0.620315 190.424 0.620315Z"
              fill="#F5F5F5"
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M190.424 36.5962V55.2045C254.002 55.2045 254.002 50.2423 317.581 50.2423V31.634C254.002 31.634 254.002 36.5962 190.424 36.5962Z"
              fill="#F5F5F5"
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M190.424 61.4073V73.8128C254.002 73.8128 254.002 62.6478 317.581 62.6478L317.581 50.2423C254.002 50.2423 254.002 61.4073 190.424 61.4073Z"
              fill="#F5F5F5"
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M190.424 81.8763V94.2818C254.002 94.2818 254.002 75.0533 317.581 75.0533V62.6478C254.002 62.6478 254.002 81.8763 190.424 81.8763Z"
              fill="#F5F5F5"
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M190.424 101.725V114.131C254.002 114.131 260.205 86.8385 323.783 86.8385V74.433C260.205 74.433 254.002 101.725 190.424 101.725Z"
              fill="#F5F5F5"
            />
            <path
              d="M286.487 32.1341H286.531H286.784H287.037H287.291H287.547H287.803H288.06H288.317H288.576H288.836H289.096H289.357H289.62H289.883H290.147H290.412H290.677H290.944H291.212H291.481H291.75H292.021H292.292H292.565H292.838H293.113H293.388H293.664H293.942H294.22H294.5H294.78H295.061H295.344H295.627H295.912H296.197H296.484H296.771H297.06H297.35H297.641H297.933H298.226H298.52H298.815H299.111H299.408H299.707H300.006H300.307H300.609H300.912H301.216H301.521H301.828H302.135H302.444H302.754H303.065H303.377H303.691H304.005H304.321H304.638H304.956H305.276H305.596H305.918H306.242H306.566H306.892H307.218H307.547H307.876H308.207H308.539H308.872H309.206H309.542H309.879H310.218H310.557H310.898H311.241H311.585H311.93H312.276H312.624H312.973H313.323H313.675H314.028H314.383H314.739H315.096H315.455H315.815H316.176H316.539H316.904H317.081H286.487ZM286.487 32.1341C273.291 32.6097 263.647 33.3624 254.002 34.1151C238.108 35.3557 222.213 36.5962 190.424 36.5962V55.2045C222.213 55.2045 238.108 53.9639 254.002 52.7234C269.897 51.4828 285.791 50.2423 317.581 50.2423M286.487 32.1341L317.581 49.7423V50.2423M317.581 50.2423C285.791 50.2423 269.897 53.0335 254.002 55.8248C238.108 58.616 222.213 61.4073 190.424 61.4073V73.8128C222.213 73.8128 238.108 71.0215 254.002 68.2303C269.897 65.4391 285.791 62.6478 317.581 62.6478M317.581 50.2423V50.7423L317.581 62.1478V62.6478M317.581 62.6478C285.791 62.6478 269.897 67.4549 254.002 72.2621C238.108 77.0692 222.213 81.8763 190.424 81.8763V94.2818C222.213 94.2818 238.108 89.4747 254.002 84.6675C267.634 80.5448 281.265 76.4221 304.923 75.3317C284.403 77.4021 270.753 82.7406 257.104 88.0791C239.658 94.9021 222.213 101.725 190.424 101.725V114.131C222.213 114.131 239.658 107.308 257.104 100.485C274.549 93.6616 291.994 86.8385 323.783 86.8385V74.433C321.653 74.433 319.587 74.4637 317.581 74.5229V63.1478V62.6478ZM103.084 88.8509C119.077 95.4957 135.113 102.156 166.974 102.225V113.63C135.308 113.561 119.411 106.957 103.476 100.336L103.467 100.333C87.4737 93.6882 71.4379 87.0283 39.5771 86.9593V75.5538C71.2435 75.6226 87.1398 82.2269 103.075 88.8475L103.084 88.8509ZM106.027 34.6135C121.302 35.8479 136.585 37.0827 166.974 37.0961V54.7044C136.624 54.691 121.37 53.4584 106.11 52.2252L106.107 52.225C90.8314 50.9906 75.5487 49.7558 45.1596 49.7424V32.1342C75.5101 32.1475 90.7639 33.3802 106.024 34.6133L106.027 34.6135ZM45.1596 62.1481V50.7426C75.4827 50.7743 90.717 53.6981 105.967 56.6248L105.973 56.626C121.257 59.5594 136.56 62.4954 166.974 62.5273V73.9328C136.651 73.901 121.417 70.9772 106.167 68.0505L106.161 68.0494C90.8761 65.1159 75.574 62.1799 45.1596 62.1481ZM45.1596 74.5537V63.1483C75.1428 63.2006 90.2014 67.9641 105.288 72.7362L105.296 72.7388C120.433 77.5271 135.601 82.3234 165.733 82.3759V93.7814C135.75 93.729 120.692 88.9655 105.605 84.1934L105.597 84.1908C90.4599 79.4024 75.2922 74.6062 45.1596 74.5537ZM44.5326 31.134L44.1596 31.134L44.1588 31.134H43.7835H43.4067H43.0285H42.6488H42.2676H41.885H41.5008H41.1152H40.728H40.3393H39.9492H39.5574H39.1642H38.7694H38.3731H37.9752H37.5758H37.1748H36.7723H36.3682H35.9624H35.5551H35.1463H34.7358H34.3237H33.9946V1.1203H34.3237H34.7358H35.1463H35.5551H35.9624H36.3682H36.7723H37.1748H37.5758H37.9752H38.3731H38.7694H39.1642H39.5574H39.9492H40.3393H40.728H41.1152H41.5008H41.885H42.2676H42.6488H43.0285H43.4067H43.7835H44.1588H44.5326H44.905H45.2759H45.6455H46.0136H46.3802H46.7455H47.1093H47.4717H47.8328H48.1924H48.5507H48.9076H49.2631H49.6172H49.97H50.3215H50.6716H51.0203H51.3677H51.7138H52.0586H52.4021H52.7442H53.085H53.4246H53.7629H54.0998H54.4355H54.77H55.1031H55.4351H55.7657H56.0951H56.4233H56.7503H57.076H57.4005H57.7238H58.0459H58.3667H58.6864H59.0049H59.3222H59.6384H59.9534H60.2672H60.5798H60.8914H61.2017H61.511H61.8191H62.126H62.4319H62.7366H63.0403H63.3428H63.6443H63.9446H64.2439H64.5421H64.8393H65.1354H65.4304H65.7244H66.0173H66.3092H66.6001H66.89H67.1788H67.4667H67.7535H68.0393H68.3242H68.608H68.8909H69.1728H69.4537H69.7337H70.0128H70.2908H70.568H70.8442H71.1195H71.3938H71.6673H71.9398H72.2115H72.4822H72.7521H73.021H73.2891H73.5564H73.8227H74.0882H74.3529H74.6167H74.8797H75.1418H75.4031H75.6636H75.9233H76.1822H76.4403H76.6976H76.954H77.2098H77.4647H77.7189H77.9723H78.2249H78.4768H78.728H78.9784H79.2281H79.4771H79.7253H79.9729H80.2197H80.4659H80.7113H80.9561H81.2002H81.4436H81.6863H81.9284H82.1698H82.4106H82.6507H82.8902H83.1291H83.3674H83.605H83.842H84.0784H84.3143H84.5495H84.7842H85.0182H85.2517H85.4847H85.7171H85.9489H86.1802H86.4109H86.6411H86.8708H87.1H87.3286H87.5567H87.7844H88.0115H88.2382H88.4643H88.69H88.9152H89.14H89.3643H89.5882H89.8116H90.0345H90.2571H90.4792H90.7009H90.9221H91.143H91.3635H91.5836H91.8033H92.0226H92.2415H92.4601H92.6783H92.8961H93.1136H93.3308H93.5476H93.7641H93.9803H94.1961H94.4117H94.6269H94.8418H95.0565H95.2708H95.4849H95.6987H95.9123H96.1255H96.3386H96.5513H96.7639H96.9762H97.1883H97.4001H97.6117H97.8232H98.0344H98.2454H98.4562H98.6669H98.8774H99.0877H99.2978H99.5078H99.7176H99.9273H100.137H100.346H100.556H100.765H100.974H101.183H101.391H101.6H101.809H102.017H102.226H102.434H102.643H102.851H103.059H103.267H103.476H103.684H103.892H104.1H104.308H104.516H104.724H104.932H105.14H105.348H105.557H105.765H105.973H106.181H106.39H106.598H106.806H107.015H107.223H107.432H107.641H107.85H108.059H108.268H108.477H108.686H108.895H109.105H109.315H109.524H109.734H109.945H110.155H110.365H110.576H110.787H110.998H111.209H111.42H111.632H111.844H112.056H112.268H112.481H112.694H112.907H113.12H113.333H113.547H113.761H113.976H114.19H114.405H114.621H114.836H115.052H115.268H115.485H115.701H115.919H116.136H116.354H116.572H116.791H117.01H117.229H117.449H117.669H117.889H118.11H118.331H118.553H118.775H118.998H119.221H119.444H119.668H119.892H120.117H120.342H120.568H120.794H121.021H121.248H121.475H121.704H121.932H122.161H122.391H122.621H122.852H123.083H123.315H123.548H123.78H124.014H124.248H124.483H124.718H124.954H125.19H125.427H125.665H125.903H126.142H126.381H126.622H126.862H127.104H127.346H127.589H127.832H128.076H128.321H128.566H128.812H129.059H129.307H129.555H129.804H130.054H130.304H130.555H130.807H131.06H131.313H131.568H131.822H132.078H132.335H132.592H132.85H133.109H133.369H133.629H133.89H134.153H134.416H134.679H134.944H135.209H135.476H135.743H136.011H136.28H136.55H136.821H137.092H137.365H137.638H137.913H138.188H138.464H138.741H139.019H139.298H139.578H139.859H140.141H140.424H140.708H140.993H141.279H141.566H141.853H142.142H142.432H142.723H143.015H143.308H143.602H143.897H144.193H144.49H144.788H145.088H145.388H145.689H145.992H146.296H146.6H146.906H147.213H147.521H147.83H148.141H148.452H148.765H149.079H149.394H149.71H150.027H150.346H150.665H150.986H151.308H151.632H151.956H152.282H152.609H152.937H153.266H153.597H153.929H154.262H154.597H154.932H155.269H155.608H155.947H156.288H156.63H156.974H157.318H157.664H158.012H158.361H158.711H159.062H159.415H159.769H160.125H160.482H160.84H161.199H161.56H161.923H162.287H162.652H163.019H163.387H163.756H164.127H164.5H164.873H165.249H165.625H166.004H166.383H166.765H167.147H167.531H167.917H168.304H168.693H169.083H169.475H169.868H170.263H170.659H171.057H171.456H171.857H172.26H172.664H173.07H173.477H173.886H174.296H174.709H175.038V31.134H174.709H174.296H173.886H173.477H173.07H172.664H172.26H171.857H171.456H171.057H170.659H170.263H169.868H169.475H169.083H168.693H168.304H167.917H167.531H167.147H166.765H166.383H166.004H165.625H165.249H164.873H164.5H164.127H163.756H163.387H163.019H162.652H162.287H161.923H161.56H161.199H160.84H160.482H160.125H159.769H159.415H159.062H158.711H158.361H158.012H157.664H157.318H156.974H156.63H156.288H155.947H155.608H155.269H154.932H154.597H154.262H153.929H153.597H153.266H152.937H152.609H152.282H151.956H151.632H151.308H150.986H150.665H150.346H150.027H149.71H149.394H149.079H148.765H148.452H148.141H147.83H147.521H147.213H146.906H146.6H146.296H145.992H145.689H145.388H145.088H144.788H144.49H144.193H143.897H143.602H143.308H143.015H142.723H142.432H142.142H141.853H141.566H141.279H140.993H140.708H140.424H140.141H139.859H139.578H139.298H139.019H138.741H138.464H138.188H137.913H137.638H137.365H137.092H136.821H136.55H136.28H136.011H135.743H135.476H135.209H134.944H134.679H134.416H134.153H133.89H133.629H133.369H133.109H132.85H132.592H132.335H132.078H131.822H131.568H131.313H131.06H130.807H130.555H130.304H130.054H129.804H129.555H129.307H129.059H128.812H128.566H128.321H128.076H127.832H127.589H127.346H127.104H126.862H126.622H126.381H126.142H125.903H125.665H125.427H125.19H124.954H124.718H124.483H124.248H124.014H123.78H123.548H123.315H123.083H122.852H122.621H122.391H122.161H121.932H121.704H121.475H121.248H121.021H120.794H120.568H120.342H120.117H119.892H119.668H119.444H119.221H118.998H118.775H118.553H118.331H118.11H117.889H117.669H117.449H117.229H117.01H116.791H116.572H116.354H116.136H115.919H115.701H115.485H115.268H115.052H114.836H114.621H114.405H114.19H113.976H113.761H113.547H113.333H113.12H112.907H112.694H112.481H112.268H112.056H111.844H111.632H111.42H111.209H110.998H110.787H110.576H110.365H110.155H109.945H109.734H109.524H109.315H109.105H108.895H108.686H108.477H108.268H108.059H107.85H107.641H107.432H107.223H107.015H106.806H106.598H106.39H106.181H105.973H105.765H105.557H105.348H105.14H104.932H104.724H104.516H104.308H104.1H103.892H103.684H103.476H103.267H103.059H102.851H102.643H102.434H102.226H102.017H101.809H101.6H101.391H101.183H100.974H100.765H100.556H100.346H100.137H99.9273H99.7176H99.5078H99.2978H99.0877H98.8774H98.6669H98.4562H98.2454H98.0344H97.8232H97.6117H97.4001H97.1883H96.9762H96.7639H96.5513H96.3386H96.1255H95.9123H95.6987H95.4849H95.2708H95.0565H94.8418H94.6269H94.4117H94.1961H93.9803H93.7641H93.5476H93.3308H93.1136H92.8961H92.6783H92.4601H92.2415H92.0226H91.8033H91.5836H91.3635H91.143H90.9221H90.7009H90.4792H90.2571H90.0345H89.8116H89.5882H89.3643H89.14H88.9152H88.69H88.4643H88.2382H88.0115H87.7844H87.5567H87.3286H87.1H86.8708H86.6411H86.4109H86.1802H85.9489H85.7171H85.4847H85.2517H85.0182H84.7842H84.5495H84.3143H84.0784H83.842H83.605H83.3674H83.1291H82.8902H82.6507H82.4106H82.1698H81.9284H81.6863H81.4436H81.2002H80.9561H80.7113H80.4659H80.2197H79.9729H79.7253H79.4771H79.2281H78.9784H78.728H78.4768H78.2249H77.9723H77.7189H77.4647H77.2098H76.954H76.6976H76.4403H76.1822H75.9233H75.6636H75.4031H75.1418H74.8797H74.6167H74.3529H74.0882H73.8227H73.5564H73.2891H73.021H72.7521H72.4822H72.2115H71.9398H71.6673H71.3938H71.1195H70.8442H70.568H70.2908H70.0128H69.7337H69.4537H69.1728H68.8909H68.608H68.3242H68.0393H67.7535H67.4667H67.1788H66.89H66.6001H66.3092H66.0173H65.7244H65.4304H65.1354H64.8393H64.5421H64.2439H63.9446H63.6443H63.3428H63.0403H62.7366H62.4319H62.126H61.8191H61.511H61.2017H60.8914H60.5798H60.2672H59.9534H59.6384H59.3222H59.0049H58.6864H58.3667H58.0459H57.7238H57.4005H57.076H56.7503H56.4233H56.0951H55.7657H55.4351H55.1031H54.77H54.4355H54.0998H53.7629H53.4246H53.085H52.7442H52.4021H52.0586H51.7138H51.3677H51.0203H50.6716H50.3215H49.97H49.6172H49.2631H48.9076H48.5507H48.1924H47.8328H47.4717H47.1093H46.7455H46.3802H46.0136H45.6455H45.2759H44.905L44.6596 31.134L44.5326 31.134ZM190.924 31.1341V1.12031H191.195H191.579H191.96H192.341H192.72H193.097H193.473H193.847H194.22H194.592H194.962H195.33H195.698H196.063H196.428H196.791H197.152H197.512H197.871H198.228H198.584H198.939H199.292H199.644H199.994H200.343H200.691H201.037H201.382H201.726H202.068H202.409H202.749H203.088H203.425H203.761H204.095H204.428H204.76H205.091H205.42H205.748H206.075H206.401H206.725H207.049H207.37H207.691H208.011H208.329H208.646H208.962H209.276H209.59H209.902H210.213H210.523H210.832H211.139H211.446H211.751H212.055H212.358H212.66H212.96H213.26H213.559H213.856H214.152H214.447H214.741H215.034H215.326H215.617H215.907H216.195H216.483H216.77H217.055H217.34H217.623H217.906H218.187H218.467H218.747H219.025H219.302H219.579H219.854H220.129H220.402H220.675H220.946H221.217H221.486H221.755H222.023H222.289H222.555H222.82H223.084H223.347H223.61H223.871H224.131H224.391H224.649H224.907H225.164H225.42H225.675H225.93H226.183H226.436H226.688H226.939H227.189H227.438H227.687H227.935H228.182H228.428H228.673H228.918H229.162H229.405H229.647H229.888H230.129H230.369H230.609H230.847H231.085H231.322H231.559H231.794H232.029H232.264H232.497H232.73H232.962H233.194H233.425H233.655H233.885H234.114H234.342H234.57H234.797H235.023H235.249H235.474H235.698H235.922H236.146H236.369H236.591H236.812H237.033H237.254H237.474H237.693H237.912H238.13H238.348H238.565H238.782H238.998H239.214H239.429H239.643H239.857H240.071H240.284H240.497H240.709H240.921H241.132H241.343H241.553H241.763H241.973H242.182H242.39H242.599H242.806H243.014H243.221H243.427H243.633H243.839H244.045H244.25H244.455H244.659H244.863H245.066H245.27H245.473H245.675H245.878H246.08H246.281H246.483H246.684H246.885H247.085H247.285H247.485H247.685H247.884H248.083H248.282H248.481H248.679H248.877H249.075H249.273H249.47H249.668H249.865H250.061H250.258H250.455H250.651H250.847H251.043H251.239H251.434H251.63H251.825H252.02L190.924 31.1341Z"
              stroke="black"
              strokeOpacity="0.04"
            />
          </g>
        </g>
        <path
          d="M310.137 12.4055C310.137 5.55415 315.691 0 322.543 0H348.594C355.446 0 361 5.55413 361 12.4055V74.433C361 81.2843 355.446 86.8385 348.594 86.8385H322.543C315.691 86.8385 310.137 81.2844 310.137 74.433V12.4055Z"
          fill="#F0F0F0"
        />
        <path
          d="M310.637 12.4055C310.637 5.83029 315.967 0.5 322.543 0.5H348.594C355.169 0.5 360.5 5.83028 360.5 12.4055V74.433C360.5 81.0082 355.169 86.3385 348.594 86.3385H322.543C315.967 86.3385 310.637 81.0082 310.637 74.433V12.4055Z"
          stroke="black"
          strokeOpacity="0.04"
        />
        <path
          d="M0 13.0258C0 6.17445 5.55413 0.6203 12.4055 0.6203H38.457C45.3084 0.6203 50.8625 6.17443 50.8625 13.0258V75.0533C50.8625 81.9046 45.3084 87.4588 38.457 87.4588H12.4055C5.55413 87.4588 0 81.9047 0 75.0533V13.0258Z"
          fill="#F0F0F0"
        />
        <path
          d="M0.5 13.0258C0.5 6.45059 5.83028 1.1203 12.4055 1.1203H38.457C45.0323 1.1203 50.3625 6.45058 50.3625 13.0258V75.0533C50.3625 81.6285 45.0323 86.9588 38.457 86.9588H12.4055C5.83027 86.9588 0.5 81.6285 0.5 75.0533V13.0258Z"
          stroke="black"
          strokeOpacity="0.04"
        />
        <path
          d="M155.069 13.0258C155.069 6.17444 160.623 0.6203 167.474 0.6203H193.526C200.377 0.6203 205.931 6.17443 205.931 13.0258V19.2285C205.931 26.0799 200.377 31.634 193.526 31.634H167.474C160.623 31.634 155.069 26.0799 155.069 19.2285V13.0258Z"
          fill="#F0F0F0"
        />
        <path
          d="M155.569 13.0258C155.569 6.45058 160.899 1.1203 167.474 1.1203H193.526C200.101 1.1203 205.431 6.45058 205.431 13.0258V19.2285C205.431 25.8038 200.101 31.134 193.526 31.134H167.474C160.899 31.134 155.569 25.8038 155.569 19.2285V13.0258Z"
          stroke="black"
          strokeOpacity="0.04"
        />
        <path
          d="M155.069 45.9003C155.069 40.7618 159.234 36.5962 164.373 36.5962H196.627C201.766 36.5962 205.931 40.7618 205.931 45.9003C205.931 51.0389 201.766 55.2045 196.627 55.2045H164.373C159.234 55.2045 155.069 51.0389 155.069 45.9003Z"
          fill="#F0F0F0"
        />
        <path
          d="M155.569 45.9003C155.569 41.038 159.511 37.0962 164.373 37.0962H196.627C201.49 37.0962 205.431 41.038 205.431 45.9003C205.431 50.7627 201.49 54.7045 196.627 54.7045H164.373C159.511 54.7045 155.569 50.7627 155.569 45.9003Z"
          stroke="black"
          strokeOpacity="0.04"
        />
        <path
          d="M155.069 67.61C155.069 63.4992 158.401 60.1667 162.512 60.1667H198.488C202.599 60.1667 205.931 63.4992 205.931 67.61C205.931 71.7208 202.599 75.0533 198.488 75.0533H162.512C158.401 75.0533 155.069 71.7208 155.069 67.61Z"
          fill="#F0F0F0"
        />
        <path
          d="M155.569 67.61C155.569 63.7753 158.677 60.6667 162.512 60.6667H198.488C202.323 60.6667 205.431 63.7753 205.431 67.61C205.431 71.4447 202.323 74.5533 198.488 74.5533H162.512C158.677 74.5533 155.569 71.4447 155.569 67.61Z"
          stroke="black"
          strokeOpacity="0.04"
        />
        <path
          d="M155.069 87.4588C155.069 83.348 158.401 80.0155 162.512 80.0155H198.488C202.599 80.0155 205.931 83.348 205.931 87.4588C205.931 91.5696 202.599 94.9021 198.488 94.9021H162.512C158.401 94.9021 155.069 91.5696 155.069 87.4588Z"
          fill="#F0F0F0"
        />
        <path
          d="M155.569 87.4588C155.569 83.6241 158.677 80.5155 162.512 80.5155H198.488C202.323 80.5155 205.431 83.6241 205.431 87.4588C205.431 91.2934 202.323 94.4021 198.488 94.4021H162.512C158.677 94.4021 155.569 91.2934 155.569 87.4588Z"
          stroke="black"
          strokeOpacity="0.04"
        />
        <path
          d="M155.069 107.308C155.069 103.197 158.401 99.8643 162.512 99.8643H198.488C202.599 99.8643 205.931 103.197 205.931 107.308C205.931 111.418 202.599 114.751 198.488 114.751H162.512C158.401 114.751 155.069 111.418 155.069 107.308Z"
          fill="#F0F0F0"
        />
        <path
          d="M155.569 107.308C155.569 103.473 158.677 100.364 162.512 100.364H198.488C202.323 100.364 205.431 103.473 205.431 107.308C205.431 111.142 202.323 114.251 198.488 114.251H162.512C158.677 114.251 155.569 111.142 155.569 107.308Z"
          stroke="black"
          strokeOpacity="0.04"
        />
      </svg>
    </div>
  )
}

function convertSushiResponseToRoute(
  trade: UseTradeReturn | undefined,
): Route | null {
  if (trade === undefined || trade.vizualization === undefined) return null
  const data = trade.vizualization
  const transformed = {
    fills: data.links.map((link) => {
      return {
        from: data.nodes[link.source].address,
        to: data.nodes[link.target].address,
        source: data.liquidityProviders[link.liquidityProvider],
        proportionBps: Math.floor(Number(link.value * 100)),
      } as Fill
    }),
    tokens: data.nodes,
  }

  return transformed
}

export function SankeyPreview() {
  const { isLoading, data: trade } = useSimpleSwapTrade()
  const [sankeyContainerRef, setSankeyContainerRef] =
    useState<HTMLDivElement | null>(null)

  const route = useMemo(() => convertSushiResponseToRoute(trade), [trade])

  return route ? (
    <div className={previewContainerClass}>
      <div className={headerContainerClass}>
        <span className={headerTextClass}>Routing</span>
      </div>
      <div
        className={sankeyContainerClass}
        ref={(ref) => setSankeyContainerRef(ref)}
      >
        {sankeyContainerRef ? (
          <>
            {isLoading && <LoadingSkeleton />}
            {route && (
              <SankeyDiagram
                height={208} // to account for the internal margins used for the logo
                chainId={1}
                isPreview
                isMobile={false}
                onSubRouteTouch={() => {}}
                width={sankeyContainerRef.clientWidth ?? 200}
                route={route}
                className={borderOverrideClass}
              />
            )}
          </>
        ) : null}
      </div>
      {sankeyContainerRef && route && !isLoading ? (
        <div className={sankeyLegendClass}>
          <SankeyLegend route={route} />
        </div>
      ) : null}
    </div>
  ) : null
}
