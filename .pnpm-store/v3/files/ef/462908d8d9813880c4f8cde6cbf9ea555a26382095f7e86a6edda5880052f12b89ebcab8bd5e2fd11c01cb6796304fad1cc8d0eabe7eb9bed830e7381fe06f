{"version":3,"file":"index.js","sources":["../dist-src/version.js","../dist-src/add-event-handler.js","../dist-src/oauth-app-octokit.js","../dist-src/emit-event.js","../dist-src/methods/get-user-octokit.js","../dist-src/methods/get-web-flow-authorization-url.js","../dist-src/methods/create-token.js","../dist-src/methods/check-token.js","../dist-src/methods/reset-token.js","../dist-src/methods/refresh-token.js","../dist-src/methods/scope-token.js","../dist-src/methods/delete-token.js","../dist-src/methods/delete-authorization.js","../dist-src/middleware/node/parse-request.js","../dist-src/middleware/node/send-response.js","../dist-src/middleware/on-unhandled-request-default.js","../dist-src/middleware/handle-request.js","../dist-src/middleware/node/index.js","../dist-src/middleware/web-worker/parse-request.js","../dist-src/middleware/web-worker/send-response.js","../dist-src/middleware/web-worker/index.js","../dist-src/middleware/aws-lambda/api-gateway-v2-parse-request.js","../dist-src/middleware/aws-lambda/api-gateway-v2-send-response.js","../dist-src/middleware/aws-lambda/api-gateway-v2.js","../dist-src/index.js"],"sourcesContent":["export const VERSION = \"4.0.6\";\n","export function addEventHandler(state, eventName, eventHandler) {\n    if (Array.isArray(eventName)) {\n        for (const singleEventName of eventName) {\n            addEventHandler(state, singleEventName, eventHandler);\n        }\n        return;\n    }\n    if (!state.eventHandlers[eventName]) {\n        state.eventHandlers[eventName] = [];\n    }\n    state.eventHandlers[eventName].push(eventHandler);\n}\n","import { Octokit } from \"@octokit/core\";\nimport { getUserAgent } from \"universal-user-agent\";\nimport { VERSION } from \"./version\";\nexport const OAuthAppOctokit = Octokit.defaults({\n    userAgent: `octokit-oauth-app.js/${VERSION} ${getUserAgent()}`,\n});\n","export async function emitEvent(state, context) {\n    const { name, action } = context;\n    if (state.eventHandlers[`${name}.${action}`]) {\n        for (const eventHandler of state.eventHandlers[`${name}.${action}`]) {\n            await eventHandler(context);\n        }\n    }\n    if (state.eventHandlers[name]) {\n        for (const eventHandler of state.eventHandlers[name]) {\n            await eventHandler(context);\n        }\n    }\n}\n","import { createOAuthUserAuth, } from \"@octokit/auth-oauth-user\";\nimport { emitEvent } from \"../emit-event\";\nexport async function getUserOctokitWithState(state, options) {\n    return state.octokit.auth({\n        type: \"oauth-user\",\n        ...options,\n        async factory(options) {\n            const octokit = new state.Octokit({\n                authStrategy: createOAuthUserAuth,\n                auth: options,\n            });\n            const authentication = (await octokit.auth({\n                type: \"get\",\n            }));\n            await emitEvent(state, {\n                name: \"token\",\n                action: \"created\",\n                token: authentication.token,\n                scopes: authentication.scopes,\n                authentication,\n                octokit,\n            });\n            return octokit;\n        },\n    });\n}\n","import * as OAuthMethods from \"@octokit/oauth-methods\";\nexport function getWebFlowAuthorizationUrlWithState(state, options) {\n    const optionsWithDefaults = {\n        clientId: state.clientId,\n        request: state.octokit.request,\n        ...options,\n        allowSignup: options.allowSignup || state.allowSignup,\n        scopes: options.scopes || state.defaultScopes,\n    };\n    return OAuthMethods.getWebFlowAuthorizationUrl({\n        clientType: state.clientType,\n        ...optionsWithDefaults,\n    });\n}\n","import * as OAuthAppAuth from \"@octokit/auth-oauth-app\";\nimport { emitEvent } from \"../emit-event\";\nexport async function createTokenWithState(state, options) {\n    const authentication = await state.octokit.auth({\n        type: \"oauth-user\",\n        ...options,\n    });\n    await emitEvent(state, {\n        name: \"token\",\n        action: \"created\",\n        token: authentication.token,\n        scopes: authentication.scopes,\n        authentication,\n        octokit: new state.Octokit({\n            authStrategy: OAuthAppAuth.createOAuthUserAuth,\n            auth: {\n                clientType: state.clientType,\n                clientId: state.clientId,\n                clientSecret: state.clientSecret,\n                token: authentication.token,\n                scopes: authentication.scopes,\n                refreshToken: authentication.refreshToken,\n                expiresAt: authentication.expiresAt,\n                refreshTokenExpiresAt: authentication.refreshTokenExpiresAt,\n            },\n        }),\n    });\n    return { authentication };\n}\n","import * as OAuthMethods from \"@octokit/oauth-methods\";\nexport async function checkTokenWithState(state, options) {\n    const result = await OAuthMethods.checkToken({\n        // @ts-expect-error not worth the extra code to appease TS\n        clientType: state.clientType,\n        clientId: state.clientId,\n        clientSecret: state.clientSecret,\n        request: state.octokit.request,\n        ...options,\n    });\n    Object.assign(result.authentication, { type: \"token\", tokenType: \"oauth\" });\n    return result;\n}\n","import * as OAuthMethods from \"@octokit/oauth-methods\";\nimport { emitEvent } from \"../emit-event\";\nimport { createOAuthUserAuth } from \"@octokit/auth-oauth-user\";\nexport async function resetTokenWithState(state, options) {\n    const optionsWithDefaults = {\n        clientId: state.clientId,\n        clientSecret: state.clientSecret,\n        request: state.octokit.request,\n        ...options,\n    };\n    if (state.clientType === \"oauth-app\") {\n        const response = await OAuthMethods.resetToken({\n            clientType: \"oauth-app\",\n            ...optionsWithDefaults,\n        });\n        const authentication = Object.assign(response.authentication, {\n            type: \"token\",\n            tokenType: \"oauth\",\n        });\n        await emitEvent(state, {\n            name: \"token\",\n            action: \"reset\",\n            token: response.authentication.token,\n            scopes: response.authentication.scopes || undefined,\n            authentication: authentication,\n            octokit: new state.Octokit({\n                authStrategy: createOAuthUserAuth,\n                auth: {\n                    clientType: state.clientType,\n                    clientId: state.clientId,\n                    clientSecret: state.clientSecret,\n                    token: response.authentication.token,\n                    scopes: response.authentication.scopes,\n                },\n            }),\n        });\n        return { ...response, authentication };\n    }\n    const response = await OAuthMethods.resetToken({\n        clientType: \"github-app\",\n        ...optionsWithDefaults,\n    });\n    const authentication = Object.assign(response.authentication, {\n        type: \"token\",\n        tokenType: \"oauth\",\n    });\n    await emitEvent(state, {\n        name: \"token\",\n        action: \"reset\",\n        token: response.authentication.token,\n        authentication: authentication,\n        octokit: new state.Octokit({\n            authStrategy: createOAuthUserAuth,\n            auth: {\n                clientType: state.clientType,\n                clientId: state.clientId,\n                clientSecret: state.clientSecret,\n                token: response.authentication.token,\n            },\n        }),\n    });\n    return { ...response, authentication };\n}\n","import * as OAuthMethods from \"@octokit/oauth-methods\";\nimport { emitEvent } from \"../emit-event\";\nimport { createOAuthUserAuth } from \"@octokit/auth-oauth-user\";\nexport async function refreshTokenWithState(state, options) {\n    if (state.clientType === \"oauth-app\") {\n        throw new Error(\"[@octokit/oauth-app] app.refreshToken() is not supported for OAuth Apps\");\n    }\n    const response = await OAuthMethods.refreshToken({\n        clientType: \"github-app\",\n        clientId: state.clientId,\n        clientSecret: state.clientSecret,\n        request: state.octokit.request,\n        refreshToken: options.refreshToken,\n    });\n    const authentication = Object.assign(response.authentication, {\n        type: \"token\",\n        tokenType: \"oauth\",\n    });\n    await emitEvent(state, {\n        name: \"token\",\n        action: \"refreshed\",\n        token: response.authentication.token,\n        authentication: authentication,\n        octokit: new state.Octokit({\n            authStrategy: createOAuthUserAuth,\n            auth: {\n                clientType: state.clientType,\n                clientId: state.clientId,\n                clientSecret: state.clientSecret,\n                token: response.authentication.token,\n            },\n        }),\n    });\n    return { ...response, authentication };\n}\n","import * as OAuthMethods from \"@octokit/oauth-methods\";\nimport { createOAuthUserAuth } from \"@octokit/auth-oauth-user\";\nimport { emitEvent } from \"../emit-event\";\nexport async function scopeTokenWithState(state, options) {\n    if (state.clientType === \"oauth-app\") {\n        throw new Error(\"[@octokit/oauth-app] app.scopeToken() is not supported for OAuth Apps\");\n    }\n    const response = await OAuthMethods.scopeToken({\n        clientType: \"github-app\",\n        clientId: state.clientId,\n        clientSecret: state.clientSecret,\n        request: state.octokit.request,\n        ...options,\n    });\n    const authentication = Object.assign(response.authentication, {\n        type: \"token\",\n        tokenType: \"oauth\",\n    });\n    await emitEvent(state, {\n        name: \"token\",\n        action: \"scoped\",\n        token: response.authentication.token,\n        authentication: authentication,\n        octokit: new state.Octokit({\n            authStrategy: createOAuthUserAuth,\n            auth: {\n                clientType: state.clientType,\n                clientId: state.clientId,\n                clientSecret: state.clientSecret,\n                token: response.authentication.token,\n            },\n        }),\n    });\n    return { ...response, authentication };\n}\n","import * as OAuthMethods from \"@octokit/oauth-methods\";\nimport { createUnauthenticatedAuth } from \"@octokit/auth-unauthenticated\";\nimport { emitEvent } from \"../emit-event\";\nexport async function deleteTokenWithState(state, options) {\n    const optionsWithDefaults = {\n        clientId: state.clientId,\n        clientSecret: state.clientSecret,\n        request: state.octokit.request,\n        ...options,\n    };\n    const response = state.clientType === \"oauth-app\"\n        ? await OAuthMethods.deleteToken({\n            clientType: \"oauth-app\",\n            ...optionsWithDefaults,\n        })\n        : // istanbul ignore next\n            await OAuthMethods.deleteToken({\n                clientType: \"github-app\",\n                ...optionsWithDefaults,\n            });\n    await emitEvent(state, {\n        name: \"token\",\n        action: \"deleted\",\n        token: options.token,\n        octokit: new state.Octokit({\n            authStrategy: createUnauthenticatedAuth,\n            auth: {\n                reason: `Handling \"token.deleted\" event. The access for the token has been revoked.`,\n            },\n        }),\n    });\n    return response;\n}\n","import * as OAuthMethods from \"@octokit/oauth-methods\";\nimport { createUnauthenticatedAuth } from \"@octokit/auth-unauthenticated\";\nimport { emitEvent } from \"../emit-event\";\nexport async function deleteAuthorizationWithState(state, options) {\n    const optionsWithDefaults = {\n        clientId: state.clientId,\n        clientSecret: state.clientSecret,\n        request: state.octokit.request,\n        ...options,\n    };\n    const response = state.clientType === \"oauth-app\"\n        ? await OAuthMethods.deleteAuthorization({\n            clientType: \"oauth-app\",\n            ...optionsWithDefaults,\n        })\n        : // istanbul ignore next\n            await OAuthMethods.deleteAuthorization({\n                clientType: \"github-app\",\n                ...optionsWithDefaults,\n            });\n    await emitEvent(state, {\n        name: \"token\",\n        action: \"deleted\",\n        token: options.token,\n        octokit: new state.Octokit({\n            authStrategy: createUnauthenticatedAuth,\n            auth: {\n                reason: `Handling \"token.deleted\" event. The access for the token has been revoked.`,\n            },\n        }),\n    });\n    await emitEvent(state, {\n        name: \"authorization\",\n        action: \"deleted\",\n        token: options.token,\n        octokit: new state.Octokit({\n            authStrategy: createUnauthenticatedAuth,\n            auth: {\n                reason: `Handling \"authorization.deleted\" event. The access for the app has been revoked.`,\n            },\n        }),\n    });\n    return response;\n}\n","export function parseRequest(request) {\n    const { method, url, headers } = request;\n    async function text() {\n        const text = await new Promise((resolve, reject) => {\n            let bodyChunks = [];\n            request\n                .on(\"error\", reject)\n                .on(\"data\", (chunk) => bodyChunks.push(chunk))\n                .on(\"end\", () => resolve(Buffer.concat(bodyChunks).toString()));\n        });\n        return text;\n    }\n    return { method, url, headers, text };\n}\n","export function sendResponse(octokitResponse, response) {\n    response.writeHead(octokitResponse.status, octokitResponse.headers);\n    response.end(octokitResponse.text);\n}\n","export function onUnhandledRequestDefault(request) {\n    return {\n        status: 404,\n        headers: { \"content-type\": \"application/json\" },\n        text: JSON.stringify({\n            error: `Unknown route: ${request.method} ${request.url}`,\n        }),\n    };\n}\n","// @ts-ignore - requires esModuleInterop flag\nimport fromEntries from \"fromentries\";\nexport async function handleRequest(app, { pathPrefix = \"/api/github/oauth\" }, request) {\n    if (request.method === \"OPTIONS\") {\n        return {\n            status: 200,\n            headers: {\n                \"access-control-allow-origin\": \"*\",\n                \"access-control-allow-methods\": \"*\",\n                \"access-control-allow-headers\": \"Content-Type, User-Agent, Authorization\",\n            },\n        };\n    }\n    // request.url may include ?query parameters which we don't want for `route`\n    // hence the workaround using new URL()\n    const { pathname } = new URL(request.url, \"http://localhost\");\n    const route = [request.method, pathname].join(\" \");\n    const routes = {\n        getLogin: `GET ${pathPrefix}/login`,\n        getCallback: `GET ${pathPrefix}/callback`,\n        createToken: `POST ${pathPrefix}/token`,\n        getToken: `GET ${pathPrefix}/token`,\n        patchToken: `PATCH ${pathPrefix}/token`,\n        patchRefreshToken: `PATCH ${pathPrefix}/refresh-token`,\n        scopeToken: `POST ${pathPrefix}/token/scoped`,\n        deleteToken: `DELETE ${pathPrefix}/token`,\n        deleteGrant: `DELETE ${pathPrefix}/grant`,\n    };\n    // handle unknown routes\n    if (!Object.values(routes).includes(route)) {\n        return null;\n    }\n    let json;\n    try {\n        const text = await request.text();\n        json = text ? JSON.parse(text) : {};\n    }\n    catch (error) {\n        return {\n            status: 400,\n            headers: {\n                \"content-type\": \"application/json\",\n                \"access-control-allow-origin\": \"*\",\n            },\n            text: JSON.stringify({\n                error: \"[@octokit/oauth-app] request error\",\n            }),\n        };\n    }\n    const { searchParams } = new URL(request.url, \"http://localhost\");\n    const query = fromEntries(searchParams);\n    const headers = request.headers;\n    try {\n        if (route === routes.getLogin) {\n            const { url } = app.getWebFlowAuthorizationUrl({\n                state: query.state,\n                scopes: query.scopes ? query.scopes.split(\",\") : undefined,\n                allowSignup: query.allowSignup !== \"false\",\n                redirectUrl: query.redirectUrl,\n            });\n            return { status: 302, headers: { location: url } };\n        }\n        if (route === routes.getCallback) {\n            if (query.error) {\n                throw new Error(`[@octokit/oauth-app] ${query.error} ${query.error_description}`);\n            }\n            if (!query.code) {\n                throw new Error('[@octokit/oauth-app] \"code\" parameter is required');\n            }\n            const { authentication: { token }, } = await app.createToken({\n                code: query.code,\n            });\n            return {\n                status: 200,\n                headers: {\n                    \"content-type\": \"text/html\",\n                },\n                text: `<h1>Token created successfull</h1>\n    \n<p>Your token is: <strong>${token}</strong>. Copy it now as it cannot be shown again.</p>`,\n            };\n        }\n        if (route === routes.createToken) {\n            const { code, redirectUrl } = json;\n            if (!code) {\n                throw new Error('[@octokit/oauth-app] \"code\" parameter is required');\n            }\n            const result = await app.createToken({\n                code,\n                redirectUrl,\n            });\n            // @ts-ignore\n            delete result.authentication.clientSecret;\n            return {\n                status: 201,\n                headers: {\n                    \"content-type\": \"application/json\",\n                    \"access-control-allow-origin\": \"*\",\n                },\n                text: JSON.stringify(result),\n            };\n        }\n        if (route === routes.getToken) {\n            const token = headers.authorization?.substr(\"token \".length);\n            if (!token) {\n                throw new Error('[@octokit/oauth-app] \"Authorization\" header is required');\n            }\n            const result = await app.checkToken({\n                token,\n            });\n            // @ts-ignore\n            delete result.authentication.clientSecret;\n            return {\n                status: 200,\n                headers: {\n                    \"content-type\": \"application/json\",\n                    \"access-control-allow-origin\": \"*\",\n                },\n                text: JSON.stringify(result),\n            };\n        }\n        if (route === routes.patchToken) {\n            const token = headers.authorization?.substr(\"token \".length);\n            if (!token) {\n                throw new Error('[@octokit/oauth-app] \"Authorization\" header is required');\n            }\n            const result = await app.resetToken({ token });\n            // @ts-ignore\n            delete result.authentication.clientSecret;\n            return {\n                status: 200,\n                headers: {\n                    \"content-type\": \"application/json\",\n                    \"access-control-allow-origin\": \"*\",\n                },\n                text: JSON.stringify(result),\n            };\n        }\n        if (route === routes.patchRefreshToken) {\n            const token = headers.authorization?.substr(\"token \".length);\n            if (!token) {\n                throw new Error('[@octokit/oauth-app] \"Authorization\" header is required');\n            }\n            const { refreshToken } = json;\n            if (!refreshToken) {\n                throw new Error(\"[@octokit/oauth-app] refreshToken must be sent in request body\");\n            }\n            const result = await app.refreshToken({ refreshToken });\n            // @ts-ignore\n            delete result.authentication.clientSecret;\n            return {\n                status: 200,\n                headers: {\n                    \"content-type\": \"application/json\",\n                    \"access-control-allow-origin\": \"*\",\n                },\n                text: JSON.stringify(result),\n            };\n        }\n        if (route === routes.scopeToken) {\n            const token = headers.authorization?.substr(\"token \".length);\n            if (!token) {\n                throw new Error('[@octokit/oauth-app] \"Authorization\" header is required');\n            }\n            const result = await app.scopeToken({\n                token,\n                ...json,\n            });\n            // @ts-ignore\n            delete result.authentication.clientSecret;\n            return {\n                status: 200,\n                headers: {\n                    \"content-type\": \"application/json\",\n                    \"access-control-allow-origin\": \"*\",\n                },\n                text: JSON.stringify(result),\n            };\n        }\n        if (route === routes.deleteToken) {\n            const token = headers.authorization?.substr(\"token \".length);\n            if (!token) {\n                throw new Error('[@octokit/oauth-app] \"Authorization\" header is required');\n            }\n            await app.deleteToken({\n                token,\n            });\n            return {\n                status: 204,\n                headers: { \"access-control-allow-origin\": \"*\" },\n            };\n        }\n        // route === routes.deleteGrant\n        const token = headers.authorization?.substr(\"token \".length);\n        if (!token) {\n            throw new Error('[@octokit/oauth-app] \"Authorization\" header is required');\n        }\n        await app.deleteAuthorization({\n            token,\n        });\n        return {\n            status: 204,\n            headers: { \"access-control-allow-origin\": \"*\" },\n        };\n    }\n    catch (error) {\n        return {\n            status: 400,\n            headers: {\n                \"content-type\": \"application/json\",\n                \"access-control-allow-origin\": \"*\",\n            },\n            text: JSON.stringify({ error: error.message }),\n        };\n    }\n}\n","import { parseRequest } from \"./parse-request\";\nimport { sendResponse } from \"./send-response\";\nimport { onUnhandledRequestDefault } from \"../on-unhandled-request-default\";\nimport { handleRequest } from \"../handle-request\";\nfunction onUnhandledRequestDefaultNode(request, response) {\n    const octokitRequest = parseRequest(request);\n    const octokitResponse = onUnhandledRequestDefault(octokitRequest);\n    sendResponse(octokitResponse, response);\n}\nexport function createNodeMiddleware(app, { pathPrefix, onUnhandledRequest = onUnhandledRequestDefaultNode, } = {}) {\n    return async function (request, response, next) {\n        const octokitRequest = parseRequest(request);\n        const octokitResponse = await handleRequest(app, { pathPrefix }, octokitRequest);\n        if (octokitResponse) {\n            sendResponse(octokitResponse, response);\n        }\n        else if (typeof next === \"function\") {\n            next();\n        }\n        else {\n            onUnhandledRequest(request, response);\n        }\n    };\n}\n","export function parseRequest(request) {\n    // @ts-ignore Worker environment supports fromEntries/entries.\n    const headers = Object.fromEntries(request.headers.entries());\n    return {\n        method: request.method,\n        url: request.url,\n        headers,\n        text: () => request.text(),\n    };\n}\n","export function sendResponse(octokitResponse) {\n    return new Response(octokitResponse.text, {\n        status: octokitResponse.status,\n        headers: octokitResponse.headers,\n    });\n}\n","import { parseRequest } from \"./parse-request\";\nimport { sendResponse } from \"./send-response\";\nimport { handleRequest } from \"../handle-request\";\nimport { onUnhandledRequestDefault } from \"../on-unhandled-request-default\";\nasync function onUnhandledRequestDefaultWebWorker(request) {\n    const octokitRequest = parseRequest(request);\n    const octokitResponse = onUnhandledRequestDefault(octokitRequest);\n    return sendResponse(octokitResponse);\n}\nexport function createWebWorkerHandler(app, { pathPrefix, onUnhandledRequest = onUnhandledRequestDefaultWebWorker, } = {}) {\n    return async function (request) {\n        const octokitRequest = parseRequest(request);\n        const octokitResponse = await handleRequest(app, { pathPrefix }, octokitRequest);\n        return octokitResponse\n            ? sendResponse(octokitResponse)\n            : await onUnhandledRequest(request);\n    };\n}\n/** @deprecated */\nexport function createCloudflareHandler(...args) {\n    args[0].octokit.log.warn(\"[@octokit/oauth-app] `createCloudflareHandler` is deprecated, use `createWebWorkerHandler` instead\");\n    return createWebWorkerHandler(...args);\n}\n","export function parseRequest(request) {\n    const { method } = request.requestContext.http;\n    let url = request.rawPath;\n    const { stage } = request.requestContext;\n    if (url.startsWith(\"/\" + stage))\n        url = url.substring(stage.length + 1);\n    if (request.rawQueryString)\n        url += \"?\" + request.rawQueryString;\n    const headers = request.headers;\n    const text = async () => request.body || \"\";\n    return { method, url, headers, text };\n}\n","export function sendResponse(octokitResponse) {\n    return {\n        statusCode: octokitResponse.status,\n        headers: octokitResponse.headers,\n        body: octokitResponse.text,\n    };\n}\n","import { parseRequest } from \"./api-gateway-v2-parse-request\";\nimport { sendResponse } from \"./api-gateway-v2-send-response\";\nimport { handleRequest } from \"../handle-request\";\nimport { onUnhandledRequestDefault } from \"../on-unhandled-request-default\";\nasync function onUnhandledRequestDefaultAWSAPIGatewayV2(event) {\n    const request = parseRequest(event);\n    const response = onUnhandledRequestDefault(request);\n    return sendResponse(response);\n}\nexport function createAWSLambdaAPIGatewayV2Handler(app, { pathPrefix, onUnhandledRequest = onUnhandledRequestDefaultAWSAPIGatewayV2, } = {}) {\n    return async function (event) {\n        const request = parseRequest(event);\n        const response = await handleRequest(app, { pathPrefix }, request);\n        return response ? sendResponse(response) : onUnhandledRequest(event);\n    };\n}\n","import { createOAuthAppAuth } from \"@octokit/auth-oauth-app\";\nimport { VERSION } from \"./version\";\nimport { addEventHandler } from \"./add-event-handler\";\nimport { OAuthAppOctokit } from \"./oauth-app-octokit\";\nimport { getUserOctokitWithState, } from \"./methods/get-user-octokit\";\nimport { getWebFlowAuthorizationUrlWithState, } from \"./methods/get-web-flow-authorization-url\";\nimport { createTokenWithState, } from \"./methods/create-token\";\nimport { checkTokenWithState, } from \"./methods/check-token\";\nimport { resetTokenWithState, } from \"./methods/reset-token\";\nimport { refreshTokenWithState, } from \"./methods/refresh-token\";\nimport { scopeTokenWithState, } from \"./methods/scope-token\";\nimport { deleteTokenWithState, } from \"./methods/delete-token\";\nimport { deleteAuthorizationWithState, } from \"./methods/delete-authorization\";\nexport { createNodeMiddleware } from \"./middleware/node/index\";\nexport { createCloudflareHandler, createWebWorkerHandler, } from \"./middleware/web-worker/index\";\nexport { createAWSLambdaAPIGatewayV2Handler } from \"./middleware/aws-lambda/api-gateway-v2\";\nexport class OAuthApp {\n    constructor(options) {\n        const Octokit = options.Octokit || OAuthAppOctokit;\n        this.type = (options.clientType ||\n            \"oauth-app\");\n        const octokit = new Octokit({\n            authStrategy: createOAuthAppAuth,\n            auth: {\n                clientType: this.type,\n                clientId: options.clientId,\n                clientSecret: options.clientSecret,\n            },\n        });\n        const state = {\n            clientType: this.type,\n            clientId: options.clientId,\n            clientSecret: options.clientSecret,\n            // @ts-expect-error defaultScopes not permitted for GitHub Apps\n            defaultScopes: options.defaultScopes || [],\n            allowSignup: options.allowSignup,\n            baseUrl: options.baseUrl,\n            log: options.log,\n            Octokit,\n            octokit,\n            eventHandlers: {},\n        };\n        this.on = addEventHandler.bind(null, state);\n        // @ts-expect-error TODO: figure this out\n        this.octokit = octokit;\n        this.getUserOctokit = getUserOctokitWithState.bind(null, state);\n        this.getWebFlowAuthorizationUrl = getWebFlowAuthorizationUrlWithState.bind(null, state);\n        this.createToken = createTokenWithState.bind(null, state);\n        this.checkToken = checkTokenWithState.bind(null, state);\n        this.resetToken = resetTokenWithState.bind(null, state);\n        this.refreshToken = refreshTokenWithState.bind(null, state);\n        this.scopeToken = scopeTokenWithState.bind(null, state);\n        this.deleteToken = deleteTokenWithState.bind(null, state);\n        this.deleteAuthorization = deleteAuthorizationWithState.bind(null, state);\n    }\n    static defaults(defaults) {\n        const OAuthAppWithDefaults = class extends this {\n            constructor(...args) {\n                super({\n                    ...defaults,\n                    ...args[0],\n                });\n            }\n        };\n        return OAuthAppWithDefaults;\n    }\n}\nOAuthApp.VERSION = VERSION;\n"],"names":["VERSION","addEventHandler","state","eventName","eventHandler","Array","isArray","singleEventName","eventHandlers","push","OAuthAppOctokit","Octokit","defaults","userAgent","getUserAgent","emitEvent","context","name","action","getUserOctokitWithState","options","octokit","auth","type","factory","authStrategy","createOAuthUserAuth","authentication","token","scopes","getWebFlowAuthorizationUrlWithState","optionsWithDefaults","clientId","request","allowSignup","defaultScopes","OAuthMethods","clientType","createTokenWithState","OAuthAppAuth","clientSecret","refreshToken","expiresAt","refreshTokenExpiresAt","checkTokenWithState","result","Object","assign","tokenType","resetTokenWithState","response","undefined","refreshTokenWithState","Error","scopeTokenWithState","deleteTokenWithState","createUnauthenticatedAuth","reason","deleteAuthorizationWithState","parseRequest","method","url","headers","text","Promise","resolve","reject","bodyChunks","on","chunk","Buffer","concat","toString","sendResponse","octokitResponse","writeHead","status","end","onUnhandledRequestDefault","JSON","stringify","error","handleRequest","app","pathPrefix","pathname","URL","route","join","routes","getLogin","getCallback","createToken","getToken","patchToken","patchRefreshToken","scopeToken","deleteToken","deleteGrant","values","includes","json","parse","searchParams","query","fromEntries","getWebFlowAuthorizationUrl","split","redirectUrl","location","error_description","code","authorization","substr","length","checkToken","resetToken","deleteAuthorization","message","onUnhandledRequestDefaultNode","octokitRequest","createNodeMiddleware","onUnhandledRequest","next","entries","Response","onUnhandledRequestDefaultWebWorker","createWebWorkerHandler","createCloudflareHandler","args","log","warn","requestContext","http","rawPath","stage","startsWith","substring","rawQueryString","body","statusCode","onUnhandledRequestDefaultAWSAPIGatewayV2","event","createAWSLambdaAPIGatewayV2Handler","OAuthApp","constructor","createOAuthAppAuth","baseUrl","bind","getUserOctokit","OAuthAppWithDefaults"],"mappings":"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"}