{"version":3,"file":"index.js","sources":["../dist-src/version.js","../dist-src/get-buffer-response.js","../dist-src/fetch-wrapper.js","../dist-src/with-defaults.js","../dist-src/index.js"],"sourcesContent":["export const VERSION = \"6.2.0\";\n","export default function getBufferResponse(response) {\n    return response.arrayBuffer();\n}\n","import { isPlainObject } from \"is-plain-object\";\nimport nodeFetch from \"node-fetch\";\nimport { RequestError } from \"@octokit/request-error\";\nimport getBuffer from \"./get-buffer-response\";\nexport default function fetchWrapper(requestOptions) {\n    const log = requestOptions.request && requestOptions.request.log\n        ? requestOptions.request.log\n        : console;\n    if (isPlainObject(requestOptions.body) ||\n        Array.isArray(requestOptions.body)) {\n        requestOptions.body = JSON.stringify(requestOptions.body);\n    }\n    let headers = {};\n    let status;\n    let url;\n    const fetch = (requestOptions.request && requestOptions.request.fetch) ||\n        globalThis.fetch ||\n        /* istanbul ignore next */ nodeFetch;\n    return fetch(requestOptions.url, Object.assign({\n        method: requestOptions.method,\n        body: requestOptions.body,\n        headers: requestOptions.headers,\n        redirect: requestOptions.redirect,\n    }, \n    // `requestOptions.request.agent` type is incompatible\n    // see https://github.com/octokit/types.ts/pull/264\n    requestOptions.request))\n        .then(async (response) => {\n        url = response.url;\n        status = response.status;\n        for (const keyAndValue of response.headers) {\n            headers[keyAndValue[0]] = keyAndValue[1];\n        }\n        if (\"deprecation\" in headers) {\n            const matches = headers.link && headers.link.match(/<([^>]+)>; rel=\"deprecation\"/);\n            const deprecationLink = matches && matches.pop();\n            log.warn(`[@octokit/request] \"${requestOptions.method} ${requestOptions.url}\" is deprecated. It is scheduled to be removed on ${headers.sunset}${deprecationLink ? `. See ${deprecationLink}` : \"\"}`);\n        }\n        if (status === 204 || status === 205) {\n            return;\n        }\n        // GitHub API returns 200 for HEAD requests\n        if (requestOptions.method === \"HEAD\") {\n            if (status < 400) {\n                return;\n            }\n            throw new RequestError(response.statusText, status, {\n                response: {\n                    url,\n                    status,\n                    headers,\n                    data: undefined,\n                },\n                request: requestOptions,\n            });\n        }\n        if (status === 304) {\n            throw new RequestError(\"Not modified\", status, {\n                response: {\n                    url,\n                    status,\n                    headers,\n                    data: await getResponseData(response),\n                },\n                request: requestOptions,\n            });\n        }\n        if (status >= 400) {\n            const data = await getResponseData(response);\n            const error = new RequestError(toErrorMessage(data), status, {\n                response: {\n                    url,\n                    status,\n                    headers,\n                    data,\n                },\n                request: requestOptions,\n            });\n            throw error;\n        }\n        return getResponseData(response);\n    })\n        .then((data) => {\n        return {\n            status,\n            url,\n            headers,\n            data,\n        };\n    })\n        .catch((error) => {\n        if (error instanceof RequestError)\n            throw error;\n        else if (error.name === \"AbortError\")\n            throw error;\n        throw new RequestError(error.message, 500, {\n            request: requestOptions,\n        });\n    });\n}\nasync function getResponseData(response) {\n    const contentType = response.headers.get(\"content-type\");\n    if (/application\\/json/.test(contentType)) {\n        return response.json();\n    }\n    if (!contentType || /^text\\/|charset=utf-8$/.test(contentType)) {\n        return response.text();\n    }\n    return getBuffer(response);\n}\nfunction toErrorMessage(data) {\n    if (typeof data === \"string\")\n        return data;\n    // istanbul ignore else - just in case\n    if (\"message\" in data) {\n        if (Array.isArray(data.errors)) {\n            return `${data.message}: ${data.errors.map(JSON.stringify).join(\", \")}`;\n        }\n        return data.message;\n    }\n    // istanbul ignore next - just in case\n    return `Unknown error: ${JSON.stringify(data)}`;\n}\n","import fetchWrapper from \"./fetch-wrapper\";\nexport default function withDefaults(oldEndpoint, newDefaults) {\n    const endpoint = oldEndpoint.defaults(newDefaults);\n    const newApi = function (route, parameters) {\n        const endpointOptions = endpoint.merge(route, parameters);\n        if (!endpointOptions.request || !endpointOptions.request.hook) {\n            return fetchWrapper(endpoint.parse(endpointOptions));\n        }\n        const request = (route, parameters) => {\n            return fetchWrapper(endpoint.parse(endpoint.merge(route, parameters)));\n        };\n        Object.assign(request, {\n            endpoint,\n            defaults: withDefaults.bind(null, endpoint),\n        });\n        return endpointOptions.request.hook(request, endpointOptions);\n    };\n    return Object.assign(newApi, {\n        endpoint,\n        defaults: withDefaults.bind(null, endpoint),\n    });\n}\n","import { endpoint } from \"@octokit/endpoint\";\nimport { getUserAgent } from \"universal-user-agent\";\nimport { VERSION } from \"./version\";\nimport withDefaults from \"./with-defaults\";\nexport const request = withDefaults(endpoint, {\n    headers: {\n        \"user-agent\": `octokit-request.js/${VERSION} ${getUserAgent()}`,\n    },\n});\n"],"names":["VERSION","getBufferResponse","response","arrayBuffer","fetchWrapper","requestOptions","log","request","console","isPlainObject","body","Array","isArray","JSON","stringify","headers","status","url","fetch","globalThis","nodeFetch","Object","assign","method","redirect","then","keyAndValue","matches","link","match","deprecationLink","pop","warn","sunset","RequestError","statusText","data","undefined","getResponseData","error","toErrorMessage","catch","name","message","contentType","get","test","json","text","getBuffer","errors","map","join","withDefaults","oldEndpoint","newDefaults","endpoint","defaults","newApi","route","parameters","endpointOptions","merge","hook","parse","bind","getUserAgent"],"mappings":"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"}