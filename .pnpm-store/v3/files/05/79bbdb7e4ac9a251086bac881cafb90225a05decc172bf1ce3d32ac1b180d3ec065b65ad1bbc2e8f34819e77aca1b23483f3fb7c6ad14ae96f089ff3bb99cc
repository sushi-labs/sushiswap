{"version":3,"file":"index.js","sources":["../dist-src/version.js","../dist-src/wrap-request.js","../dist-src/generated/triggers-notification-paths.js","../dist-src/route-matcher.js","../dist-src/index.js"],"sourcesContent":["export const VERSION = \"4.1.0\";\n","const noop = () => Promise.resolve();\n// @ts-expect-error\nexport function wrapRequest(state, request, options) {\n    return state.retryLimiter.schedule(doRequest, state, request, options);\n}\n// @ts-expect-error\nasync function doRequest(state, request, options) {\n    const isWrite = options.method !== \"GET\" && options.method !== \"HEAD\";\n    const { pathname } = new URL(options.url, \"http://github.test\");\n    const isSearch = options.method === \"GET\" && pathname.startsWith(\"/search/\");\n    const isGraphQL = pathname.startsWith(\"/graphql\");\n    const retryCount = ~~options.request.retryCount;\n    const jobOptions = retryCount > 0 ? { priority: 0, weight: 0 } : {};\n    if (state.clustering) {\n        // Remove a job from Redis if it has not completed or failed within 60s\n        // Examples: Node process terminated, client disconnected, etc.\n        // @ts-expect-error\n        jobOptions.expiration = 1000 * 60;\n    }\n    // Guarantee at least 1000ms between writes\n    // GraphQL can also trigger writes\n    if (isWrite || isGraphQL) {\n        await state.write.key(state.id).schedule(jobOptions, noop);\n    }\n    // Guarantee at least 3000ms between requests that trigger notifications\n    if (isWrite && state.triggersNotification(pathname)) {\n        await state.notifications.key(state.id).schedule(jobOptions, noop);\n    }\n    // Guarantee at least 2000ms between search requests\n    if (isSearch) {\n        await state.search.key(state.id).schedule(jobOptions, noop);\n    }\n    const req = state.global.key(state.id).schedule(jobOptions, request, options);\n    if (isGraphQL) {\n        const res = await req;\n        if (res.data.errors != null &&\n            // @ts-expect-error\n            res.data.errors.some((error) => error.type === \"RATE_LIMITED\")) {\n            const error = Object.assign(new Error(\"GraphQL Rate Limit Exceeded\"), {\n                response: res,\n                data: res.data,\n            });\n            throw error;\n        }\n    }\n    return req;\n}\n","export default [\n    \"/orgs/{org}/invitations\",\n    \"/orgs/{org}/invitations/{invitation_id}\",\n    \"/orgs/{org}/teams/{team_slug}/discussions\",\n    \"/orgs/{org}/teams/{team_slug}/discussions/{discussion_number}/comments\",\n    \"/repos/{owner}/{repo}/collaborators/{username}\",\n    \"/repos/{owner}/{repo}/commits/{commit_sha}/comments\",\n    \"/repos/{owner}/{repo}/issues\",\n    \"/repos/{owner}/{repo}/issues/{issue_number}/comments\",\n    \"/repos/{owner}/{repo}/pulls\",\n    \"/repos/{owner}/{repo}/pulls/{pull_number}/comments\",\n    \"/repos/{owner}/{repo}/pulls/{pull_number}/comments/{comment_id}/replies\",\n    \"/repos/{owner}/{repo}/pulls/{pull_number}/merge\",\n    \"/repos/{owner}/{repo}/pulls/{pull_number}/requested_reviewers\",\n    \"/repos/{owner}/{repo}/pulls/{pull_number}/reviews\",\n    \"/repos/{owner}/{repo}/releases\",\n    \"/teams/{team_id}/discussions\",\n    \"/teams/{team_id}/discussions/{discussion_number}/comments\",\n];\n","export function routeMatcher(paths) {\n    // EXAMPLE. For the following paths:\n    /* [\n        \"/orgs/{org}/invitations\",\n        \"/repos/{owner}/{repo}/collaborators/{username}\"\n    ] */\n    const regexes = paths.map((path) => path\n        .split(\"/\")\n        .map((c) => (c.startsWith(\"{\") ? \"(?:.+?)\" : c))\n        .join(\"/\"));\n    // 'regexes' would contain:\n    /* [\n        '/orgs/(?:.+?)/invitations',\n        '/repos/(?:.+?)/(?:.+?)/collaborators/(?:.+?)'\n    ] */\n    const regex = `^(?:${regexes.map((r) => `(?:${r})`).join(\"|\")})[^/]*$`;\n    // 'regex' would contain:\n    /*\n      ^(?:(?:\\/orgs\\/(?:.+?)\\/invitations)|(?:\\/repos\\/(?:.+?)\\/(?:.+?)\\/collaborators\\/(?:.+?)))[^\\/]*$\n  \n      It may look scary, but paste it into https://www.debuggex.com/\n      and it will make a lot more sense!\n    */\n    return new RegExp(regex, \"i\");\n}\n","// @ts-expect-error\nimport BottleneckLight from \"bottleneck/light\";\nimport { VERSION } from \"./version\";\nimport { wrapRequest } from \"./wrap-request\";\nimport triggersNotificationPaths from \"./generated/triggers-notification-paths\";\nimport { routeMatcher } from \"./route-matcher\";\n// Workaround to allow tests to directly access the triggersNotification function.\nconst regex = routeMatcher(triggersNotificationPaths);\nconst triggersNotification = regex.test.bind(regex);\nconst groups = {};\n// @ts-expect-error\nconst createGroups = function (Bottleneck, common) {\n    groups.global = new Bottleneck.Group({\n        id: \"octokit-global\",\n        maxConcurrent: 10,\n        ...common,\n    });\n    groups.search = new Bottleneck.Group({\n        id: \"octokit-search\",\n        maxConcurrent: 1,\n        minTime: 2000,\n        ...common,\n    });\n    groups.write = new Bottleneck.Group({\n        id: \"octokit-write\",\n        maxConcurrent: 1,\n        minTime: 1000,\n        ...common,\n    });\n    groups.notifications = new Bottleneck.Group({\n        id: \"octokit-notifications\",\n        maxConcurrent: 1,\n        minTime: 3000,\n        ...common,\n    });\n};\nexport function throttling(octokit, octokitOptions) {\n    const { enabled = true, Bottleneck = BottleneckLight, id = \"no-id\", timeout = 1000 * 60 * 2, // Redis TTL: 2 minutes\n    connection, } = octokitOptions.throttle || {};\n    if (!enabled) {\n        return {};\n    }\n    const common = { connection, timeout };\n    if (groups.global == null) {\n        createGroups(Bottleneck, common);\n    }\n    const state = Object.assign({\n        clustering: connection != null,\n        triggersNotification,\n        minimumSecondaryRateRetryAfter: 5,\n        retryAfterBaseValue: 1000,\n        retryLimiter: new Bottleneck(),\n        id,\n        ...groups,\n    }, octokitOptions.throttle);\n    const isUsingDeprecatedOnAbuseLimitHandler = typeof state.onAbuseLimit === \"function\" && state.onAbuseLimit;\n    if (typeof (isUsingDeprecatedOnAbuseLimitHandler\n        ? state.onAbuseLimit\n        : state.onSecondaryRateLimit) !== \"function\" ||\n        typeof state.onRateLimit !== \"function\") {\n        throw new Error(`octokit/plugin-throttling error:\n        You must pass the onSecondaryRateLimit and onRateLimit error handlers.\n        See https://github.com/octokit/rest.js#throttling\n\n        const octokit = new Octokit({\n          throttle: {\n            onSecondaryRateLimit: (retryAfter, options) => {/* ... */},\n            onRateLimit: (retryAfter, options) => {/* ... */}\n          }\n        })\n    `);\n    }\n    const events = {};\n    const emitter = new Bottleneck.Events(events);\n    // @ts-expect-error\n    events.on(\"secondary-limit\", isUsingDeprecatedOnAbuseLimitHandler\n        ? function (...args) {\n            octokit.log.warn(\"[@octokit/plugin-throttling] `onAbuseLimit()` is deprecated and will be removed in a future release of `@octokit/plugin-throttling`, please use the `onSecondaryRateLimit` handler instead\");\n            return state.onAbuseLimit(...args);\n        }\n        : state.onSecondaryRateLimit);\n    // @ts-expect-error\n    events.on(\"rate-limit\", state.onRateLimit);\n    // @ts-expect-error\n    events.on(\"error\", (e) => octokit.log.warn(\"Error in throttling-plugin limit handler\", e));\n    // @ts-expect-error\n    state.retryLimiter.on(\"failed\", async function (error, info) {\n        const options = info.args[info.args.length - 1];\n        const { pathname } = new URL(options.url, \"http://github.test\");\n        const shouldRetryGraphQL = pathname.startsWith(\"/graphql\") && error.status !== 401;\n        if (!(shouldRetryGraphQL || error.status === 403)) {\n            return;\n        }\n        const retryCount = ~~options.request.retryCount;\n        options.request.retryCount = retryCount;\n        const { wantRetry, retryAfter = 0 } = await (async function () {\n            if (/\\bsecondary rate\\b/i.test(error.message)) {\n                // The user has hit the secondary rate limit. (REST and GraphQL)\n                // https://docs.github.com/en/rest/overview/resources-in-the-rest-api#secondary-rate-limits\n                // The Retry-After header can sometimes be blank when hitting a secondary rate limit,\n                // but is always present after 2-3s, so make sure to set `retryAfter` to at least 5s by default.\n                const retryAfter = Math.max(~~error.response.headers[\"retry-after\"], state.minimumSecondaryRateRetryAfter);\n                const wantRetry = await emitter.trigger(\"secondary-limit\", retryAfter, options, octokit);\n                return { wantRetry, retryAfter };\n            }\n            if (error.response.headers != null &&\n                error.response.headers[\"x-ratelimit-remaining\"] === \"0\") {\n                // The user has used all their allowed calls for the current time period (REST and GraphQL)\n                // https://docs.github.com/en/rest/reference/rate-limit (REST)\n                // https://docs.github.com/en/graphql/overview/resource-limitations#rate-limit (GraphQL)\n                const rateLimitReset = new Date(~~error.response.headers[\"x-ratelimit-reset\"] * 1000).getTime();\n                const retryAfter = Math.max(Math.ceil((rateLimitReset - Date.now()) / 1000), 0);\n                const wantRetry = await emitter.trigger(\"rate-limit\", retryAfter, options, octokit);\n                return { wantRetry, retryAfter };\n            }\n            return {};\n        })();\n        if (wantRetry) {\n            options.request.retryCount++;\n            return retryAfter * state.retryAfterBaseValue;\n        }\n    });\n    octokit.hook.wrap(\"request\", wrapRequest.bind(null, state));\n    return {};\n}\nthrottling.VERSION = VERSION;\nthrottling.triggersNotification = triggersNotification;\n"],"names":["VERSION","noop","Promise","resolve","wrapRequest","state","request","options","retryLimiter","schedule","doRequest","isWrite","method","pathname","URL","url","isSearch","startsWith","isGraphQL","retryCount","jobOptions","priority","weight","clustering","expiration","write","key","id","triggersNotification","notifications","search","req","global","res","data","errors","some","error","type","Object","assign","Error","response","routeMatcher","paths","regexes","map","path","split","c","join","regex","r","RegExp","triggersNotificationPaths","test","bind","groups","createGroups","Bottleneck","common","Group","maxConcurrent","minTime","throttling","octokit","octokitOptions","enabled","BottleneckLight","timeout","connection","throttle","minimumSecondaryRateRetryAfter","retryAfterBaseValue","isUsingDeprecatedOnAbuseLimitHandler","onAbuseLimit","onSecondaryRateLimit","onRateLimit","events","emitter","Events","on","args","log","warn","e","info","length","shouldRetryGraphQL","status","wantRetry","retryAfter","message","Math","max","headers","trigger","rateLimitReset","Date","getTime","ceil","now","hook","wrap"],"mappings":"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"}