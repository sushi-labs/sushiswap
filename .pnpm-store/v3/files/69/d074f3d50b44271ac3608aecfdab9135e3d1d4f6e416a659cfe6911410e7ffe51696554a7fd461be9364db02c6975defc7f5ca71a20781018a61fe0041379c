{"version":3,"file":"index.js","sources":["../dist-src/version.js","../dist-src/node/sign.js","../dist-src/node/verify.js"],"sourcesContent":["export const VERSION = \"3.0.0\";\n","import { createHmac } from \"crypto\";\nimport { VERSION } from \"../version\";\nexport var Algorithm;\n(function (Algorithm) {\n    Algorithm[\"SHA1\"] = \"sha1\";\n    Algorithm[\"SHA256\"] = \"sha256\";\n})(Algorithm || (Algorithm = {}));\nexport async function sign(options, payload) {\n    const { secret, algorithm } = typeof options === \"object\"\n        ? {\n            secret: options.secret,\n            algorithm: options.algorithm || Algorithm.SHA256,\n        }\n        : { secret: options, algorithm: Algorithm.SHA256 };\n    if (!secret || !payload) {\n        throw new TypeError(\"[@octokit/webhooks-methods] secret & payload required for sign()\");\n    }\n    if (!Object.values(Algorithm).includes(algorithm)) {\n        throw new TypeError(`[@octokit/webhooks] Algorithm ${algorithm} is not supported. Must be  'sha1' or 'sha256'`);\n    }\n    return `${algorithm}=${createHmac(algorithm, secret)\n        .update(payload)\n        .digest(\"hex\")}`;\n}\nsign.VERSION = VERSION;\n","import { timingSafeEqual } from \"crypto\";\nimport { Buffer } from \"buffer\";\nimport { sign } from \"./sign\";\nimport { VERSION } from \"../version\";\nconst getAlgorithm = (signature) => {\n    return signature.startsWith(\"sha256=\") ? \"sha256\" : \"sha1\";\n};\nexport async function verify(secret, eventPayload, signature) {\n    if (!secret || !eventPayload || !signature) {\n        throw new TypeError(\"[@octokit/webhooks-methods] secret, eventPayload & signature required\");\n    }\n    const signatureBuffer = Buffer.from(signature);\n    const algorithm = getAlgorithm(signature);\n    const verificationBuffer = Buffer.from(await sign({ secret, algorithm }, eventPayload));\n    if (signatureBuffer.length !== verificationBuffer.length) {\n        return false;\n    }\n    // constant time comparison to prevent timing attachs\n    // https://stackoverflow.com/a/31096242/206879\n    // https://en.wikipedia.org/wiki/Timing_attack\n    return timingSafeEqual(signatureBuffer, verificationBuffer);\n}\nverify.VERSION = VERSION;\n"],"names":["VERSION","Algorithm","sign","options","payload","secret","algorithm","SHA256","TypeError","Object","values","includes","createHmac","update","digest","getAlgorithm","signature","startsWith","verify","eventPayload","signatureBuffer","Buffer","from","verificationBuffer","length","timingSafeEqual"],"mappings":";;;;;;;AAAO,MAAMA,OAAO,GAAG,mBAAhB;;ACEA,IAAIC,SAAJ;;AACP,CAAC,UAAUA,SAAV,EAAqB;AAClBA,EAAAA,SAAS,CAAC,MAAD,CAAT,GAAoB,MAApB;AACAA,EAAAA,SAAS,CAAC,QAAD,CAAT,GAAsB,QAAtB;AACH,CAHD,EAGGA,SAAS,KAAKA,SAAS,GAAG,EAAjB,CAHZ;;AAIA,AAAO,eAAeC,IAAf,CAAoBC,OAApB,EAA6BC,OAA7B,EAAsC;AACzC,QAAM;AAAEC,IAAAA,MAAF;AAAUC,IAAAA;AAAV,MAAwB,OAAOH,OAAP,KAAmB,QAAnB,GACxB;AACEE,IAAAA,MAAM,EAAEF,OAAO,CAACE,MADlB;AAEEC,IAAAA,SAAS,EAAEH,OAAO,CAACG,SAAR,IAAqBL,SAAS,CAACM;AAF5C,GADwB,GAKxB;AAAEF,IAAAA,MAAM,EAAEF,OAAV;AAAmBG,IAAAA,SAAS,EAAEL,SAAS,CAACM;AAAxC,GALN;;AAMA,MAAI,CAACF,MAAD,IAAW,CAACD,OAAhB,EAAyB;AACrB,UAAM,IAAII,SAAJ,CAAc,kEAAd,CAAN;AACH;;AACD,MAAI,CAACC,MAAM,CAACC,MAAP,CAAcT,SAAd,EAAyBU,QAAzB,CAAkCL,SAAlC,CAAL,EAAmD;AAC/C,UAAM,IAAIE,SAAJ,CAAe,iCAAgCF,SAAU,gDAAzD,CAAN;AACH;;AACD,SAAQ,GAAEA,SAAU,IAAGM,iBAAU,CAACN,SAAD,EAAYD,MAAZ,CAAV,CAClBQ,MADkB,CACXT,OADW,EAElBU,MAFkB,CAEX,KAFW,CAEJ,EAFnB;AAGH;AACDZ,IAAI,CAACF,OAAL,GAAeA,OAAf;;ACpBA,MAAMe,YAAY,GAAIC,SAAD,IAAe;AAChC,SAAOA,SAAS,CAACC,UAAV,CAAqB,SAArB,IAAkC,QAAlC,GAA6C,MAApD;AACH,CAFD;;AAGA,AAAO,eAAeC,MAAf,CAAsBb,MAAtB,EAA8Bc,YAA9B,EAA4CH,SAA5C,EAAuD;AAC1D,MAAI,CAACX,MAAD,IAAW,CAACc,YAAZ,IAA4B,CAACH,SAAjC,EAA4C;AACxC,UAAM,IAAIR,SAAJ,CAAc,uEAAd,CAAN;AACH;;AACD,QAAMY,eAAe,GAAGC,aAAM,CAACC,IAAP,CAAYN,SAAZ,CAAxB;AACA,QAAMV,SAAS,GAAGS,YAAY,CAACC,SAAD,CAA9B;AACA,QAAMO,kBAAkB,GAAGF,aAAM,CAACC,IAAP,CAAY,MAAMpB,IAAI,CAAC;AAAEG,IAAAA,MAAF;AAAUC,IAAAA;AAAV,GAAD,EAAwBa,YAAxB,CAAtB,CAA3B;;AACA,MAAIC,eAAe,CAACI,MAAhB,KAA2BD,kBAAkB,CAACC,MAAlD,EAA0D;AACtD,WAAO,KAAP;AACH,GATyD;AAW1D;AACA;;;AACA,SAAOC,sBAAe,CAACL,eAAD,EAAkBG,kBAAlB,CAAtB;AACH;AACDL,MAAM,CAAClB,OAAP,GAAiBA,OAAjB;;;;;"}