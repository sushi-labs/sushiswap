!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).zustandMiddleware={})}(this,(function(t){"use strict";function e(){return e=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},e.apply(this,arguments)}var n=function(t,n){return function(r,i,o){return o.dispatch=function(e){return r((function(n){return t(n,e)}),!1,e),e},o.dispatchFromDevtools=!0,e({dispatch:function(){var t;return(t=o).dispatch.apply(t,arguments)}},n)}},r=["enabled","anonymousActionType"],i=function(t,e){return void 0===e&&(e={}),function(n,i,a){var u,c=e,s=c.enabled,f=c.anonymousActionType,d=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(c,r);try{u=null!=s&&s&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(t){}if(!u)return t(n,i,a);var l=u.connect(d),p=!0;a.setState=function(t,e,r){var o=n(t,e);return p?(l.send(void 0===r?{type:f||"anonymous"}:"string"==typeof r?{type:r}:r,i()),o):o};var v=function(){var t=p;p=!1,n.apply(void 0,arguments),p=t},h=t(a.setState,i,a);if(l.init(h),a.dispatchFromDevtools&&"function"==typeof a.dispatch){var y=a.dispatch;a.dispatch=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];y.apply(void 0,e)}}return l.subscribe((function(t){switch(t.type){case"ACTION":return"string"!=typeof t.payload?void console.error("[zustand devtools middleware] Unsupported action format"):o(t.payload,(function(t){"__setState"!==t.type?a.dispatchFromDevtools&&"function"==typeof a.dispatch&&a.dispatch(t):v(t.state)}));case"DISPATCH":switch(t.payload.type){case"RESET":return v(h),l.init(a.getState());case"COMMIT":return l.init(a.getState());case"ROLLBACK":return o(t.state,(function(t){v(t),l.init(a.getState())}));case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return o(t.state,(function(t){v(t)}));case"IMPORT_STATE":var e,n=t.payload.nextLiftedState,r=null==(e=n.computedStates.slice(-1)[0])?void 0:e.state;if(!r)return;return v(r),void l.send(null,n);case"PAUSE_RECORDING":return p=!p}return}})),h}},o=function(t,e){var n;try{n=JSON.parse(t)}catch(t){console.error("[zustand devtools middleware] Could not parse the received json",t)}void 0!==n&&e(n)},a=function(t){return function(e,n,r){var i=r.subscribe;return r.subscribe=function(t,e,n){var o=t;if(e){var a=(null==n?void 0:n.equalityFn)||Object.is,u=t(r.getState());o=function(n){var r=t(n);if(!a(u,r)){var i=u;e(u=r,i)}},null!=n&&n.fireImmediately&&e(u,u)}return i(o)},t(e,n,r)}},u=function t(e){return function(n){try{var r=e(n);return r instanceof Promise?r:{then:function(e){return t(e)(r)},catch:function(t){return this}}}catch(e){return{then:function(t){return this},catch:function(n){return t(n)(e)}}}}},c=function(t,n){return function(r,i,o){var a,c=e({getStorage:function(){return localStorage},serialize:JSON.stringify,deserialize:JSON.parse,partialize:function(t){return t},version:0,merge:function(t,n){return e({},n,t)}},n),s=!1,f=new Set,d=new Set;try{a=c.getStorage()}catch(t){}if(!a)return t((function(){console.warn("[zustand persist middleware] Unable to update item '"+c.name+"', the given storage is currently unavailable."),r.apply(void 0,arguments)}),i,o);var l=u(c.serialize),p=function(){var t,n=c.partialize(e({},i())),r=l({state:n,version:c.version}).then((function(t){return a.setItem(c.name,t)})).catch((function(e){t=e}));if(t)throw t;return r},v=o.setState;o.setState=function(t,e){v(t,e),p()};var h,y=t((function(){r.apply(void 0,arguments),p()}),i,o),g=function(){if(a){s=!1,f.forEach((function(t){return t(i())}));var t=(null==c.onRehydrateStorage?void 0:c.onRehydrateStorage(i()))||void 0;return u(a.getItem.bind(a))(c.name).then((function(t){if(t)return c.deserialize(t)})).then((function(t){if(t){if("number"!=typeof t.version||t.version===c.version)return t.state;if(c.migrate)return c.migrate(t.state,t.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}})).then((function(t){var e;return h=c.merge(t,null!=(e=i())?e:y),r(h,!0),p()})).then((function(){null==t||t(h,void 0),s=!0,d.forEach((function(t){return t(h)}))})).catch((function(e){null==t||t(void 0,e)}))}};return o.persist={setOptions:function(t){c=e({},c,t),t.getStorage&&(a=t.getStorage())},clearStorage:function(){var t;null==(t=a)||t.removeItem(c.name)},getOptions:function(){return c},rehydrate:function(){return g()},hasHydrated:function(){return s},onHydrate:function(t){return f.add(t),function(){f.delete(t)}},onFinishHydration:function(t){return d.add(t),function(){d.delete(t)}}},g(),h||y}};t.combine=function(t,e){return function(){return Object.assign({},t,e.apply(void 0,arguments))}},t.devtools=i,t.persist=c,t.redux=n,t.subscribeWithSelector=a,Object.defineProperty(t,"__esModule",{value:!0})}));
