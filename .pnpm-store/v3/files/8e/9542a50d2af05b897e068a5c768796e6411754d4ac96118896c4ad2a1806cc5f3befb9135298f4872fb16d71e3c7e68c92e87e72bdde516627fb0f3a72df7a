!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Ganache",[],t):"object"==typeof exports?exports.Ganache=t():e.Ganache=t()}(global,(function(){return function(e){var t={};function __webpack_require__(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,__webpack_require__),r.l=!0,r.exports}return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,n){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(__webpack_require__.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)__webpack_require__.d(n,r,function(t){return e[t]}.bind(null,r));return n},__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=36)}([function(e,t,n){const r=n(1);e.exports={buffer:function(e){let t;return"string"==typeof e?(t=0===e.indexOf("0x")?e.slice(2):e,t=t.length%2==1?"0"+t:t,t=Buffer.from(t,"hex")):t=Buffer.isBuffer(e)?e:Buffer.from(e),t},hex:function(e){if("string"==typeof e){if(0===e.indexOf("0x"))return e.trim();e=new r.BN(e)}if("boolean"==typeof e&&(e=e?1:0),"number"==typeof e)e=r.intToHex(e);else{if(null==e)return"0x";"object"==typeof e&&(e=e.toString("hex"))}return r.addHexPrefix(e)},_rpcQuantityHexString:function(e){return e=(e=this.hex(e)).replace(/^(?:0x)(?:0+(.+?))?$/,"0x$1")},rpcQuantityHexString:function(e){return"0x"===(e=this._rpcQuantityHexString(e))&&(e="0x0"),e},rpcQuantityBuffer:function(e){return"0x0"===(e=this._rpcQuantityHexString(e))&&(e="0x"),r.rlp.encode(e)},rpcDataHexString:function(e,t){if("number"==typeof t)e=this.hex(e).replace("0x",""),e=new Array(t-e.length).fill("0").join("")+e;else{if(0===e.length)return"0x";(e=this.hex(e).replace("0x","")).length%2!=0&&(e="0"+e)}return"0x"+e},nullableRpcDataHexString:function(e,t){if(null===e)return null;{const n=this.rpcDataHexString(e,t);return"0x"===n?null:n}},nullableRpcQuantityHexString:function(e,t){if(null===e)return null;{const n=this._rpcQuantityHexString(e,t);return"0x"===n?null:n}},hexWithZeroPadding:function(e){const t=(e=this.hex(e)).replace("0x","");return 1&t.length?"0x0"+t:e},number:function(e){if("number"==typeof e)return e;if("string"==typeof e&&0!==e.indexOf("0x"))return parseInt(e,10);var t=r.toBuffer(e);return r.bufferToInt(t)},rpcError:function(e,t,n){return JSON.stringify({jsonrpc:"2.0",id:e,error:{code:t,message:n}})}}},function(e,t){e.exports=require("ethereumjs-util")},function(e,t){e.exports=require("util")},function(e,t){e.exports=require("async")},function(e,t){e.exports=require("ethereumjs-common")},function(e,t){e.exports=require("web3-provider-engine/subproviders/subprovider.js")},function(e,t,n){var r=n(2).inherits,o=n(0),i=n(44);function RuntimeError(e,t){Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.results={},this.hashes=[],this.combine(e,t)}r(RuntimeError,Error),RuntimeError.prototype.combine=function(e,t){if(e instanceof RuntimeError)for(var n=e,r=Object.keys(n.results),a=0;a<r.length;a++){var s=r[a];this.results[s]=n.results[s],Array.prototype.push.apply(this.hashes,n.hashes)}else{var c=t.results;for(a=0;a<e.length;a++){var u=e[a],l=c[a];if(l.execResult.exceptionError){var h,p=o.hex(u.hash());this.hashes.push(p);var f=l.execResult.returnValue;if(f&&"08c379a0"===f.slice(0,4).toString("hex"))try{h=i.rawDecode(["string"],f.slice(4))[0]}catch(e){}const e=l.execResult.runState;this.results[p]={error:l.execResult.exceptionError.error||l.execResult.exceptionError,program_counter:e&&e.programCounter,return:o.hex(f),reason:h}}}}if(1===this.hashes.length){var d=this.results[this.hashes[0]],g="VM Exception while processing transaction: "+d.error;d.reason&&(g+=" "+d.reason),this.message=g}else{for(g="Multiple VM Exceptions while processing transactions: \n\n",a=0;a<this.hashes.length;a++)g+=(p=this.hashes[a])+": "+(d=this.results[p]).error,d.reason&&(g+=" "+d.reason),g+="\n";this.message=g}},RuntimeError.prototype.count=function(){return Object.keys(this.results).length},RuntimeError.fromResults=function(e,t){var n=new RuntimeError(e,t);return 0===n.count()?null:n},e.exports=RuntimeError},function(e,t){e.exports=require("level-sublevel")},function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("source-map-support/register")},function(e,t){e.exports=require("ethereumjs-account")},function(e,t,n){const r=n(12).Transaction,o=n(12).FakeTransaction,i=n(4).default,a=n(1),s=n(45),c=a.rlp,u=n(0),l=r.prototype.sign,fakeHash=function(){return null!=this._hash?this._hash:o.prototype.hash.apply(this,arguments)},h=Buffer.from([0]);function fixProps(e,t){e._originals=[];["nonce","gasPrice","gasLimit","value"].forEach(t=>function(e,t,n=32){const r=e._fields.indexOf(t),o=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(e,t,{set:i=>{o.set.call(e,i),i=a.toBuffer(i),s(n>=i.length,`The field ${t} must not have more ${n} bytes`),e._originals[r]=i},get:()=>e._originals[r]})}(e,t,32)),e.isFake()&&(Object.defineProperty(e,"from",{enumerable:!0,configurable:!0,get:e.getSenderAddress.bind(e),set:t=>{e._from=t?a.toBuffer(t):null}}),t&&t.from&&(e.from=t.from),e.hash=fakeHash)}e.exports=class e extends r{constructor(t,n=e.types.none,r){t.chainId&&!r&&(r=i.forCustomChain("mainnet",{name:"ganache",networkId:1,chainId:t.chainId,comment:"Local test network",bootstrapNodes:[]},"muirGlacier")),super(void 0,{common:r}),this.ganacheTxCommon=r,this.type=n,fixProps(this,t),function(e,t){if(t){"string"==typeof t&&(t=u.buffer(t)),Buffer.isBuffer(t)&&(t=c.decode(t));const n=e;if(Array.isArray(t)){if(t.length>e._fields.length)throw new Error("wrong number of fields in data");t.forEach((e,t)=>{n[n._fields[t]]=a.toBuffer(e)})}else{if("object"!=(void 0===t?"undefined":typeof t))throw new Error("invalid data");{const r=Object.keys(t);e._fields.forEach((function(e){if(-1!==r.indexOf(e)){let r=t[e];"string"!=typeof r||r.startsWith("0x")||(r="0x"+r),n[e]=r}"gasLimit"===e?-1!==r.indexOf("gas")&&(n.gas=t.gas):"data"===e&&-1!==r.indexOf("input")&&(n.input=t.input)})),!e._chainId&&t&&null!=t.chainId&&(e.raw[n._fields.indexOf("v")]=e._chainId=t.chainId||0)}}}}(this,t)}static get types(){return{none:0,signed:1,fake:2}}static fromJSON(t,n,r,o,s){let c;if(t.to){const e=u.buffer(t.to);c=e.equals(Buffer.from([0]))?a.setLengthLeft(e,20):e}const l=t.data||t.input,h={nonce:a.toBuffer(u.hex(t.nonce)),from:a.toBuffer(u.hex(t.from)),value:a.toBuffer(u.hex(t.value)),gasLimit:a.toBuffer(u.hex(t.gas||t.gasLimit)),gasPrice:a.toBuffer(u.hex(t.gasPrice)),data:l?u.buffer(l):null,to:c,v:a.toBuffer(t.v),r:a.toBuffer(t.r),s:a.toBuffer(t.s)};if(!r&&h.v.length>0){const e=Math.floor((t.v-35)/2);r=i.forCustomChain("mainnet",{name:"ganache",networkId:o,chainId:e>=0?e:1,comment:"Local test network",bootstrapNodes:[]},s)}const p=new e(h,n,r);return p._hash=t.hash?u.buffer(t.hash):null,p}encode(){return{hash:u.nullableRpcDataHexString(this.hash()),nonce:u.nullableRpcQuantityHexString(this.nonce)||"0x",from:u.rpcDataHexString(this.from),to:u.nullableRpcDataHexString(this.to),value:u.nullableRpcQuantityHexString(this.value),gas:u.nullableRpcQuantityHexString(this.gasLimit),gasPrice:u.nullableRpcQuantityHexString(this.gasPrice),data:this.data?this.data.toString("hex"):null,v:u.nullableRpcQuantityHexString(this.v),r:u.nullableRpcQuantityHexString(this.r),s:u.nullableRpcQuantityHexString(this.s),_type:this.type,_options:{hardfork:this.ganacheTxCommon.hardfork(),chainId:this.ganacheTxCommon.chainId(),networkId:this.ganacheTxCommon.networkId()}}}isFake(){return(this.type&e.types.fake)===e.types.fake}isSigned(){return(this.type&e.types.signed)===e.types.signed}validateNonce(e){let t;return t=this.isSigned()&&0===this.nonce.length?h:this.nonce,t.equals(e)}sign(){l.apply(this,arguments),this.type|=e.types.signed}toJsonRpc(e){const t=this.hash();let n=null;for(let r=0,o=e.transactions,i=o.length;r<i;r++)if(o[r].hash().equals(t)){n=r;break}return{hash:u.nullableRpcDataHexString(t),nonce:u.rpcQuantityHexString(this.nonce),blockHash:u.nullableRpcDataHexString(e.hash()),blockNumber:u.nullableRpcQuantityHexString(e.header.number),transactionIndex:u.nullableRpcQuantityHexString(n),from:u.rpcDataHexString(this.from),to:u.nullableRpcDataHexString(this.to),value:u.rpcQuantityHexString(this.value),gas:u.rpcQuantityHexString(this.gasLimit),gasPrice:u.rpcQuantityHexString(this.gasPrice),input:u.rpcDataHexString(this.data),v:u.nullableRpcQuantityHexString(this.v),r:u.nullableRpcQuantityHexString(this.r),s:u.nullableRpcQuantityHexString(this.s)}}}},function(e,t){e.exports=require("ethereumjs-tx")},function(e,t){e.exports=require("ethereumjs-block")},function(e,t,n){var r=n(0);function Log(e){var t=this;Object.keys(e).forEach((function(n){t[n]=e[n]}))}Log.prototype.toJSON=function(){return{logIndex:r.rpcQuantityHexString(this.logIndex),transactionIndex:r.rpcQuantityHexString(this.transactionIndex),transactionHash:r.rpcDataHexString(this.transactionHash),blockHash:r.rpcDataHexString(this.block.hash()),blockNumber:r.rpcQuantityHexString(this.block.header.number),address:r.rpcDataHexString(this.address),data:r.rpcDataHexString(this.data),topics:this.topics,type:"mined",removed:this.removed||!1}},e.exports=Log},function(e,t,n){var r=n(0);function Receipt(e,t,n,r,o,i,a,s){this.tx=e,this.block=t,this.logs=n,this.gasUsed=r,this.cumulativeGasUsed=o,this.contractAddress=i,this.status=a,this.logsBloom=s,this.transactionIndex=0,this.txHash=e.hash();for(var c=0;c<t.transactions.length;c++){if(t.transactions[c].hash().equals(this.txHash)){this.transactionIndex=c;break}}}Receipt.prototype.toJSON=function(){return{transactionHash:r.rpcDataHexString(this.txHash),transactionIndex:r.rpcQuantityHexString(this.transactionIndex),blockHash:r.rpcDataHexString(this.block.hash()),blockNumber:r.rpcQuantityHexString(this.block.header.number),from:r.rpcDataHexString(this.tx.from),to:r.nullableRpcDataHexString(this.tx.to),gasUsed:r.rpcQuantityHexString(this.gasUsed),cumulativeGasUsed:r.rpcQuantityHexString(this.cumulativeGasUsed),contractAddress:null!=this.contractAddress?r.rpcDataHexString(this.contractAddress):null,logs:this.logs.map((function(e){return e.toJSON()})),status:r.rpcQuantityHexString(this.status),logsBloom:r.rpcDataHexString(this.logsBloom),v:r.rpcQuantityHexString(this.tx.v),r:r.rpcQuantityHexString(this.tx.r),s:r.rpcQuantityHexString(this.tx.s)}},e.exports=Receipt},function(e,t){class n extends Error{constructor(e,t,n){super("LevelUpArrayAdapter named '"+e+"' index out of range: index "+t+"; length: "+n),this.name=`${this.constructor.name}:${e}`,this.type=e}}e.exports={LevelUpOutOfRangeError:n,BlockOutOfRangeError:class extends n{constructor(e,t){super("blocks",e,t)}}}},function(e,t){e.exports=require("events")},function(e,t,n){"use strict";var r=n(77).version,o=n(19),i=n(78),a=n(32),s=n(33),c=n(93),u=n(94),l=n(21),Web3=function(){var e=this;o.packageInit(this,arguments),this.version=r,this.utils=l,this.eth=new i(this),this.shh=new c(this),this.bzz=new u(this);var t=this.setProvider;this.setProvider=function(n,r){return t.apply(e,arguments),e.eth.setRequestManager(e._requestManager),e.shh.setRequestManager(e._requestManager),e.bzz.setProvider(n),!0}};Web3.version=r,Web3.utils=l,Web3.modules={Eth:i,Net:a,Personal:s,Shh:c,Bzz:u},o.addProviders(Web3),e.exports=Web3},function(e,t){e.exports=require("web3-core")},function(e,t){e.exports=require("underscore")},function(e,t){e.exports=require("web3-utils")},function(e,t,n){n(9);const r=n(37),o=n(38),i=n(39),a=n(40),s=n(41),c=n(42),u=n(100),l=n(6),h=n(17),p=n(8);function Provider(e){const t=this;h.call(this),this.options=e=t._applyDefaultOptions(e||{});const n=new c(e,this);this.engine=new r({blockTracker:new u({blockchain:n.state.blockchain})});const l=new o;this.engine.manager=n,this.engine.addProvider(new i),this.engine.addProvider(new a),this.engine.addProvider(l),this.engine.addProvider(new s),this.engine.addProvider(n),this.engine.setMaxListeners(100),this.engine.start(),this.manager=n,this.sendAsync=this.send.bind(this),this.send=this.send.bind(this),this.close=this.close.bind(this),this._queueRequest=this._queueRequest.bind(this),this._processRequestQueue=this._processRequestQueue.bind(this),l.on("data",(function(e,n){t.emit("data",e,n)}))}const f={_chainId:1,_chainIdRpc:1337,vmErrorsOnRPCResponse:!0,verbose:!1,asyncRequestProcessing:!1,logger:{log:function(){}}};Provider.prototype=Object.create(h.prototype),Provider.prototype.constructor=Provider,Provider.prototype._applyDefaultOptions=function(e){return p.merge({},f,e)},Provider.prototype.send=function(e,t){if("function"!=typeof t)throw new Error("No callback provided to provider's send function. As of web3 1.0, provider.send is no longer synchronous and must be passed a callback as its final argument.");const n=this,externalize=function(e){return p.cloneDeep(e)};e=Array.isArray(e)?e.map(externalize):externalize(e);const intermediary=function(r,o){let i;if(o=p.cloneDeep(o),Array.isArray(o)){i=[];for(let t=0;t<o.length;t++)i.push(n.reportErrorInResponse(e[t],r,o[t]))}else i=n.reportErrorInResponse(e,r,o);n.options.verbose&&n.options.logger.log(" <   "+JSON.stringify(i,null,2).split("\n").join("\n <   ")),process.nextTick(()=>t(i.error?r:null,i))};n.options.verbose&&n.options.logger.log("   > "+JSON.stringify(e,null,2).split("\n").join("\n   > ")),n.options.asyncRequestProcessing?n.engine.sendAsync(e,intermediary):n._queueRequest(e,intermediary)},Provider.prototype.close=function(e){this.manager.state.stopMining(),this.manager.state.blockchain.close(e),this.engine.stop()},Provider.prototype._queueRequest=function(e,t){this._requestQueue||(this._requestQueue=[]),this._requestQueue.push({payload:e,callback:t}),setImmediate(this._processRequestQueue)},Provider.prototype._processRequestQueue=function(){const e=this;if(e._requestInProgress)return;e._requestInProgress=!0;const t=e._requestQueue.shift();t?e.engine.sendAsync(t.payload,(n,r)=>{e._requestQueue.length>0&&setImmediate(e._processRequestQueue),t.callback(n,r),e._requestInProgress=!1}):(e._requestInProgress=!1,e._requestQueue.length>0&&setImmediate(e._processRequestQueue))},Provider.prototype.cleanUpErrorObject=function(e,t){if(!e||!t.error)return t;const n={error:{data:{}}};return e.message?(n.error.message=e.message,n.error.data.stack=e.stack,n.error.data.name=e.name,"code"in e&&(n.error.code=e.code)):t.error||(n.error={message:e.toString()}),p.merge(t,n)};const d=new Set(["eth_sendTransaction","eth_sendRawTransaction","personal_sendTransaction"]);Provider.prototype._isTransactionRequest=function(e){return d.has(e.method)},Provider.prototype.reportErrorInResponse=function(e,t,n){const r=this;return t?(r._isTransactionRequest(e)&&t instanceof l&&(n.result=t.hashes[0],r.options.vmErrorsOnRPCResponse?(n.error.data||(n.error.data={}),n.error.data[t.hashes[0]]=t.results[t.hashes[0]]):delete n.error),"eth_call"===e.method&&t instanceof l&&(r.options.vmErrorsOnRPCResponse?(n.error.data||(n.error.data={}),n.error.data[t.hashes[0]]=t.results[t.hashes[0]]):(n.result=t.results[t.hashes[0]].return||"0x",delete n.error)),r.cleanUpErrorObject(t,n)):n},e.exports=Provider},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(48).Buffer,i=n(1),a=n(24),s=n(49),c=n(50),u=n(51),l=n(52);function assert(e,t){if(!e)throw new Error(t||"Assertion failed")}function runCipherBuffer(e,t){return o.concat([e.update(t),e.final()])}var Wallet=function(e,t){if(e&&t)throw new Error("Cannot supply both a private and a public key to the constructor");if(e&&!i.isValidPrivate(e))throw new Error("Private key does not satisfy the curve requirements (ie. it is invalid)");if(t&&!i.isValidPublic(t))throw new Error("Invalid public key");this._privKey=e,this._pubKey=t};Object.defineProperty(Wallet.prototype,"privKey",{get:function(){return assert(this._privKey,"This is a public key only wallet"),this._privKey}}),Object.defineProperty(Wallet.prototype,"pubKey",{get:function(){return this._pubKey||(this._pubKey=i.privateToPublic(this.privKey)),this._pubKey}}),Wallet.generate=function(e){if(!e)return new Wallet(s(32));for(var t=new i.BN("088f924eeceeda7fe92e1f5b0fffffffffffffff",16);;){var n=s(32);if(new i.BN(i.privateToAddress(n)).lte(t))return new Wallet(n)}},Wallet.generateVanityAddress=function(e){for("object"!==(void 0===e?"undefined":r(e))&&(e=new RegExp(e));;){var t=s(32),n=i.privateToAddress(t);if(e.test(n.toString("hex")))return new Wallet(t)}},Wallet.prototype.getPrivateKey=function(){return this.privKey},Wallet.prototype.getPrivateKeyString=function(){return i.bufferToHex(this.getPrivateKey())},Wallet.prototype.getPublicKey=function(){return this.pubKey},Wallet.prototype.getPublicKeyString=function(){return i.bufferToHex(this.getPublicKey())},Wallet.prototype.getAddress=function(){return i.publicToAddress(this.pubKey)},Wallet.prototype.getAddressString=function(){return i.bufferToHex(this.getAddress())},Wallet.prototype.getChecksumAddressString=function(){return i.toChecksumAddress(this.getAddressString())},Wallet.prototype.toV3=function(e,t){assert(this._privKey,"This is a public key only wallet");var n,r=(t=t||{}).salt||s(32),l=t.iv||s(16),h=t.kdf||"scrypt",p={dklen:t.dklen||32,salt:r.toString("hex")};if("pbkdf2"===h)p.c=t.c||262144,p.prf="hmac-sha256",n=a.pbkdf2Sync(o.from(e),r,p.c,p.dklen,"sha256");else{if("scrypt"!==h)throw new Error("Unsupported kdf");p.n=t.n||262144,p.r=t.r||8,p.p=t.p||1,n=c(o.from(e),r,p.n,p.r,p.p,p.dklen)}var f=a.createCipheriv(t.cipher||"aes-128-ctr",n.slice(0,16),l);if(!f)throw new Error("Unsupported cipher");var d=runCipherBuffer(f,this.privKey),g=i.keccak256(o.concat([n.slice(16,32),o.from(d,"hex")]));return{version:3,id:u({random:t.uuid||s(16)}),address:this.getAddress().toString("hex"),crypto:{ciphertext:d.toString("hex"),cipherparams:{iv:l.toString("hex")},cipher:t.cipher||"aes-128-ctr",kdf:h,kdfparams:p,mac:g.toString("hex")}}},Wallet.prototype.getV3Filename=function(e){return["UTC--",(e?new Date(e):new Date).toJSON().replace(/:/g,"-"),"--",this.getAddress().toString("hex")].join("")},Wallet.prototype.toV3String=function(e,t){return JSON.stringify(this.toV3(e,t))},Wallet.fromPublicKey=function(e,t){return t&&(e=i.importPublic(e)),new Wallet(null,e)},Wallet.fromExtendedPublicKey=function(e){return assert("xpub"===e.slice(0,4),"Not an extended public key"),e=l.decode(e).slice(45),Wallet.fromPublicKey(e,!0)},Wallet.fromPrivateKey=function(e){return new Wallet(e)},Wallet.fromExtendedPrivateKey=function(e){assert("xprv"===e.slice(0,4),"Not an extended private key");var t=l.decode(e);return assert(0===t[45],"Invalid extended private key"),Wallet.fromPrivateKey(t.slice(46))},Wallet.fromV1=function(e,t){assert("string"==typeof t);var n="object"===(void 0===e?"undefined":r(e))?e:JSON.parse(e);if("1"!==n.Version)throw new Error("Not a V1 wallet");if("scrypt"!==n.Crypto.KeyHeader.Kdf)throw new Error("Unsupported key derivation scheme");var s=n.Crypto.KeyHeader.KdfParams,u=c(o.from(t),o.from(n.Crypto.Salt,"hex"),s.N,s.R,s.P,s.DkLen),l=o.from(n.Crypto.CipherText,"hex");if(i.keccak256(o.concat([u.slice(16,32),l])).toString("hex")!==n.Crypto.MAC)throw new Error("Key derivation failed - possibly wrong passphrase");var h=runCipherBuffer(a.createDecipheriv("aes-128-cbc",i.keccak256(u.slice(0,16)).slice(0,16),o.from(n.Crypto.IV,"hex")),l);return new Wallet(h)},Wallet.fromV3=function(e,t,n){assert("string"==typeof t);var s,u,l="object"===(void 0===e?"undefined":r(e))?e:JSON.parse(n?e.toLowerCase():e);if(3!==l.version)throw new Error("Not a V3 wallet");if("scrypt"===l.crypto.kdf)u=l.crypto.kdfparams,s=c(o.from(t),o.from(u.salt,"hex"),u.n,u.r,u.p,u.dklen);else{if("pbkdf2"!==l.crypto.kdf)throw new Error("Unsupported key derivation scheme");if("hmac-sha256"!==(u=l.crypto.kdfparams).prf)throw new Error("Unsupported parameters to PBKDF2");s=a.pbkdf2Sync(o.from(t),o.from(u.salt,"hex"),u.c,u.dklen,"sha256")}var h=o.from(l.crypto.ciphertext,"hex");if(i.keccak256(o.concat([s.slice(16,32),h])).toString("hex")!==l.crypto.mac)throw new Error("Key derivation failed - possibly wrong passphrase");var p=runCipherBuffer(a.createDecipheriv(l.crypto.cipher,s.slice(0,16),o.from(l.crypto.cipherparams.iv,"hex")),h);return new Wallet(p)},Wallet.fromEthSale=function(e,t){assert("string"==typeof t);var n="object"===(void 0===e?"undefined":r(e))?e:JSON.parse(e),s=o.from(n.encseed,"hex"),c=a.pbkdf2Sync(t,t,2e3,32,"sha256").slice(0,16),u=runCipherBuffer(a.createDecipheriv("aes-128-cbc",c,s.slice(0,16)),s.slice(16)),l=new Wallet(i.keccak256(u));if(l.getAddress().toString("hex")!==n.ethaddr)throw new Error("Decoded key mismatch - possibly wrong passphrase");return l},e.exports=Wallet},function(e,t){e.exports=require("crypto")},function(e,t,n){var r=n(0),o=n(10).default,i=n(13),a=n(14),s=n(15),c=n(55).default,u=n(4).default,l=n(6),h=n(26),p=n(1),f=n(3),d=n(56),g=n(57),m=n(17),b=n(70),k=n(8),y=n(2).promisify;const v=p.BN;function BlockchainDouble(e){if(m.apply(this),this.options=e=this._applyDefaultOptions(e||{}),this.logger=e.logger||console,this.data=new g(e),null!=e.trie&&null!=e.db_path)throw new Error("Can't initialize a TestRPC with a db and a custom trie.");this.pending_transactions=[],this.blockGasLimit=e.gasLimit,this.defaultTransactionGasLimit=e.defaultTransactionGasLimit,this.timeAdjustment=0}const x={gasLimit:"0x6691b7",defaultTransactionGasLimit:"0x15f90",time:null,debug:!1,hardfork:"muirGlacier",allowUnlimitedContractSize:!1};BlockchainDouble.prototype=Object.create(m.prototype),BlockchainDouble.prototype.constructor=BlockchainDouble,BlockchainDouble.prototype._applyDefaultOptions=function(e){return k.merge(e,x,Object.assign({},e))},BlockchainDouble.prototype.initialize=function(e,t){var n=this;this.data.initialize((function(r){if(r)return t(r);n.latestBlock((function(r,o){if(r)return t(r);var i=n.options,a=null;if(o&&(a=o.header.stateRoot),n.stateTrie=n.createStateTrie(n.data.trie_db,a),n.vm=i.vm||n.createVMFromStateTrie(n.stateTrie,!0),i.time&&n.setTime(i.time),o)return n.emit("block",o),t();n.createGenesisBlock((function(r,o){if(r)return t(r);e=e||[],n.vm.stateManager.checkpoint(()=>{f.eachSeries(e,(function(e,t){n.vm.stateManager.putAccount(p.toBuffer(e.address),e.account,t)}),(function(e){if(e)return t(e);n.vm.stateManager.commit(()=>{n.putBlock(o,[],[],t)})}))})}))}))}))},BlockchainDouble.prototype.createVMFromStateTrie=function(e,t){const n=this,o=u.forCustomChain("mainnet",{name:"ganache",networkId:n.options.network_id||n.forkVersion,chainId:n.options._chainId,comment:"Local test network",bootstrapNodes:[]},n.options.hardfork),i=new c({state:e,common:o,blockchain:{getBlock:function(e,t){try{e=r.number(e)}catch(e){}n.getBlock(e,t)}},activatePrecompiles:t||!1,allowUnlimitedContractSize:n.options.allowUnlimitedContractSize});return!0===n.options.debug&&i.on("step",(function(e){var t=e.opcode.name,o=e.opcode.in;if(o){var i=e.stack.slice(-o).map(e=>r.hex(e)).join(" ");n.logger.log(`${t} ${i}`)}else n.logger.log(t)})),i},BlockchainDouble.prototype.createStateTrie=function(e,t){return new h(e,t)},BlockchainDouble.prototype.createGenesisBlock=function(e){this.createBlock(e)},BlockchainDouble.prototype.latestBlock=function(e){this.data.blocks.last((function(t,n){if(t)return e(t);e(null,n)}))},BlockchainDouble.prototype.getEffectiveBlockNumber=function(e,t){return"string"!=typeof e&&(e=r.hex(e)),e.indexOf("0x")>=0?t(null,r.number(e)):"latest"===e||"pending"===e?this.getHeight(t):"earliest"===e?t(null,0):void 0},BlockchainDouble.prototype.getBlock=function(e,t){var n=this;if("string"!=typeof e&&(e=r.hex(e)),e.indexOf("0x")>=0){var o=e;if(!(o.length>40))return this.data.blocks.get(r.number(o),t);this.data.blockHashes.get(r.hex(o),(function(e,r){return e?t(e):n.data.blocks.get(r,t)}))}else{if("latest"===e||"pending"===e)return this.latestBlock(t);if("earliest"===e)return this.data.blocks.first(t);process.nextTick(t,new Error('Invalid `blockNumber`: "'+e+'"'))}},BlockchainDouble.prototype.putBlock=function(e,t,n,o){var i=this;e.header.stateRoot=this.stateTrie.root,this.data.blocks.length((function(a,s){if(a)return o(a);var c=[i.data.blocks.push.bind(i.data.blocks,e),i.data.blockLogs.push.bind(i.data.blockLogs,t),i.data.blockHashes.set.bind(i.data.blockHashes,r.hex(e.hash()),s)];e.transactions.forEach((function(e,t){var o=r.hex(e.hash());c.push(i.data.transactions.set.bind(i.data.transactions,o,e),i.data.transactionReceipts.set.bind(i.data.transactionReceipts,o,n[t]))})),f.parallel(c,(t,n)=>{t||i.emit("block",e),o(t,n)})}))},BlockchainDouble.prototype.popBlock=function(e){var t=this;this.data.blocks.last((function(n,o){if(n)return e(n);if(null==o)return e(null,null);var i=[],a=r.hex(o.hash());o.transactions.forEach((function(e){var n=r.hex(e.hash());i.push(t.data.transactions.del.bind(t.data.transactions,n),t.data.transactionReceipts.del.bind(t.data.transactionReceipts,n))})),i.push(t.data.blockLogs.pop.bind(t.data.blockLogs),t.data.blockHashes.del.bind(t.data.blockHashes,a),t.data.blocks.pop.bind(t.data.blocks)),f.series(i,(function(n){if(n)return e(n);t.data.blocks.last((function(n,r){if(n)return e(n);t.vm.stateManager.setStateRoot(r.header.stateRoot,(function(t){e(t,o)}))}))}))}))},BlockchainDouble.prototype.clearPendingTransactions=function(){this.pending_transactions=[]},BlockchainDouble.prototype.createBlock=function(e,t,n){var o=this;"function"==typeof e?(n=e,e=null,t=!1):"function"==typeof t&&(n=t,t=!1);var a=new i;!function(t){if(e)return t(null,e);o.latestBlock(t)}((function(e,i){if(e)return n(e);if(a.header.gasLimit=o.blockGasLimit,null!=i&&t)a.header.number=i.header.number,a.header.timestamp=i.header.timestamp,a.header.parentHash=i.header.parentHash;else{var s=null!=i?r.number(i.header.number):-1;a.header.number=r.hex(s+1),a.header.timestamp=r.hex(o.currentTime()),null!=i&&(a.header.parentHash=r.hex(i.hash()))}n(null,a)}))},BlockchainDouble.prototype.getQueuedNonce=function(e,t){var n=null,i=r.buffer(e);if(this.pending_transactions.forEach((function(e){if(e.from.equals(i)){var t=new v(e.nonce);(null===n||t.gt(n))&&(n=t)}})),null!=n)return t(null,n.iaddn(1).toArrayLike(Buffer));this.stateTrie.get(i,(function(e,n){if(e)return t(e);var r=new o(n);t(null,0===r.nonce.length?Buffer.from([0]):r.nonce)}))},BlockchainDouble.prototype.queueTransaction=function(e){this.pending_transactions.push(e)},BlockchainDouble.prototype.sortByPriceAndNonce=function(){var e={};this.pending_transactions.forEach(t=>{const n=t.from.toString("hex"),r=e[n];r?r.push(t):e[n]=[t]});var nonceSort=function(e,t){return parseInt(r.hex(e.nonce),16)-parseInt(r.hex(t.nonce),16)};Object.keys(e).forEach(t=>{e[t].sort(nonceSort)});var t=new d((function(e,t){return parseInt(r.hex(t.gasPrice),16)-parseInt(r.hex(e.gasPrice),16)}));Object.keys(e).forEach(n=>{t.push(e[n].shift())});const n=[];for(;t.size()>0;){const r=t.pop(),o=r.from.toString("hex");e[o].length>0&&t.push(e[o].shift()),n.push(r)}this.pending_transactions=n},BlockchainDouble.prototype.getReadyCall=function(e,t,n,r){const readyCall=(e,n,o)=>{if(n)return r(n);this.createBlock(o,t,(t,n)=>{if(t)return r(t);n.transactions.push(e),n.header.gasLimit=e.gasLimit;const i={tx:e,block:n,skipBalance:!0,skipNonce:!0};r(null,o.header.stateRoot,i)})};"latest"===n?this.latestBlock(readyCall.bind(null,e)):this.getBlock(n,readyCall.bind(null,e))},BlockchainDouble.prototype.readyCall=function(e,t,n,r){this.getReadyCall(e,t,n,(e,t,n)=>{if(e)return void r(e);const o=this.createStateTrie(this.data.trie_db,t,{persist:!1}),i=this.createVMFromStateTrie(o);r(null,i,n)})},BlockchainDouble.prototype.processCall=function(e,t,n){this.readyCall(e,!0,t,async(t,r,o)=>{if(t)return void n(t);const i=await r.runTx(o).catch(e=>({vmerr:e}));let a=i.vmerr;if(a&&a instanceof Error==!1&&(a=new Error("VM error: "+a)),a)return n(a,t);a=l.fromResults([e],{results:[i]}),n(a,i)})},BlockchainDouble.prototype.estimateGas=function(e,t,n){this.getReadyCall(e,!1,t,(e,t,r)=>{if(e)return void n(e);b(()=>{const e=this.createStateTrie(this.data.trie_db,t);return this.createVMFromStateTrie(e)},r,n)})},BlockchainDouble.prototype.processBlock=async function(e,t,n,o){"function"==typeof n&&(o=n,n=!0);const i=await e.runBlock({block:t,generate:!0,skipBlockValidation:!0}).catch(e=>({vmerr:e}));let c=i.vmerr;if(c&&c instanceof Error==!1&&(c=new Error("VM error: "+c)),c)return void o(c);c=l.fromResults(t.transactions,i);var u=[],f=[],d=0;i.results.forEach((function(e){d+=r.number(e.gasUsed)})),t.header.gasUsed=p.toBuffer(r.hex(d));const g=new h,m=new h,b=[],putInTrie=(e,t,n)=>y(e.put.bind(e))(t,n);for(var k=0;k<i.receipts.length;k++){var v=i.results[k],x=i.receipts[k],_=t.transactions[k],w=_.hash(),B=[];if(void 0===v.execResult.exceptionError)for(var S=0;S<x.logs.length;S++){for(var T=x.logs[S],A=r.hex(T[0]),C=[],D=0;D<T[1].length;D++)C.push(r.hex(T[1][D]));var F=r.hex(T[2]),E=new a({logIndex:r.hex(S),transactionIndex:r.hex(k),transactionHash:w,block:t,address:A,data:F,topics:C,type:"mined"});u.push(E),B.push(E)}const e=new s(_,t,B,v.gasUsed.toArrayLike(Buffer),x.gasUsed,v.createdAddress,x.status,r.hex(x.bitvector));f.push(e);const n=[x.status,x.gasUsed,x.bitvector,x.logs],o=p.rlp.encode(n),c=p.rlp.encode(k);b.push(putInTrie(g,c,_.serialize())),b.push(putInTrie(m,c,o))}function done(e){if(e)return o(e);o(c,t.transactions,i)}await Promise.all(b),t.header.transactionsTrie=p.toBuffer(g.root),t.header.receiptTrie=p.toBuffer(m.root),n?this.putBlock(t,u,f,done):done()},BlockchainDouble.prototype.processNextBlock=function(e,t){var n=this;"function"==typeof e&&(t=e,e=void 0),n.sortByPriceAndNonce();for(var o=[],i=0,a=r.number(n.blockGasLimit);n.pending_transactions.length>0;){var s=n.pending_transactions[0],c=r.number(s.gasLimit);if(!(i+c<=a))break;i+=c,n.pending_transactions.shift(),o.push(s)}if(0===o.length&&n.pending_transactions.length>0){return t("Unexpected error condition: next transaction exceeds block gas limit")}this.createBlock((function(i,a){if(i)return t(i);e&&(n.data.blocks.last((function(t,o){t||o&&r.number(o.header.timestamp)>e&&n.logger.log("Waring: Setting the block timestamp ("+e+") that is earlier than the parent block one.")})),a.header.timestamp=r.hex(e),n.setTime(new Date(1e3*e))),Array.prototype.push.apply(a.transactions,o),n.processBlock(n.vm,a,!0,t)}))},BlockchainDouble.prototype.processTransactionTrace=async function(e,t,n){const o=this,i=r.hex(e);let a,s="",c=null;const u={currentDepth:-1,stack:[]},l={gas:0,returnValue:"",structLogs:[]};function stepListener(e,n){const i=r.number(e.gasLeft),s=r.number(c.gasLimit)-i-l.gas;l.gas+=s;let h=null;if(!t.disableMemory&&(h=Buffer.from(e.memory).toString("hex"),h=h.match(/.{1,64}/g)||[],h.length>0)){const e=h[h.length-1];e.length<64&&(h[h.length-1]=e+new Array(64-e.length+1).join("0"))}let p=null;t.disableStack||(p=e.stack.map(e=>r.rpcDataHexString(e,64).replace("0x","")));let f={depth:e.depth,error:"",gas:i,gasCost:0,memory:h,op:e.opcode.name,pc:e.pc,stack:p,storage:null};l.structLogs.length&&(l.structLogs[l.structLogs.length-1].gasCost=s),t.disableStorage?(l.structLogs.push(f),n()):f=o.processStorageTrace(f,u,e,a,(function(e,t){if(e)return n(e);l.structLogs.push(t),n()}))}this.getTransactionReceipt(i,(function(e,t){if(e)return n(e);if(!t)return n(new Error("Unknown transaction "+i));const u=t.block;o.getBlock(u.header.parentHash,(function(e,t){if(e)return n(e);var h=o.createStateTrie(o.data.trie_db,t.header.stateRoot,{forkBlockNumber:r.number(t.header.number)});a=o.createVMFromStateTrie(h),o.createBlock(t,!1,(function(e,t){if(e)return n(e);t.header.timestamp=u.header.timestamp;for(var h=0;h<u.transactions.length;h++){var p=u.transactions[h];if(t.transactions.push(p),r.hex(p.hash())===i)break}function beforeTxListener(e){c=e,s=r.hex(e.hash()),s===i&&a.on("step",stepListener)}function afterTxListener(){s===i&&removeListeners()}function removeListeners(){a.removeListener("step",stepListener),a.removeListener("beforeTx",beforeTxListener),a.removeListener("afterTx",afterTxListener)}a.on("beforeTx",beforeTxListener),a.on("afterTx",afterTxListener),a.stateManager._cache.flush=e=>e(),o.processBlock(a,t,!1,(function(e){e&&0===e.message.indexOf("VM Exception")&&(e=null),removeListeners(),n(e,l)}))}))}))}))},BlockchainDouble.prototype.processStorageTrace=function(e,t,n,o,i){var a,s,c=n.opcode.name;switch(t.currentDepth>n.depth&&t.stack.pop(),t.currentDepth<n.depth&&t.stack.push({}),t.currentDepth=n.depth,c){case"SSTORE":{const o=n.stack,c=o.length;a=r.rpcDataHexString(o[c-1],64).replace("0x",""),s=r.rpcDataHexString(o[c-2],64).replace("0x",""),e.storage=Object.assign({},t.stack[t.currentDepth]),i(null,e),t.stack[t.currentDepth][a]=s}break;case"SLOAD":{const c=n.stack;a=r.rpcDataHexString(c[c.length-1],64).replace("0x",""),o.stateManager.getContractStorage(n.address,Buffer.from(a,"hex"),(function(n,o){if(n)return i(n);s=r.rpcDataHexString(o,64).replace("0x",""),t.stack[t.currentDepth][a]=s,e.storage=Object.assign({},t.stack[t.currentDepth]),i(null,e)}))}break;default:e.storage=Object.assign({},t.stack[t.currentDepth]),i(null,e)}},BlockchainDouble.prototype.getAccount=function(e,t,n){var r=this;this.getBlock(t,(function(t,i){if(t)return n(t);var a=r.stateTrie,s=a.root;r.stateTrie.root=i.header.stateRoot,a.get(p.toBuffer(e),(function(e,t){if(a.root=s,e)return n(e);var r=new o(t);n(null,r)}))}))},BlockchainDouble.prototype.getNonce=function(e,t,n){this.getAccount(e,t,(function(e,t){if(e)return n(e);n(null,t.nonce)}))},BlockchainDouble.prototype.getBalance=function(e,t,n){this.getAccount(e,t,(function(e,t){if(e)return n(e);n(null,t.balance)}))},BlockchainDouble.prototype.getStorage=function(e,t,n,r){var i=this;this.getBlock(n,(function(n,a){if(n)return r(n);var s=i.stateTrie,c=s.root;i.stateTrie.root=a.header.stateRoot,s.get(p.toBuffer(e),(function(e,n){if(null!=e)return s.root=c,r(e);var i=new o(n);s.root=i.stateRoot,s.get(p.setLengthLeft(p.toBuffer(t),32),(function(e,t){if(s.root=c,null!=e)return r(e);r(null,t)}))}))}))},BlockchainDouble.prototype.getCode=function(e,t,n){var r=this;this.getBlock(t,(function(t,i){if(t)return n(t);var a=r.stateTrie,s=a.root;r.stateTrie.root=i.header.stateRoot,a.get(p.toBuffer(e),(function(e,t){if(null!=e)return a.root=s,n(e);new o(t).getCode(a,(function(e,t){if(a.root=s,e)return n(e);n(null,t)}))}))}))},BlockchainDouble.prototype.getTransaction=function(e,t){e=r.hex(e),this.data.transactions.get(e,(function(e,n){if(e)return e.notFound?t(null,null):t(e);t(null,n)}))},BlockchainDouble.prototype.getTransactionReceipt=function(e,t){e=r.hex(e);const n=this.pending_transactions;for(var o=0;o<n.length;o++){if(e===r.hex(n[o].hash()))return t(null,{tx:n[o]})}this.data.transactionReceipts.get(e,(function(e,n){if(e)return e.notFound?t(null,null):t(e);t(e,n)}))},BlockchainDouble.prototype.getBlockLogs=function(e,t){var n=this;this.getEffectiveBlockNumber(e,(function(e,r){if(e)return t(e);n.data.blockLogs.get(r,t)}))},BlockchainDouble.prototype.getHeight=function(e){this.data.blocks.length((function(t,n){if(t)return e(t);e(null,n-1)}))},BlockchainDouble.prototype.currentTime=function(){return((new Date).getTime()/1e3|0)+this.timeAdjustment},BlockchainDouble.prototype.increaseTime=function(e){return e<0&&(e=0),this.timeAdjustment+=e,this.timeAdjustment},BlockchainDouble.prototype.setTime=function(e){var t=(new Date).getTime()/1e3|0,n=e.getTime()/1e3|0;this.timeAdjustment=n-t},BlockchainDouble.prototype.close=function(e){this.data.close(e)},e.exports=BlockchainDouble},function(e,t){e.exports=require("merkle-patricia-tree")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("tmp")},function(e,t,n){var r=n(11),o=n(4).default,i=n(1);e.exports={encode:function(e,t){t(null,e.encode())},decode:function(e,t){const n={hash:e.hash,nonce:e.nonce,value:e.value,to:e.to,from:e.from,gasLimit:e.gas||e.gasLimit,gasPrice:e.gasPrice,data:e.data,v:e.v,r:e.r,s:e.s},a=i.bufferToInt(n.v);let s=Math.floor((a-35)/2);s<0&&(s=0);const c={name:"ganache",chainId:s,networkId:1,comment:"Local test network"};let u="muirGlacier";e._options&&(u=e._options.hardfork,c.chainId=e._options.chainId,c.networkId=e._options.networkId);const l=o.forCustomChain("mainnet",c,u),h=void 0===e._type?r.types.fake:e._type;t(null,r.fromJSON(n,h,l))}}},function(e,t){e.exports=require("web3-core-helpers")},function(e,t){e.exports=require("web3-core-method")},function(e,t){e.exports=require("web3-net")},function(e,t){e.exports=require("web3-eth-personal")},function(e,t,n){function TXRejectedError(e){Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.message=e}(0,n(2).inherits)(TXRejectedError,Error),e.exports=TXRejectedError},function(e,t,n){var r=n(0);e.exports={toJSON:function(e,t){return{number:r.rpcQuantityHexString(e.header.number),hash:r.hex(e.hash()),parentHash:r.hex(e.header.parentHash),mixHash:r.hex(e.header.mixHash),nonce:r.rpcDataHexString(r.hex(e.header.nonce),16),sha3Uncles:r.hex(e.header.uncleHash),logsBloom:r.hex(e.header.bloom),transactionsRoot:r.hex(e.header.transactionsTrie),stateRoot:r.hex(e.header.stateRoot),receiptsRoot:r.hex(e.header.receiptTrie),miner:r.hex(e.header.coinbase),difficulty:r.rpcQuantityHexString(e.header.difficulty),totalDifficulty:r.rpcQuantityHexString(e.header.difficulty),extraData:r.rpcDataHexString(e.header.extraData),size:r.hex(1e3),gasLimit:r.rpcQuantityHexString(e.header.gasLimit),gasUsed:r.rpcQuantityHexString(e.header.gasUsed),timestamp:r.rpcQuantityHexString(e.header.timestamp),transactions:e.transactions.map((function(n){return t?n.toJsonRpc(e):r.hex(n.hash())})),uncles:[]}}}},function(e,t,n){n(9);const r=n(22),o=n(101);e.exports={server:function(e){return o.create(e)},provider:function(e){return new r(e)},_webpacked:!0}},function(e,t){e.exports=require("web3-provider-engine")},function(e,t){e.exports=require("web3-provider-engine/subproviders/subscriptions")},function(e,t,n){var r=n(5);function RequestFunnel(){this.methods={eth_call:!0,eth_getStorageAt:!0,eth_sendTransaction:!0,eth_sendRawTransaction:!0,eth_newBlockFilter:!0,eth_getFilterChanges:!0,eth_getFilterLogs:!0},this.queue=[],this.isWorking=!1}(0,n(2).inherits)(RequestFunnel,r),e.exports=RequestFunnel,RequestFunnel.prototype.handleRequest=function(e,t,n){if(!0!==e.external||!0!==this.methods[e.method])return t();this.queue.push([e,t]),!1===this.isWorking&&this.processNext()},RequestFunnel.prototype.processNext=function(){var e=this;0!==this.queue.length?(this.isWorking=!0,(0,this.queue.shift()[1])((function(t,n,r){if(t)return r(t);r(),e.processNext()}))):this.isWorking=!1}},function(e,t,n){var r=n(5),o=n(2).inherits,i=n(3),a=n(0);function DelayedBlockFilter(){this.watching={}}o(DelayedBlockFilter,r),e.exports=DelayedBlockFilter,DelayedBlockFilter.prototype.handleRequest=function(e,t,n){return"eth_newBlockFilter"===e.method?this.handleNewBlockFilter(e,t,n):"eth_getFilterChanges"===e.method?this.handleGetFilterChanges(e,t,n):void t()},DelayedBlockFilter.prototype.handleNewBlockFilter=function(e,t,n){var r=this;t((function(e,t,n){if(e)return n();r.watching[t]=!0,n()}))},DelayedBlockFilter.prototype.handleGetFilterChanges=function(e,t,n){var r=this,o=e.params[0];if(!this.watching[o])return t();t((function(e,t,n){if(e)return n();var s,c,u;i.series([function(e){0!==t.length?(s=t[0],e()):r.emitPayload({method:"eth_blockNumber"},(function(t,n){if(t)return e(t);u=a.number(n.result),e()}))},function(e){if(u)return e();r.emitPayload({method:"eth_getBlockByHash",params:[s,!1]},(function(t,n){if(t)return e(t);u=a.number(n.result.number),e()}))},function(e){if(0===(u=a.number(u)))return c=void 0,e();u-=1,r.emitPayload({method:"eth_getBlockByNumber",params:[u,!1]},(function(t,n){if(t)return e(t);c=n.result.hash,e()}))}],(function(e){c&&(t[0]=c),delete r.watching[o],n()}))}))}},function(e,t,n){var r=n(5);function GethDefaults(){}(0,n(2).inherits)(GethDefaults,r),e.exports=GethDefaults,GethDefaults.prototype.handleRequest=function(e,t,n){if("eth_estimateGas"!==e.method&&"eth_call"!==e.method)return t();var r=e.params[0];null==r.from?this.emitPayload({method:"eth_coinbase"},(function(e,o){if(e)return n(e);var i=o.result;r.from=i,t()})):t()}},function(e,t,n){var r=n(1),o=n(2).inherits,i=n(43),a=n(0),s=n(34),c=n(35),u=n(99);const{BlockOutOfRangeError:l}=n(16);var h=n(5);const p="0x"+Number.MAX_SAFE_INTEGER.toString(16),f=["v","r","s"];function GethApiDouble(e,t){var n=this;this.state=e.state||new i(e,t),this.options=e,this.initialized=!1,this.initialization_error=null,this.post_initialization_callbacks=[],this.state.initialize((function(e){e&&(n.initialization_error=e),n.initialized=!0;var t=n.post_initialization_callbacks;n.post_initialization_callbacks=[],t.forEach((function(e){setImmediate((function(){e(n.initialization_error,n.state)}))}))}))}o(GethApiDouble,h),GethApiDouble.prototype.waitForInitialization=function(e){!1===this.initialized?this.post_initialization_callbacks.push(e):e(this.initialization_error,this.state)},GethApiDouble.prototype.handleRequest=function(e,t,n){if(null!=this.initialization_error)return n(this.initialization_error);if(!1!==this.initialized){var r=this[e.method];if(null==r)return n(new Error("Method "+e.method+" not supported."));var o=e.params||[],i=[].concat(o),a=!1;if(this.requiresDefaultBlockParameter(e.method)&&i.length<r.length-1&&(i.push("latest"),a=!0),i.push(n),i.length>r.length||void 0!==r.minLength&&i.length<r.minLength||void 0===r.minLength&&i.length<r.length){var s=`Incorrect number of arguments. Method '${e.method}' requires `;return r.minLength?s+=`between ${r.minLength-1} and ${r.length-1} arguments. `:s+=`exactly ${r.length-1} arguments. `,s+=a?"Including the implicit block argument, r":"R",s+=`equest specified ${i.length-1} arguments: ${JSON.stringify(i)}.`,n(new Error(s))}r.apply(this,i)}else this.waitForInitialization(this.getDelayedHandler(e,t,n))},GethApiDouble.prototype.getDelayedHandler=function(e,t,n){var r=this;return function(o,i){o&&n(o),r.handleRequest(e,t,n)}},GethApiDouble.prototype.requiresDefaultBlockParameter=function(e){return!0==={eth_getBalance:!0,eth_getCode:!0,eth_getTransactionCount:!0,eth_getStorageAt:!0,eth_call:!0,eth_estimateGas:!0}[e]},GethApiDouble.prototype.eth_accounts=function(e){e(null,Object.keys(this.state.accounts))},GethApiDouble.prototype.eth_blockNumber=function(e){this.state.blockNumber((function(t,n){if(t)return e(t);e(null,a.hex(n))}))},GethApiDouble.prototype.eth_chainId=function(e){e(null,a.hex(this.options._chainIdRpc))},GethApiDouble.prototype.eth_coinbase=function(e){e(null,this.state.coinbase)},GethApiDouble.prototype.eth_mining=function(e){e(null,this.state.is_mining)},GethApiDouble.prototype.eth_hashrate=function(e){e(null,"0x0")},GethApiDouble.prototype.eth_gasPrice=function(e){e(null,r.addHexPrefix(this.state.gasPrice()))},GethApiDouble.prototype.eth_getBalance=function(e,t,n){this.state.getBalance(e,t,n)},GethApiDouble.prototype.eth_getCode=function(e,t,n){this.state.getCode(e,t,n)},GethApiDouble.prototype.eth_getBlockByNumber=function(e,t,n){this.state.blockchain.getBlock(e,(function(e,r){if(e)return e instanceof l?n(null,null):n(e);n(null,c.toJSON(r,t))}))},GethApiDouble.prototype.eth_getBlockByHash=function(e,t,n){this.eth_getBlockByNumber.apply(this,arguments)},GethApiDouble.prototype.eth_getBlockTransactionCountByNumber=function(e,t){this.state.blockchain.getBlock(e,(function(e,n){if(e)return e instanceof l?t(null,null):t(e);t(null,a.rpcQuantityHexString(n.transactions.length))}))},GethApiDouble.prototype.eth_getBlockTransactionCountByHash=function(e,t){this.eth_getBlockTransactionCountByNumber.apply(this,arguments)},GethApiDouble.prototype.eth_getTransactionReceipt=function(e,t){this.state.getTransactionReceipt(e,(function(e,n){if(e)return t(e);var r=null;n&&n.block&&(r=n.toJSON(),f.forEach(e=>{delete r[e]})),t(null,r)}))},GethApiDouble.prototype.eth_getTransactionByHash=function(e,t){this.state.getTransactionReceipt(e,(function(e,n){if(e)return t(e);var r=null;n&&(n.block||(n.block={transactions:[],hash:()=>null,header:{number:null}}),r=n.tx.toJsonRpc(n.block)),t(null,r)}))},GethApiDouble.prototype.eth_getTransactionByBlockHashAndIndex=function(e,t,n){t=a.number(t),this.state.getBlock(e,(function(e,r){if(e)return e.notFound?n(null,null):n(e);if(t>=r.transactions.length)return n(new Error("Transaction at index "+a.hex(t)+" does not exist in block."));var o=r.transactions[t].toJsonRpc(r);n(null,o)}))},GethApiDouble.prototype.eth_getTransactionByBlockNumberAndIndex=function(e,t,n){this.eth_getTransactionByBlockHashAndIndex(e,t,n)},GethApiDouble.prototype.eth_getTransactionCount=function(e,t,n){this.state.getTransactionCount(e,t,(e,t)=>e instanceof l?n(null,null):n(e,t))},GethApiDouble.prototype.eth_sign=function(e,t,n){var r,o;try{r=this.state.sign(e,t)}catch(e){o=e}n(o,r)},GethApiDouble.prototype.eth_signTypedData=function(e,t,n){var r,o;try{r=this.state.signTypedData(e,t)}catch(e){o=e}n(o,r)},GethApiDouble.prototype.eth_sendTransaction=function(e,t){this.state.queueTransaction("eth_sendTransaction",e,null,t)},GethApiDouble.prototype.eth_sendRawTransaction=function(e,t){let n;if(e&&(n=a.buffer(e)),void 0===n)throw new s("rawTx must be a string, JSON-encoded Buffer, or Buffer.");this.state.queueRawTransaction(n,t)},GethApiDouble.prototype._setCallGasLimit=function(e){if(!e.gas&&!e.gasLimit){const t=this.options.callGasLimit;e.gas=null!=t?t:p}},GethApiDouble.prototype.eth_call=function(e,t,n){this._setCallGasLimit(e),this.state.queueTransaction("eth_call",e,t,n)},GethApiDouble.prototype.eth_estimateGas=function(e,t,n){this._setCallGasLimit(e),this.state.queueTransaction("eth_estimateGas",e,t,n)},GethApiDouble.prototype.eth_getStorageAt=function(e,t,n,r){this.state.queueStorage(e,t,n,r)},GethApiDouble.prototype.eth_newBlockFilter=function(e){var t=r.addHexPrefix(r.intToHex(this.state.latestFilterId));this.state.latestFilterId+=1,e(null,t)},GethApiDouble.prototype.eth_getFilterChanges=function(e,t){var n=this.state.latestBlock().hash().toString("hex");this.state.mine(),t(null,[n])},GethApiDouble.prototype.eth_getLogs=function(e,t){this.state.getLogs(e,t)},GethApiDouble.prototype.eth_uninstallFilter=function(e,t){t(null,!0)},GethApiDouble.prototype.eth_protocolVersion=function(e){e(null,"63")},GethApiDouble.prototype.bzz_hive=function(e){e(null,[])},GethApiDouble.prototype.bzz_info=function(e){e(null,[])},GethApiDouble.prototype.shh_version=function(e){e(null,"2")},GethApiDouble.prototype.eth_getCompilers=function(e){e(null,[])},GethApiDouble.prototype.eth_syncing=function(e){e(null,!1)},GethApiDouble.prototype.net_listening=function(e){e(null,!0)},GethApiDouble.prototype.net_peerCount=function(e){e(null,0)},GethApiDouble.prototype.web3_clientVersion=function(e){e(null,"EthereumJS TestRPC/v"+u.version+"/ethereum-js")},GethApiDouble.prototype.web3_sha3=function(e,t){t(null,a.hex(r.keccak256(e)))},GethApiDouble.prototype.net_version=function(e){e(null,this.state.net_version+"")},GethApiDouble.prototype.miner_start=function(e,t){t||"function"!=typeof e||(t=e,e=null),this.state.startMining((function(e){t(e,!0)}))},GethApiDouble.prototype.miner_start.minLength=1,GethApiDouble.prototype.miner_stop=function(e){this.state.stopMining((function(t){e(t,!0)}))},GethApiDouble.prototype.rpc_modules=function(e){e(null,{eth:"1.0",net:"1.0",rpc:"1.0",web3:"1.0",evm:"1.0",personal:"1.0"})},GethApiDouble.prototype.personal_listAccounts=function(e){e(null,Object.keys(this.state.personal_accounts))},GethApiDouble.prototype.personal_newAccount=function(e,t){var n=this.state.createAccount({generate:!0});this.state.accounts[n.address.toLowerCase()]=n,this.state.personal_accounts[n.address.toLowerCase()]=!0,this.state.account_passwords[n.address.toLowerCase()]=e,t(null,n.address)},GethApiDouble.prototype.personal_importRawKey=function(e,t,n){var r=this.state.createAccount({secretKey:e});this.state.accounts[r.address.toLowerCase()]=r,this.state.personal_accounts[r.address.toLowerCase()]=!0,this.state.account_passwords[r.address.toLowerCase()]=t,n(null,r.address)},GethApiDouble.prototype.personal_lockAccount=function(e,t){if(!0!==this.state.personal_accounts[e.toLowerCase()]){return t("Account not found")}delete this.state.unlocked_accounts[e.toLowerCase()],t(null,!0)},GethApiDouble.prototype.personal_unlockAccount=function(e,t,n,r){if(!0!==this.state.personal_accounts[e.toLowerCase()]){return r("Account not found")}var o=this.state.account_passwords[e.toLowerCase()];if(void 0!==o&&o!==t){return r("Invalid password")}this.state.unlocked_accounts[e.toLowerCase()]=!0,r(null,!0)},GethApiDouble.prototype.personal_sendTransaction=function(e,t,n){if(null!=e.from){var o=r.addHexPrefix(e.from).toLowerCase(),i=this;i.personal_unlockAccount(o,t,null,(function(t){if(t)return n(t);i.state.queueTransaction("eth_sendTransaction",e,null,(function(e,t){i.state.unlocked_accounts[o.toLowerCase()]=!1,n(e,t)}))}))}else{n("Sender not found")}},GethApiDouble.prototype.evm_snapshot=function(e){this.state.snapshot(e)},GethApiDouble.prototype.evm_revert=function(e,t){this.state.revert(e,t)},GethApiDouble.prototype.evm_increaseTime=function(e,t){t(null,this.state.blockchain.increaseTime(e))},GethApiDouble.prototype.evm_setTime=function(e,t){t(null,this.state.blockchain.setTime(new Date(e)))},GethApiDouble.prototype.evm_mine=function(e,t){"function"==typeof e&&(t=e,e=void 0),this.state.processBlock(e,(function(e){if(e)return t(e);t(e,"0x0")}))},GethApiDouble.prototype.evm_mine.minLength=1,GethApiDouble.prototype.evm_unlockUnknownAccount=function(e,t){if(e=e.toLowerCase(),!0!==this.state.unlocked_accounts[e])return!0!==this.state.personal_accounts[e]?(this.state.unlocked_accounts[e]=!0,t(null,!0)):t(new Error("cannot unlock known/personal account"));t(null,!1)},GethApiDouble.prototype.evm_lockUnknownAccount=function(e,t){if(e=e.toLowerCase(),this.state.unlocked_accounts[e])return this.state.personal_accounts[e]?t(new Error("cannot lock known/personal account")):(delete this.state.unlocked_accounts[e],t(null,!0));t(null,!1)},GethApiDouble.prototype.debug_traceTransaction=function(e,t,n){"function"==typeof t&&(n=t,t=[]),this.state.queueTransactionTrace(e,t,n)},GethApiDouble.prototype.eth_getUncleCountByBlockHash=function(e,t){t(null,"0x0")},GethApiDouble.prototype.eth_getUncleCountByBlockNumber=function(e,t){t(null,"0x0")},GethApiDouble.prototype.eth_getUncleByBlockHashAndIndex=function(e,t,n){n(null,{})},GethApiDouble.prototype.eth_getUncleByBlockNumberAndIndex=function(e,t,n){n(null,{})},GethApiDouble.prototype.eth_getWork=function(e,t){t(null,[])},GethApiDouble.prototype.eth_submitWork=function(e,t,n,r){r(null,!1)},GethApiDouble.prototype.eth_submitHashrate=function(e,t,n){n(null,!1)},GethApiDouble.prototype.db_putString=function(e,t,n,r){r(null,!1)},GethApiDouble.prototype.db_getString=function(e,t,n){n(null,"")},GethApiDouble.prototype.db_putHex=function(e,t,n,r){r(null,!1)},GethApiDouble.prototype.db_getHex=function(e,t,n){n(null,"0x00")},GethApiDouble.prototype.shh_post=function(e,t,n,r,o,i,a){a(null,!1)},GethApiDouble.prototype.shh_newIdentity=function(e){e(null,"0x00")},GethApiDouble.prototype.shh_hasIdentity=function(e,t){t(null,!1)},GethApiDouble.prototype.shh_newGroup=function(e){e(null,"0x00")},GethApiDouble.prototype.shh_addToGroup=function(e,t){t(null,!1)},GethApiDouble.prototype.shh_newFilter=function(e,t,n){n(null,!1)},GethApiDouble.prototype.shh_uninstallFilter=function(e,t){t(null,!1)},GethApiDouble.prototype.shh_getFilterChanges=function(e,t){t(null,[])},GethApiDouble.prototype.shh_getMessages=function(e,t){t(null,!1)},e.exports=GethApiDouble},function(e,t,n){var r=n(10).default,o=n(6),i=n(11),a=n(1),s=n(46),c=n(47),u=n(23),l=n(53),h=n(3),p=n(25),f=n(73),d=n(18),g=n(27),m=n(96),b=n(8);const{BlockOutOfRangeError:k}=n(16),y=a.BN,v=n(97),x=n(4).default,_=Buffer.from([0]);var w=n(0),B=n(98),S=n(34);function StateManager(e,t){this.options=e=this._applyDefaultOptions(e||{}),e.fork?this.blockchain=new f(e):this.blockchain=new p(e),this.vm=this.blockchain.vm,this.stateTrie=this.blockchain.stateTrie,this.accounts={},this.secure=!!e.secure,this.account_passwords={},this.personal_accounts={},this.total_accounts=e.total_accounts,this.coinbase=null,this.latest_filter_id=1,this.action_queue=[],this.action_processing=!1,this.snapshots=[],this.logger=e.logger,this.net_version=e.network_id,this.mnemonic=e.mnemonic,this.wallet=l.fromMasterSeed(c.mnemonicToSeed(this.mnemonic)),this.wallet_hdpath=e.hd_path||e.hdPath,this.gasPriceVal=w.rpcQuantityHexString(e.gasPrice),this.is_mining=!0,this.blockTime=e.blockTime,this.is_mining_on_interval=!!e.blockTime,this.mining_interval_timeout=null,this._provider=t}const T={forkCacheSize:1073741824,total_accounts:10,gasPrice:"0x77359400",default_balance_ether:100,unlocked_accounts:[],hdPath:"m/44'/60'/0'/0/"};StateManager.prototype._applyDefaultOptions=function(e){if(e.seed||(e.seed=B.randomAlphaNumericString(10,s())),!e.mnemonic){const t=B.randomBytes(16,s(e.seed));e.mnemonic=c.entropyToMnemonic(t.toString("hex"))}return e.fork||e.network_id||(e.network_id=(new Date).getTime()),b.merge(e,T,Object.assign({},e))},StateManager.prototype.initialize=function(e){var t=this,n=[];const r=w.hex(d.utils.toWei(t.options.default_balance_ether.toString(),"ether"));if(t.options.accounts)n=t.options.accounts.map(t.createAccount.bind(t));else{if(!t.total_accounts)return e(new Error("Cannot initialize chain: either options.accounts or options.total_accounts must be specified"));for(var o=0;o<t.total_accounts;o++)n.push(t.createAccount({index:o,balance:r}))}if(t.coinbase=w.hex(n[0].address),t.accounts={},n.forEach((function(e){t.accounts[e.address]=e,t.personal_accounts[e.address.toLowerCase()]=!0})),t.unlocked_accounts=t.options.unlocked_accounts.reduce((function(e,t){if(0!==(t+"").indexOf("0x")){const e=parseInt(t),r=n[e];if(!r)throw new Error(`Account at index ${e} not found. Max index available is ${n.length-1}.`);t=r.address.toLowerCase()}return e[t.toLowerCase()]=!0,e}),{}),t.secure||n.forEach((function(e){t.unlocked_accounts[e.address.toLowerCase()]=e})),t.options.account_keys_path){const e={addresses:{},private_keys:{}};n.forEach((function(t){e.private_keys[t.address]=t.secretKey.toString("hex"),e.addresses[t.address]=t}));const r=JSON.stringify(e);g.writeFileSync(t.options.account_keys_path,r,"utf8")}t.blockchain.initialize(n,(function(n){if(n)return e(n);t.net_version||(t.net_version=t.blockchain.forkVersion),t.is_mining_on_interval&&t.mineOnInterval(),e()}))},StateManager.prototype._minerCancellationToken=null,StateManager.prototype.mineOnInterval=function(){if(clearTimeout(this.mining_interval_timeout),null!==this._minerCancellationToken&&(this._minerCancellationToken.cancelled=!0),!this.is_mining)return void this.logger.log("Warning: mineOnInterval called when miner was stopped");const e={cancelled:!1};this._minerCancellationToken=e;const t=this.mining_interval_timeout=setTimeout(this._provider.send.bind(this._provider),1e3*this.blockTime,{method:"evm_mine"},()=>{e.cancelled||this.mineOnInterval.bind(this)()});"function"==typeof t.unref&&t.unref()},StateManager.prototype.createAccount=function(e,t){var n;if(e.generate)n=u.generate().getPrivateKey();else if(e.secretKey)n=a.toBuffer(w.hex(e.secretKey));else{var o=void 0===e.index?t:e.index;n=this.wallet.derivePath(this.wallet_hdpath+o).getWallet().getPrivateKey()}var i=a.privateToPublic(n),s=a.publicToAddress(i),c=new r;return c.balance=w.hex(e.balance),{secretKey:n,publicKey:i,address:w.hex(s).toLowerCase(),account:c}},StateManager.prototype.blockNumber=function(e){return this.blockchain.getHeight(e)},StateManager.prototype.gasPrice=function(){return this.gasPriceVal},StateManager.prototype.getBalance=function(e,t,n){this.blockchain.getBalance(e,t,(function(e,t){t&&(t=w.rpcQuantityHexString(t)),n(e,t)}))},StateManager.prototype.getTransactionCount=function(e,t,n){this.blockchain.getNonce(e,t,(function(e,t){t&&(t=w.rpcQuantityHexString(t)),n(e,t)}))},StateManager.prototype.getCode=function(e,t,n){this.blockchain.getCode(e,t,(function(e,t){t&&(t=w.hex(t)),n(e,t)}))},StateManager.prototype.queueRawTransaction=function(e,t){let n;if(Buffer.isBuffer(e)){let t=v.decode(e)[6];void 0!==t&&(t=a.bufferToInt(t),n=Math.floor((t-35)/2),n<0&&(n=0))}const r=n?x.forCustomChain("mainnet",{name:"ganache",networkId:this.options.network_id||this.blockchain.forkVersion,chainId:n,comment:"Local test network",bootstrapNodes:[]},this.options.hardfork):this.blockchain.vm.opts.common,o=new i(e,i.types.signed,r),s=w.hex(o.from).toLowerCase();this._queueTransaction("eth_sendRawTransaction",o,s,null,t)},StateManager.prototype.queueStorage=function(e,t,n,r){this.action_queue.push({method:"eth_getStorageAt",address:a.addHexPrefix(e),position:a.addHexPrefix(t),block:n,callback:r}),this.processNextAction()},StateManager.prototype.queueTransaction=function(e,t,n,r){const o=t.from?w.hex(t.from).toLowerCase():null;if(null==o)return void r(new S("from not found; is required"));if(t.to&&"string"!=typeof t.to)return r(new S("Invalid to address"));const a=Object.prototype.hasOwnProperty,s=a.call(this.accounts,o);if("eth_sendTransaction"===e&&!a.call(this.unlocked_accounts,o)){return r(new S(s?"signer account is locked":"sender account not recognized"))}let c,u=i.types.none;s&&"eth_call"!==e&&"eth_estimateGas"!==e||(u|=i.types.fake);try{c=i.fromJSON(t,u,this.blockchain.vm.opts.common),this._setTransactionDefaults(c,"eth_sendTransaction"===e)}catch(e){return void r(e)}this._queueTransaction(e,c,o,n,r)},StateManager.prototype._setTransactionDefaults=function(e,t){t&&0===e.gasLimit.length&&(e.gasLimit=a.toBuffer(this.blockchain.defaultTransactionGasLimit)),0===e.gasPrice.length&&(e.gasPrice=a.toBuffer(this.gasPriceVal)),0===e.value.length&&(e.value=Buffer.from([0])),(0===e.to.length||e.to.equals(_))&&(e.to=Buffer.allocUnsafe(0))},StateManager.prototype._queueTransaction=function(e,t,n,r,o){if(!(t instanceof i))throw new S("tx must be of type Transaction");if(("eth_sendRawTransaction"===e||"eth_sendTransaction"===e)&&w.number(t.gasLimit)>w.number(this.blockchain.blockGasLimit))return o(new S("Exceeds block gas limit"));this.action_queue.push({method:e,from:n,tx:t,callback:o,blockNumber:r}),this.processNextAction()},StateManager.prototype.queueTransactionTrace=function(e,t,n){this.action_queue.push({method:"debug_traceTransaction",hash:w.hex(e),params:t,callback:n}),this.processNextAction()},StateManager.prototype.processNextAction=function(e){var t=this;if(!0===e||!0!==this.action_processing&&0!==this.action_queue.length){var n=this.action_queue.shift();this.action_processing=!0;var intermediary=function(e,r){n.callback(e,r),t.action_queue.length>0?t.processNextAction(!0):t.action_processing=!1};if("function"==typeof n.method){var r=n.method();return intermediary(null,r)}"eth_getStorageAt"===n.method?this.blockchain.getStorage(n.address,n.position,n.block,(function(e,t){if(e)return intermediary(e);t&&(t=a.rlp.decode(t)),t=w.hex(t||0),intermediary(null,t)})):"debug_traceTransaction"===n.method?this.blockchain.processTransactionTrace(n.hash,n.params,intermediary):"eth_sendTransaction"===n.method||"eth_sendRawTransaction"===n.method?this.processTransaction(n.from,n.tx,intermediary):"eth_call"===n.method?this.processCall(n.from,n.tx,n.blockNumber,intermediary):"eth_estimateGas"===n.method&&this.processGasEstimate(n.from,n.tx,n.blockNumber,intermediary)}},StateManager.prototype.sign=function(e,t){var n=this.accounts[w.hex(e).toLowerCase()];if(!n)throw new Error("cannot sign data; no private key");var r=n.secretKey,o=w.buffer(t,"hex"),i=a.hashPersonalMessage(o),s=a.ecsign(i,Buffer.from(r));const c=s.v-27,u=(c-35)/2;return a.toRpcSig(c,s.r,s.s,u)},StateManager.prototype.signTypedData=function(e,t){var n=this.accounts[w.hex(e).toLowerCase()];if(!n)throw new Error("cannot sign data; no private key");if(!t.types)throw new Error("cannot sign data; types missing");if(!t.types.EIP712Domain)throw new Error("cannot sign data; EIP712Domain definition missing");if(!t.domain)throw new Error("cannot sign data; domain missing");if(!t.primaryType)throw new Error("cannot sign data; primaryType missing");if(!t.message)throw new Error("cannot sign data; message missing");return m.signTypedData_v4(n.secretKey,{data:t})},StateManager.prototype.printTransactionReceipt=function(e,t,n){var r=this;r.blockchain.getTransactionReceipt(e,(function(o,i){if(o)return n(o);r.blockchain.latestBlock((function(o,a){if(o)return n(o);i=i.toJSON(),r.logger.log(""),r.logger.log("  Transaction: "+e),null!=i.contractAddress&&r.logger.log("  Contract created: "+i.contractAddress),r.logger.log("  Gas usage: "+parseInt(i.gasUsed,16)),r.logger.log("  Block Number: "+parseInt(i.blockNumber,16)),r.logger.log("  Block Time: "+new Date(1e3*w.number(a.header.timestamp)).toString()),t&&(r.logger.log("  Runtime Error: "+t.error),t.reason&&r.logger.log("  Revert reason: "+t.reason)),r.logger.log(""),n(null,e)}))}))},StateManager.prototype.processBlock=function(e,t){var n=this;"function"==typeof e&&(t=e,e=null),n.blockchain.processNextBlock(e,(function(e,r,i){if(e&&e instanceof o==!1)return t(e,r,i);h.eachSeries(r,(function(t,r){var o=w.hex(t.hash()),i=null==e?{results:{}}:e;n.printTransactionReceipt(o,i.results[o],r)}),t(e,r,i))}))},StateManager.prototype.processBlocks=function(e,t){var n=this;"function"==typeof e&&(t=e,e=null);var r=null,i=0;h.whilst((function(){return null==e?n.blockchain.pending_transactions.length>0:i<e}),(function(e){n.processBlock((function(t,n,a){if(i+=1,t){if(t instanceof o==!1)return e(t);null==r?r=t:r.combine(t)}e()}))}),(function(e){t(e||r)}))},StateManager.prototype.processCall=function(e,t,n,r){var o=this;function next(e,t){if(e)return r(e);o.blockchain.processCall(t,n,(function(e,t){if(e)return e instanceof k?r(null,null):r(e);var n="0x";return!t.error&&t.execResult.returnValue?n=w.hex(t.execResult.returnValue):t.error&&o.logger.log("Error processing call: "+t.error),r(null,n)}))}0===t.nonce.length?o.createTransactionWithCorrectNonce(t,e,next):next(null,t)},StateManager.prototype.processGasEstimate=function(e,t,n,r){var o=this;function next(e,t){if(e)return r(e);o.blockchain.estimateGas(t,n,(function(e,t){if(e)return r(e);var n="0x";return t.error?o.logger.log("Error calculating gas estimate: "+t.error):n=w.hex(t.gasEstimate),r(null,n)}))}0===t.nonce.length?o.createTransactionWithCorrectNonce(t,e,next):next(null,t)},StateManager.prototype.processTransaction=function(e,t,n){var r=this;r.createTransactionWithCorrectNonce(t,e,(function(e,t){if(e)return n(e);r.blockchain.queueTransaction(t);var o=w.hex(t.hash());if(!1===r.is_mining||r.is_mining_on_interval)return n(null,o);r.processBlocks((function(e){if(e)return n(e);n(null,o)}))}))},StateManager.prototype.getTransactionReceipt=function(e,t){this.blockchain.getTransactionReceipt(e,(function(e,n){if(e&&e.notFound)return t(null,null);t(e,n)}))},StateManager.prototype.getBlock=function(e,t){this.blockchain.getBlock(e,t)},StateManager.prototype.getLogs=function(e,t){var n=this,r=e.address&&(Array.isArray(e.address)?e.address:[e.address]);r=r&&r.map((function(e){return e.toLowerCase()}));var o=e.topics||[];h.parallel({fromBlock:this.blockchain.getEffectiveBlockNumber.bind(this.blockchain,e.fromBlock||"latest"),toBlock:this.blockchain.getEffectiveBlockNumber.bind(this.blockchain,e.toBlock||"latest"),latestBlock:this.blockchain.getEffectiveBlockNumber.bind(this.blockchain,"latest"),block:this.blockchain.getBlock.bind(this.blockchain,e.blockHash||0)},(function(i,a){if(i)return t(i);var s=a.fromBlock,c=a.toBlock,u=a.latestBlock,l=a.block;c>u&&(c=u),e.blockHash&&(s=w.number(l.header.number),c=w.number(l.header.number));var p=[],f=s;h.whilst((function(){return f<=c}),(function(e){n.blockchain.getBlockLogs(f,(function(t,n){if(t)return e(t);var i=r?n.filter((function(e){return r.indexOf(e.address.toLowerCase())>-1})):n;i=i.filter((function(e){for(var t=!0,n=0;n<o.length;n++){var r=o[n],i=e.topics[n];if(null!=r){var a=Array.isArray(r)?r.includes(i):r===i;if(n>=e.topics.length||!a){t=!1;break}}}return t})),p.push.apply(p,i),f+=1,e()}))}),(function(e){if(e)return t(e);p=p.map((function(e){return e.toJSON()})),t(e,p)}))}))},StateManager.prototype.snapshot=function(e){var t=this;this.blockchain.getHeight((function(n,r){if(n)return e(n);t.snapshots.push({blockNumber:r,timeAdjustment:t.blockchain.timeAdjustment}),t.logger.log("Saved snapshot #"+t.snapshots.length),e(null,w.hex(t.snapshots.length))}))},StateManager.prototype.revert=function(e,t){var n=this;if(null!=e){try{e=a.bufferToInt(e)}catch(e){return void t(e)}if(this.logger.log("Reverting to snapshot #"+e),e>this.snapshots.length||e<=0)return t(null,!1),!1;e-=1;var r=this.snapshots[e].timeAdjustment;h.whilst((function(){return n.snapshots.length>e}),(function(e){var t=n.snapshots.pop();h.during((function(e){n.blockchain.getHeight((function(n,r){if(n)return e(n);e(null,r>t.blockNumber)}))}),(function(e){n.blockchain.popBlock((function(t){if(t)return e(t);e()}))}),e)}),(function(e){if(e)return t(e);n.blockchain.clearPendingTransactions(),n.blockchain.timeAdjustment=r,t(null,!0)}))}else t(new Error("invalid snapshotId"))},StateManager.prototype.hasContractCode=function(e,t){this.vm.stateManager.getContractCode(e,(function(e,n){null!=e?t(e,!1):t(null,!0)}))},StateManager.prototype.startMining=function(e){if(this.is_mining)return process.nextTick(e),void this.logger.log("Warning: startMining called when miner was already started");this.is_mining=!0,this.is_mining_on_interval?(this.mineOnInterval(),process.nextTick(e)):this.processBlocks(e)},StateManager.prototype.stopMining=function(e){this.is_mining?(this._minerCancellationToken&&(this._minerCancellationToken.cancelled=!0,this._minerCancellationToken=null),this.is_mining=!1,clearTimeout(this.mining_interval_timeout),this.mining_interval_timeout=null):this.logger.log("Warning: stopMining called when miner was already stopped"),e&&process.nextTick(e)},StateManager.prototype.isUnlocked=function(e){return null!=this.unlocked_accounts[e.toLowerCase()]},StateManager.prototype.createTransactionWithCorrectNonce=function(e,t,n){this.blockchain.getQueuedNonce(t,(r,o)=>{if(r)return n(r);const validateNonce=(e,t)=>{if(e.validateNonce(t))return Promise.resolve(e);{const n=new y(t).toString(10),r=new y(e.nonce).toString(10);return Promise.reject(new S(`the tx doesn't have the correct nonce. account has nonce of: ${n} tx has nonce of: ${r}`))}},done=e=>n(null,e);if(e.isSigned())validateNonce(e,o).then(done).catch(n);else{const sign=e=>{if(!e.isFake()&&!e.isSigned()){const n=this.accounts[t];n&&e.sign(n.secretKey)}return Promise.resolve(e)};0===e.nonce.length?(e.nonce=o,sign(e).then(done)):validateNonce(e,o).then(sign).then(done).catch(n)}})},e.exports=StateManager},function(e,t){e.exports=require("ethereumjs-abi")},function(e,t){e.exports=require("assert")},function(e,t){e.exports=require("seedrandom")},function(e,t){e.exports=require("bip39")},function(e,t){e.exports=require("safe-buffer")},function(e,t){e.exports=require("randombytes")},function(e,t){e.exports=require("scryptsy")},function(e,t){e.exports=require("uuid/v4")},function(e,t){e.exports=require("bs58check")},function(e,t,n){"use strict";var r=n(54).HDKey,o=n(23);function EthereumHDKey(){}function fromHDKey(e){var t=new EthereumHDKey;return t._hdkey=e,t}EthereumHDKey.fromMasterSeed=function(e){return fromHDKey(r.fromMasterSeed(e))},EthereumHDKey.fromExtendedKey=function(e){return fromHDKey(r.fromExtendedKey(e))},EthereumHDKey.prototype.privateExtendedKey=function(){if(!this._hdkey.privateExtendedKey)throw new Error("This is a public key only wallet");return this._hdkey.privateExtendedKey},EthereumHDKey.prototype.publicExtendedKey=function(){return this._hdkey.publicExtendedKey},EthereumHDKey.prototype.derivePath=function(e){return fromHDKey(this._hdkey.derive(e))},EthereumHDKey.prototype.deriveChild=function(e){return fromHDKey(this._hdkey.deriveChild(e))},EthereumHDKey.prototype.getWallet=function(){return this._hdkey._privateKey?o.fromPrivateKey(this._hdkey._privateKey):o.fromPublicKey(this._hdkey._publicKey,!0)},e.exports=EthereumHDKey},function(e,t){e.exports=require("ethereum-cryptography/hdkey")},function(e,t){e.exports=require("ethereumjs-vm")},function(e,t){e.exports=require("heap")},function(e,t,n){var r=n(58),o=n(59),i=n(60),a=n(61),s=n(62),c=n(65),u=n(29),l=n(66),h=n(67),p=n(68),f=n(69),d=n(28);function Database(e){this.options=e,this.directory=null}Database.prototype.initialize=function(e){var t,n=this;function finishInitializing(t,i){if(t)return e(t);n.db=i,n.blocks=new r("blocks",n.db,l),n.blockLogs=new r("blockLogs",n.db,new p(n)),n.blockHashes=new o("blockHashes",n.db),n.transactions=new o("transactions",n.db,u),n.transactionReceipts=new o("transactionReceipts",n.db,new f(n)),n.trie_db=new o("trie_db",n.db,h,h),e()}t=function(t,r){if(t)return e(t);const o={valueEncoding:"json"};if(n.options.db){const e=n.options.db;i(e,o,finishInitializing)}else{n.directory=r;const e=a(c(r,s).maxSize(100),o);i(e,{},finishInitializing)}},n.options.db_path?t(null,n.options.db_path):d.dir(t)},Database.prototype.close=function(e){e()},e.exports=Database},function(e,t,n){var r=n(7);const{LevelUpOutOfRangeError:o,BlockOutOfRangeError:i}=n(16);function LevelUpArrayAdapter(e,t,n){this.db=r(t),this.db=this.db.sublevel(e),this.name=e,this.serializer=n||{encode:function(e,t){t(null,e)},decode:function(e,t){t(null,e)}}}LevelUpArrayAdapter.prototype.length=function(e){this.db.get("length",(function(t,n){if(t)return t.notFound?e(null,0):e(t);e(null,n)}))},LevelUpArrayAdapter.prototype._get=function(e,t){var n=this;this.db.get(e,(function(e,r){if(e)return t(e);n.serializer.decode(r,t)}))},LevelUpArrayAdapter.prototype._put=function(e,t,n){var r=this;this.serializer.encode(t,(function(t,o){if(t)return n(t);r.db.put(e,o,n)}))},LevelUpArrayAdapter.prototype.get=function(e,t){var n=this;this.length((function(r,a){if(r)return t(r);if(e>=a){const r="blocks"===n.name?new i(e,a):new o(n.name,e,a);return t(r)}n._get(e,t)}))},LevelUpArrayAdapter.prototype.push=function(e,t){var n=this;this.length((function(r,o){if(r)return t(r);n._put(o+"",e,(function(e){if(e)return t(e);n.db.put("length",o+1,t)}))}))},LevelUpArrayAdapter.prototype.pop=function(e){var t=this;this.length((function(n,r){if(n)return e(n);var o=r-1;t._get(o+"",(function(n,r){if(n)return e(n);t.db.del(o+"",(function(n){if(n)return e(n);t.db.put("length",o,(function(t){if(t)return e(t);e(null,r)}))}))}))}))},LevelUpArrayAdapter.prototype.last=function(e){var t=this;this.length((function(n,r){return n?e(n):0===r?e(null,null):void t._get(r-1+"",e)}))},LevelUpArrayAdapter.prototype.first=function(e){this._get("0",e)},e.exports=LevelUpArrayAdapter},function(e,t,n){var r=n(7),o=n(3);function LevelUpObjectAdapter(e,t,n,o,i){this.db=r(t,i),this.db=this.db.sublevel(e),this.name=e,this.valueserializer=n||{encode:function(e,t){t(null,e)},decode:function(e,t){t(null,e)}},this.keyserializer=o||{encode:function(e,t){t(null,e)},decode:function(e,t){t(null,e)}}}LevelUpObjectAdapter.prototype.get=function(e,t,n){var r=this;"function"==typeof t&&(n=t,t={}),this.keyserializer.encode(e,(function(e,t){if(e)return n(e);r.db.get(t,(function(e,t){if(e)return n(e);r.valueserializer.decode(t,(function(e,t){if(e)return n(e);n(null,t)}))}))}))},LevelUpObjectAdapter.prototype.put=function(e,t,n,r){var o=this;"function"==typeof n&&(r=n,n={}),this.keyserializer.encode(e,(function(e,n){if(e)return r(e);o.valueserializer.encode(t,(function(e,t){if(e)return r(e);o.db.put(n,t,r)}))}))},LevelUpObjectAdapter.prototype.set=LevelUpObjectAdapter.prototype.put,LevelUpObjectAdapter.prototype.del=function(e,t){var n=this;this.keyserializer.encode(e,(function(e,r){if(e)return t(e);n.db.del(r,t)}))},LevelUpObjectAdapter.prototype.batch=function(e,t,n){var r=this;o.each(e,(function(e,n){"put"===e.type?r.put(e.key,e.value,t,n):"del"===e.type?r.del(e.key,n):n(new Error("Unknown batch type",e.type))}),(function(e){if(e)return n(e);n()}))},LevelUpObjectAdapter.prototype.isOpen=function(){return!0},e.exports=LevelUpObjectAdapter},function(e,t){e.exports=require("levelup")},function(e,t){e.exports=require("encoding-down")},function(e,t,n){var r=n(2),o=n(63).AbstractLevelDOWN,i=n(3),a=n(27),s=n(64),c=n(28);function FileDown(e){this.location=e;const t=s.join(e,"_tmp");try{a.mkdirSync(t,{recursive:!0,mode:1023})}catch(e){if("EEXIST"!==e.code)throw e}this.tmpOptions={keep:!0,dir:t},o.call(this,e)}r.inherits(FileDown,o),FileDown.prototype._open=function(e,t){t(null,this)};const u={next:e=>{const t=u.cache[e].shift();t?t():delete u.cache[e]},execute:(e,t)=>{const n=u.cache[e];n?n.push(t):(u.cache[e]=[],t())},cache:{}},l=new Set,cleanup=e=>{try{l.forEach(e=>{const[t,n]=e;try{a.closeSync(t)}catch(e){}finally{try{a.unlinkSync(n)}catch(e){}}}),l.clear()}finally{e&&process.exit(0)}};process.on("SIGINT",cleanup),process.on("exit",()=>cleanup(!1)),FileDown.prototype._put=function(e,t,n,r){const o=s.join(this.location,e);u.execute(o,()=>{c.file(this.tmpOptions,(e,n,i,s)=>{if(e)return r(e),void u.next(o);const c=[i,n];l.add(c);const cleanupAndCallback=e=>{e&&s(),l.delete(c),r(e),u.next(o)};a.writeFile(i,t,"utf8",e=>{e?cleanupAndCallback(e):a.rename(n,o,e=>{e?cleanupAndCallback(e):a.close(i,()=>cleanupAndCallback())})})})})},FileDown.prototype._get=function(e,t,n){const r=s.join(this.location,e);u.execute(r,()=>{a.readFile(r,"utf8",(e,t)=>{e?n(new Error("NotFound")):n(null,t),u.next(r)})})},FileDown.prototype._del=function(e,t,n){a.unlink(s.join(this.location,e),(function(e){if(e)return e.message.indexOf("ENOENT")>=0?n():n(e);n()}))},FileDown.prototype._batch=function(e,t,n){var r=this;i.each(e,(function(e,n){"put"===e.type?r.put(e.key,e.value,t,n):"del"===e.type?r.del(e.key,t,n):n(new Error("Unknown batch type",e.type))}),(function(e){if(e)return n(e);n()}))},e.exports=function(e){return new FileDown(e)}},function(e,t){e.exports=require("abstract-leveldown")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("cachedown")},function(e,t,n){var r=n(29),o=n(3),i=n(13);e.exports={encode:function(e,t){var n=e.toJSON(!0);o.map(e.transactions,(function(e,t){r.encode(e,t)}),(function(e,r){if(e)return t(e);n.transactions=r,t(null,n)}))},decode:function(e,t){var n=e.transactions;e.transactions=[];var a=new i(e);o.eachSeries(n,(function(e,t){r.decode(e,(function(e,n){if(e)return t(e);a.transactions.push(n),t()}))}),(function(e){if(e)return t(e);t(null,a)}))}}},function(e,t,n){var r=n(1),o=n(0);e.exports={encode:function(e,t){t(null,o.hex(e))},decode:function(e,t){t(null,r.toBuffer(e))}}},function(e,t,n){var r=n(14),o=n(3);function BlockLogsSerializer(e){this.database=e}BlockLogsSerializer.prototype.encode=function(e,t){t(null,e=e.map((function(e){return e.toJSON()})))},BlockLogsSerializer.prototype.decode=function(e,t){var n=this;if(0===e.length)return t(null,[]);this.database.blockHashes.get(e[0].blockHash,(function(i,a){if(i)return t(i);n.database.blocks.get(a,(function(n,i){if(n)return t(n);o.map(e,(function(e,t){t(null,new r({block:i,logIndex:e.logIndex,transactionIndex:e.transactionIndex,transactionHash:e.transactionHash,address:e.address,data:e.data,topics:e.topics,type:e.type}))}),(function(e,n){if(e)return t(e);t(null,n)}))}))}))},e.exports=BlockLogsSerializer},function(e,t,n){var r=n(15),o=n(3);function ReceiptSerializer(e){this.database=e}ReceiptSerializer.prototype.encode=function(e,t){t(null,e.toJSON())},ReceiptSerializer.prototype.decode=function(e,t){var n=this,i=e.transactionHash.toLowerCase();this.database.transactions.get(e.transactionHash,(function(a,s){if(a)return t(a);n.database.blockHashes.get(e.blockHash,(function(a,c){if(a)return t(a);o.parallel({block:n.database.blocks.get.bind(n.database.blocks,c),logs:n.database.blockLogs.get.bind(n.database.blockLogs,c)},(function(n,o){if(n)return t(n);t(null,new r(s,o.block,o.logs.filter(e=>e.transactionHash.toLowerCase()===i),e.gasUsed,e.cumulativeGasUsed,e.contractAddress,e.status,e.logsBloom))}))}))}))},e.exports=ReceiptSerializer},function(e,t,n){const r=n(71),o=n(72);e.exports=async(e,t,n)=>{const i=e();r(i,t,async(r,i)=>{r?n(r):await o(e,t,i,n)})}},function(e,t,n){const r=n(6),{BN:o}=n(1),bn=(e=0)=>new o(e),i=bn(2300),check=e=>t=>e.has(t),a=check(new Set(["CALL","DELEGATECALL","STATICCALL","CALLCODE"])),s=check(new Set(["CALL","CALLCODE"])),c=check(new Set(["CREATE","CREATE2"])),u=check(new Set(["STOP","RETURN","REVERT","INVALID","SELFDESTRUCT"]));e.exports=async(e,t,n)=>{const o=stepTracker();e.on("step",o.collect);const Context=(e,t)=>{const n=0===e;let r=e,a=0;const c=bn();let u=bn();const l=o.ops[e],h=o.ops[e+1],p=l.gasLeft.sub(h.gasLeft),f=t||bn();let d=!1;function addGas(e){u.gtn(0)&&(e.gte(u)?u=bn():u.isub(e)),c.iadd(e)}return{start:()=>r,stop:()=>a,setStart:e=>{r=e,d=!0},setStop:e=>{a=e},getCost:()=>({cost:c,sixtyFloorths:u}),transfer:e=>{const t=e.getCost();addGas(t.cost),u.iadd(t.sixtyFloorths)},addSixtyFloorth:e=>{u.iadd(e)},addRange:(e=bn())=>{addGas(o.ops[n||d?r:r+1].gasLeft.sub(o.ops[a].gasLeft).add(e))},finalizeRange:()=>{let e;if(d&&a!==o.ops.length-1){e=o.ops[r].gasLeft.sub(o.ops[a-1].gasLeft),addGas(e);e=o.ops[a-1].gasLeft.sub(o.ops[a].gasLeft).add(p)}else e=o.ops[r].gasLeft.sub(o.ops[a].gasLeft);if(e.isub(f),addGas(e),s(l.opcode.name)&&!l.stack[l.stack.length-3].isZero()){c.iadd(u);const e=h.gasLeft.sub(o.ops[a-1].gasLeft);e.gt(i)?u=c.divn(63):e.lte(i)&&(u=i.sub(e))}else a!==o.ops.length-1&&(c.iadd(u),u=c.divn(63))}}},l=await e.runTx(t).catch(e=>({vmerr:e})),h=l.vmerr;if(h)return n(h);if(l.execResult.exceptionError){return n(r.fromResults([t.tx],{results:[l]}),l)}if(o.done()){const e=l.gasUsed;l.gasEstimate=e}else{const e=o.ops[0].gasLeft.sub(o.ops[o.ops.length-1].gasLeft),t=(()=>{const e=o.systemOps,t=o.ops,opIndex=t=>e[t].index,n=[];let r=0,s=Context(0);for(;r<e.length;){const e=opIndex(r),l=t[e],h=l.opcode.name;if(a(h)||c(h))o.isPrecompile(e)?(s.setStop(e+1),s.addRange(),s.setStart(e+1),s.addSixtyFloorth(i)):(s.setStop(e),s.addRange(bn(l.opcode.fee)),n.push(s),s=Context(e,bn(l.opcode.fee)));else{if(!u(h))throw new Error("INVALID OPCODE");{s.setStop(e+1<o.ops.length?e+1:e),s.finalizeRange();const t=n.pop();if(!t)break;t.transfer(s),s=t,s.setStart(e+1)}}r++}const l=s.getCost();return l.cost.add(l.sixtyFloorths)})().sub(e);l.gasEstimate=l.gasUsed.add(t)}n(h,l)};const stepTracker=()=>{const e=[],t=[],n=new Set;let r=!1,o=0;return{collect:i=>{r&&(i.depth===o&&n.add(t.length-1),r=!1),a(i.opcode.name)?(i.stack=i.stack.map(e=>e.clone()),r=!0,o=i.depth,e.push({index:t.length,depth:i.depth,name:i.opcode.name})):(c(i.opcode.name)||u(i.opcode.name))&&e.push({index:t.length,depth:i.depth,name:i.opcode.name}),t.push(i)},isPrecompile:e=>n.has(e),done:()=>!t.length||e.length<2||!u(t[t.length-1].opcode.name),ops:t,systemOps:e}}},function(e,t,n){const{BN:r}=n(1);e.exports=async function(e,t,n,o){const i=((e=0)=>new r(parseInt("0x"+e.toString("hex"),16)))(t.block.header.gasLimit),a=n.execResult.gasRefund,s=a?n.gasEstimate.add(a):n.gasEstimate,c={lo:s,hi:s},isEnoughGas=async n=>{const r=e();t.tx.gasLimit=n.toBuffer();const o=await r.runTx(t).catch(e=>({vmerr:e}));return!o.vmerr&&!o.execResult.exceptionError};if(!await isEnoughGas(c.hi)){do{c.hi=c.hi.muln(64/63)}while(!await isEnoughGas(c.hi));for(;c.lo.addn(1).lt(c.hi);){const e=c.lo.add(c.hi).divn(2);await isEnoughGas(e)?c.hi=e:c.lo=e}if(c.hi.gte(i)&&!await isEnoughGas(c.hi))return o(new Error("gas required exceeds allowance or always failing transaction"))}n.gasEstimate=c.hi,o(null,n)}},function(e,t,n){var r=n(25),o=n(10).default,i=n(13),a=n(14),s=n(15),c=n(1),u=n(74),l=n(18),h=n(0),p=n(11),f=n(3),d=n(95);const g=n(7),m=c.BN;(0,n(2).inherits)(ForkedBlockchain,r);const b=/^https?:/i,k=/^[A-Za-z][A-Za-z0-9+\-.]*:/,y=/^(?:http|ws)s?:/i,v=/@([0-9]+)$/;function cloneWithoutId(e){return Object.assign({},e,{id:null})}function ForkedBlockchain(e){if(this.options=e||{},null==e.fork||"string"==typeof e.fork&&0===e.fork.trim().length)throw new Error("ForkedBlockchain must be passed a fork parameter.");if(this.forkVersion=null,"string"==typeof e.fork){const t=v.exec(e.fork);let n;if(t&&(e.fork=e.fork.slice(0,t.index),e.fork_block_number=parseInt(t[1],10)),k.test(e.fork)){if(!y.test(e.fork))throw new Error(`Invalid scheme for fork url: ${e.fork}. Supported schemes are: http, https, ws, and wss.`);n=b.test(e.fork)?new l.providers.HttpProvider(e.fork):new l.providers.WebsocketProvider(e.fork)}else e.fork="ws://"+e.fork,n=new l.providers.WebsocketProvider(e.fork);this.fork=n}else this.fork=e.fork;if(this.forkBlockNumber=e.fork_block_number,this.forkCacheSize=parseInt(e.forkCacheSize),!isNaN(this.forkCacheSize)&&0!==this.forkCacheSize){const e=this.fork.send,t=new d({max:-1===this.forkCacheSize?0:this.forkCacheSize,length:(e,t)=>Buffer.byteLength(e)+Buffer.byteLength(t,"utf8")}),n=new Map;this.fork.send=(r,o)=>{let i;const a=Array.isArray(r);i=a?r:[r],Promise.all(i.map(async r=>{const o=JSON.stringify(cloneWithoutId(r));let i=n.get(o);i&&i.payload!==r&&await i.promise;const a=t.get(o);if(a){const e=JSON.parse(a.toString());return e.id=r.id,Promise.resolve({error:null,result:e})}{const a=new Promise(n=>{e.call(this.fork,r,(e,r)=>{e||t.set(o,Buffer.from(JSON.stringify(cloneWithoutId(r)))),n({error:e,result:r})})});return i={payload:r,promise:a},n.set(o,i),a.catch(()=>{}).then(()=>{n.delete(o)}),a}})).then(e=>{if(a){let t=!1;const n=[],r=[];e.forEach(({error:e,result:o})=>{e&&(t=!0),n.push(e),r.push(o)}),o(t?n:null,r)}else{const t=e[0];o(t.error,t.result)}})}}this.time=e.time,this.storageTrieCache={},r.call(this,e),this.createVMFromStateTrie=function(){var e=r.prototype.createVMFromStateTrie.apply(this,arguments);return this.patchVM(e),e},this.web3=new l(this.fork),this._touchedKeys=[]}ForkedBlockchain.prototype.initialize=async function(e,t){try{const n=await new Promise((e,t)=>{this.web3.eth.net.getId((n,r)=>{n?this.options.network_id?e(this.options.network_id):(Error.captureStackTrace(n),n.message="The fork provider errored when checking net_version: "+n.message,t(n)):e(r)})});this.forkVersion=n;const o=this.forkBlock=await new Promise((e,t)=>{const n=this.forkBlockNumber||"latest";this.web3.eth.getBlock(n,(r,o)=>{r?(Error.captureStackTrace(r),r.message=`The fork provider errored when checking for block '${n}': ${r.message}`,t(r)):e(o)})});!this.time&&this.forkBlockNumber&&(this.time=this.options.time=new Date(1e3*h.number(o.timestamp)),this.setTime(this.time)),this.forkBlockNumber=this.options.fork_block_number=o.number,this.forkBlockHash=o.hash;(await Promise.all(e.map(e=>new Promise((t,n)=>{this.web3.eth.getTransactionCount(e.address,this.forkBlockNumber,(r,o)=>{r?(Error.captureStackTrace(r),r.message=`The fork provider errored when checking the nonce for account ${e.address}: ${r.message}`,n(r)):t(o)})})))).forEach((t,n)=>{e[n].account.nonce=t}),r.prototype.initialize.call(this,e,t)}catch(e){t(e)}},ForkedBlockchain.prototype.patchVM=function(e){const t=e.stateManager._trie,n=this.getLookupAccount(t);e.stateManager._cache._lookupAccount=n,e.stateManager._lookupStorageTrie=this.getLookupStorageTrie(t,n)},ForkedBlockchain.prototype.createStateTrie=function(e,t,n){return(n=Object.assign({fork:this.fork,forkBlockNumber:this.forkBlockNumber,blockchain:this},n)).forkBlockNumber>this.forkBlockNumber&&(n.forkBlockNumber=this.forkBlockNumber),new u(e,t,n)},ForkedBlockchain.prototype.createGenesisBlock=function(e){const t=this.forkBlock;this.createBlock((function(n,r){if(n)return e(n);r.header.number=t.number+1,r.header.parentHash=t.hash,e(null,r)}))},ForkedBlockchain.prototype.getLookupStorageTrie=function(e,t){return t=t||this.getLookupAccount(e),(n,r)=>{const o=e.copy();o.address=n,t(n,(e,t)=>{if(e)return r(e);o.root=t.stateRoot,r(null,o)})}},ForkedBlockchain.prototype.isFallbackBlock=function(e,t){var n=this;n.getEffectiveBlockNumber(e,(function(e,r){if(e)return t(e);t(null,r<=h.number(n.forkBlockNumber))}))},ForkedBlockchain.prototype.isBlockHash=function(e){return"string"==typeof e&&0===e.indexOf("0x")&&e.length>42||Buffer.isBuffer(e)&&e.byteLength>20},ForkedBlockchain.prototype.isFallbackBlockHash=function(e,t){if(!this.isBlockHash(e))return t(null,!1);Buffer.isBuffer(e)&&(e=h.hex(e)),this.data.blockHashes.get(e,(function(e,n){if(e)return e.notFound?t(null,!0):t(e);t(null,!1)}))},ForkedBlockchain.prototype.getFallbackBlock=function(e,t){var n=this;Buffer.isBuffer(e)&&(e=h.rpcDataHexString(e)),"string"==typeof e&&66!==e.length&&(e=h.number(e)),n.web3.eth.getBlock(e,!0,(function(e,r){if(e)return t(e);if(null==r)return t(new Error("Block not found"));var o=new i;o.header.parentHash=c.toBuffer(r.parentHash),o.header.uncleHash=c.toBuffer(r.sha3Uncles),o.header.coinbase=c.toBuffer(r.miner),o.header.stateRoot=c.toBuffer(r.stateRoot),o.header.transactionsTrie=c.toBuffer(r.transactionsRoot),o.header.receiptTrie=c.toBuffer(r.receiptsRoot),o.header.bloom=c.toBuffer(r.logsBloom),o.header.difficulty=c.toBuffer("0x"+r.totalDifficulty.toString(16)),o.header.number=c.toBuffer(r.number),o.header.gasLimit=c.toBuffer(r.gasLimit),o.header.gasUsed=c.toBuffer(r.gasUsed),o.header.timestamp=c.toBuffer(r.timestamp),o.header.extraData=c.toBuffer(r.extraData),(r.transactions||[]).forEach((function(e,t){o.transactions.push(p.fromJSON(e,p.types.real,null,n.forkVersion,n.options.hardfork))})),o.hash=function(){return c.toBuffer(r.hash)},t(null,o)}))},ForkedBlockchain.prototype.getBlock=function(e,t){let n;const o=this.isBlockHash(e);n=o?this.isFallbackBlockHash:this.isFallbackBlock,n.call(this,e,(n,i)=>{if(n)return t(n);if(i)return this.getFallbackBlock(e,t);const a=r.prototype.getBlock.bind(this);o?a(e,t):this.getRelativeBlockNumber(e,(e,n)=>{if(e)return t(e);a(n,t)})})},ForkedBlockchain.prototype.getStorage=function(e,t,n,r){var o=this;this.getEffectiveBlockNumber(n,(n,i)=>{if(n)return r(n);i>o.forkBlockNumber?o.getBlock(i,(function(n,i){if(n)return r(n);const a=o.stateTrie.root;o.stateTrie.root=i.header.stateRoot,o.getLookupStorageTrie(o.stateTrie)(e,(e,n)=>{if(e)return r(e);n.get(c.setLengthLeft(c.toBuffer(t),32),(function(e,t){if(n.root=a,null!=e)return r(e);r(null,t)}))})})):o.web3.eth.getStorageAt(h.rpcDataHexString(e),h.rpcDataHexString(t),i,(function(e,t){if(e)return r(e);t=c.rlp.encode(t),r(null,t)}))})},ForkedBlockchain.prototype.getCode=function(e,t,n){var o=this;"function"==typeof t&&(n=t,t="latest"),t||(t="latest"),this.getEffectiveBlockNumber(t,(function(i,a){if(i)return n(i);t=a,o.stateTrie.getTouchedAt(e,(i,a)=>{if(i)return n(i);void 0!==a&&a<=t?r.prototype.getCode.call(o,e,t,n):(t>h.number(o.forkBlockNumber)&&(t="latest"),o.fetchCodeFromFallback(e,t,(function(e,t){t&&(t=c.toBuffer(t)),n(e,t)})))})}))},ForkedBlockchain.prototype.getLookupAccount=function(e){return(t,n)=>{e.keyExists(t,(r,i)=>{if(r)return n(r);i?e.get(t,(e,t)=>{if(e)return n(e);const r=new o(t);n(null,r)}):this.fetchAccountFromFallback(t,h.number(e.forkBlockNumber),n)})}},ForkedBlockchain.prototype.getAccount=function(e,t,n){var o=this;"function"==typeof t&&(n=t,t="latest"),this.getEffectiveBlockNumber(t,(function(i,a){if(i)return n(i);t=a,o.stateTrie.keyExists(e,(function(i,a){if(i)return n(i);a&&t>h.number(o.forkBlockNumber)?r.prototype.getAccount.call(o,e,t,(function(e,t){if(e)return n(e);n(null,t)})):o.fetchAccountFromFallback(e,t,n)}))}))},ForkedBlockchain.prototype.getTransaction=function(e,t){var n=this;r.prototype.getTransaction.call(this,e,(function(r,o){return r?t(r):null!=o?t(null,o):void n.web3.eth.getTransaction(e,(function(e,r){if(e)return t(e);r&&(r=p.fromJSON(r,p.types.signed,null,n.forkVersion,n.options.hardfork)),t(null,r)}))}))},ForkedBlockchain.prototype.getTransactionReceipt=function(e,t){var n=this;r.prototype.getTransactionReceipt.call(this,e,(function(r,o){return r?t(r):o?t(null,o):void n.web3.eth.getTransactionReceipt(e,(function(r,o){return r?t(r):o?void f.parallel({tx:n.getTransaction.bind(n,e),block:n.getBlock.bind(n,o.blockNumber)},(function(e,n){if(e)return t(e);var r=o.logs.map((function(e){return e.block=n.block,new a(e)})),i=new s(n.tx,n.block,r,o.gasUsed,o.cumulativeGasUsed,o.contractAddress,o.status,h.hex(o.logsBloom));t(null,i)})):t()}))}))},ForkedBlockchain.prototype.fetchAccountFromFallback=function(e,t,n){var r=this;e=h.hex(e),f.parallel({code:this.fetchCodeFromFallback.bind(this,e,t),balance:this.fetchBalanceFromFallback.bind(this,e,t),nonce:this.fetchNonceFromFallback.bind(this,e,t)},(function(e,t){if(e)return n(e);var i=t.code,a=t.balance,s=t.nonce,u=new o({nonce:s,balance:a});u.setCode(r.stateTrie,c.toBuffer(i),(function(e){if(e)return n(e);n(null,u)}))}))},ForkedBlockchain.prototype.fetchCodeFromFallback=function(e,t,n){var r=this;e=h.hex(e),"function"==typeof t&&(n=t,t=this.forkBlockNumber),this.getSafeFallbackBlockNumber(t,(function(t,o){if(t)return n(t);r.web3.eth.getCode(e,o,(function(e,t){if(e)return n(e);t="0x"+c.toBuffer(t).toString("hex"),n(null,t)}))}))},ForkedBlockchain.prototype.fetchBalanceFromFallback=function(e,t,n){var r=this;e=h.hex(e),"function"==typeof t&&(n=t,t=this.forkBlockNumber),this.getSafeFallbackBlockNumber(t,(function(t,o){if(t)return n(t);r.web3.eth.getBalance(e,o,(function(e,t){if(e)return n(e);t="0x"+new m(t).toString(16),n(null,t)}))}))},ForkedBlockchain.prototype.fetchNonceFromFallback=function(e,t,n){var r=this;e=h.hex(e),"function"==typeof t&&(n=t,t=this.forkBlockNumber),this.getSafeFallbackBlockNumber(t,(function(t,o){if(t)return n(t);r.web3.eth.getTransactionCount(e,o,(function(e,t){if(e)return n(e);t="0x"+r.web3.utils.toBN(t).toString(16),n(null,t)}))}))},ForkedBlockchain.prototype.getHeight=function(e){this.latestBlock((function(t,n){if(t)return e(t);e(null,h.number(n.header.number))}))},ForkedBlockchain.prototype.getRelativeBlockNumber=function(e,t){var n=this;this.getEffectiveBlockNumber(e,(function(e,r){if(e)return t(e);t(null,r-h.number(n.forkBlockNumber)-1)}))},ForkedBlockchain.prototype.getSafeFallbackBlockNumber=function(e,t){var n=h.number(this.forkBlockNumber);if(null==e)return t(null,n);this.getEffectiveBlockNumber(e,(function(e,r){if(e)return t(e);r>n&&(r=n),t(null,r)}))},ForkedBlockchain.prototype.getBlockLogs=function(e,t){var n=this;this.getEffectiveBlockNumber(e,(function(o,i){if(o)return t(o);n.getRelativeBlockNumber(i,(function(o,i){if(o)return t(o);i<0?n.getBlock(e,(function(r,o){if(r)return t(r);n.web3.currentProvider.send({jsonrpc:"2.0",method:"eth_getLogs",params:[{fromBlock:h.hex(e),toBlock:h.hex(e)}],id:(new Date).getTime()},(function(e,n){if(e)return t(e);var r=n.result.map((function(e){return e.block=o,new a(e)}));t(null,r)}))})):r.prototype.getBlockLogs.call(n,i,t)}))}))},ForkedBlockchain.prototype.getQueuedNonce=function(e,t){var n=null,r=h.buffer(e);if(this.pending_transactions.forEach((function(e){if(e.from.equals(r)){var t=new m(e.nonce);(null===n||t.gt(n))&&(n=t)}})),null!=n)return t(null,n.iaddn(1).toArrayLike(Buffer));this.getLookupAccount(this.stateTrie)(r,(function(e,n){if(e)return t(e);t(null,0===n.nonce.length?Buffer.from([0]):n.nonce)}))},ForkedBlockchain.prototype.processCall=function(e,t,n){const o=this;this.getEffectiveBlockNumber(t,(function(i,a){if(i)return n(i);a>o.forkBlockNumber?r.prototype.processCall.call(o,e,t,n):o.web3.eth.call({from:h.rpcDataHexString(e.from),to:h.nullableRpcDataHexString(e.to),data:h.rpcDataHexString(e.data)},a,(function(e,t){if(e)return n(e);n(null,{execResult:{returnValue:t}})}))}))},ForkedBlockchain.prototype.processBlock=async function(e,t,n,o){this._touchedKeys=[],r.prototype.processBlock.call(this,e,t,n,o)},ForkedBlockchain.prototype.putBlock=function(e,t,n,o){const i=this,a=g(i.data.trie_db).sublevel("touched"),s="block-"+h.number(e.header.number);r.prototype.putBlock.call(i,e,t,n,(function(e,t){if(e)return o(e);a.put(s,JSON.stringify(i._touchedKeys),e=>{if(e)return o(e);o(null,t)})}))},ForkedBlockchain.prototype.popBlock=function(e){const t=this,n=g(this.data.trie_db).sublevel("touched");this.data.blocks.last((function(o,i){if(o)return e(o);if(null==i)return e(null,null);const a="block-"+h.number(i.header.number);n.get(a,(function(o,i){if(o)return e(o);const s=i?JSON.parse(i):[];f.eachSeries(s,(function(e,t){n.del(e,t)}),(function(o){if(o)return e(o);n.del(a,(function(n){if(n)return e(n);r.prototype.popBlock.call(t,e)}))}))}))}))},ForkedBlockchain.prototype.close=function(e){this.fork.disconnect&&this.fork.disconnect(),r.prototype.close.call(this,e)},e.exports=ForkedBlockchain},function(e,t,n){const r=n(7),o=n(26),i=n(75),a=n(76);var s=n(1),c=n(2).inherits,u=n(18),l=n(0);function ForkedStorageBaseTrie(e,t,n){i.call(this,e,t),this._touched=r(this.db).sublevel("touched"),this.options=n,this.address=n.address,this.forkBlockNumber=n.forkBlockNumber,this.blockchain=n.blockchain,this.fork=n.fork,this.web3=new u(this.fork),this.persist=void 0===n.persist||n.persist}c(ForkedStorageBaseTrie,i),ForkedStorageBaseTrie.prototype.get=function(e,t){var n=this;e=s.toBuffer(e),n.keyExists(e,(function(r,i){if(r)return t(r);n.getTouchedAt(e,(function(r,a){if(r)return t(r);i&&void 0!==a?o.prototype.get.call(n,e,(function(e,n){t(e,n)})):null==n.address?n.blockchain.fetchAccountFromFallback(e,n.forkBlockNumber,(function(e,n){if(e)return t(e);t(null,n.serialize())})):n.web3.eth.getStorageAt(l.rpcDataHexString(n.address),l.rpcDataHexString(e),n.forkBlockNumber,(function(e,n){if(e)return t(e);n=l.rpcQuantityBuffer(n),t(null,n)}))}))}))},ForkedStorageBaseTrie.prototype.keyExists=function(e,t){e=s.toBuffer(e),this.findPath(e,(e,n,r,o)=>{const i=n&&0===r.length;t(e,i)})},ForkedStorageBaseTrie.prototype.touch=function(e,t){if(!this.persist)return t();const n=this;let r=l.rpcDataHexString(e);this.address&&(r=`${l.rpcDataHexString(this.address)};${r}`),r=r.toLowerCase(),this._touched.get(r,(e,o)=>{if(e&&"NotFoundError"!==e.type)return t(e);void 0===o?this.blockchain.data.blocks.last((e,o)=>{if(e)return t(e);const i=null===o?n.forkBlockNumber:l.number(o.header.number);this._touched.put(r,i+1),this.blockchain._touchedKeys.push(r),t()}):t()})};const h=ForkedStorageBaseTrie.prototype.put;function ForkedStorageTrie(e,t,n){ForkedStorageBaseTrie.call(this,e,t,n),a.call(this,this)}ForkedStorageBaseTrie.prototype.put=function(e,t,n){const r=this;this.touch(e,(function(o){if(o)return n(o);h.call(r,e,t,n)}))},ForkedStorageBaseTrie.prototype.getTouchedAt=function(e,t){let n=l.rpcDataHexString(e);this.address&&(n=`${l.rpcDataHexString(this.address)};${n}`),n=n.toLowerCase(),this._touched.get(n,(function(e,n){if(e&&"NotFoundError"!==e.type)return t(e);t(null,n)}))},ForkedStorageBaseTrie.prototype.del=function(e,t){this.put(e,0,t)},ForkedStorageBaseTrie.prototype.copy=function(){return new ForkedStorageBaseTrie(this.db,this.root,this.options)},c(ForkedStorageTrie,ForkedStorageBaseTrie),ForkedStorageTrie.prove=o.prove,ForkedStorageTrie.verifyProof=o.verifyProof,e.exports=ForkedStorageTrie},function(e,t){e.exports=require("merkle-patricia-tree/baseTrie")},function(e,t){e.exports=require("merkle-patricia-tree/checkpoint-interface")},function(e){e.exports=JSON.parse('{"name":"web3","version":"1.2.11","description":"Ethereum JavaScript API","repository":"https://github.com/ethereum/web3.js","license":"LGPL-3.0","engines":{"node":">=8.0.0"},"main":"src/index.js","bugs":{"url":"https://github.com/ethereum/web3.js/issues"},"keywords":["Ethereum","JavaScript","API"],"author":"ethereum.org","types":"types/index.d.ts","scripts":{"dtslint":"dtslint --localTs ../../node_modules/typescript/lib types","postinstall":"node angular-patch.js"},"authors":[{"name":"Fabian Vogelsteller","email":"fabian@ethereum.org","homepage":"http://frozeman.de"},{"name":"Marek Kotewicz","email":"marek@parity.io","url":"https://github.com/debris"},{"name":"Marian Oancea","url":"https://github.com/cubedro"},{"name":"Gav Wood","email":"g@parity.io","homepage":"http://gavwood.com"},{"name":"Jeffery Wilcke","email":"jeffrey.wilcke@ethereum.org","url":"https://github.com/obscuren"}],"dependencies":{"web3-bzz":"1.2.11","web3-core":"1.2.11","web3-eth":"1.2.11","web3-eth-personal":"1.2.11","web3-net":"1.2.11","web3-shh":"1.2.11","web3-utils":"1.2.11"},"devDependencies":{"@types/node":"^12.12.6","dtslint":"^3.4.1","typescript":"^3.9.5"},"gitHead":"87e668275ac7d9b8af7c909137fc0626c3866929"}')},function(e,t,n){"use strict";var r=n(20),o=n(19),i=n(30),a=n(79).subscriptions,s=n(31),c=n(21),u=n(32),l=n(80),h=n(33),p=n(81),f=n(82),d=n(83),g=n(91),m=n(92),b=i.formatters,blockCall=function(e){return r.isString(e[0])&&0===e[0].indexOf("0x")?"eth_getBlockByHash":"eth_getBlockByNumber"},transactionFromBlockCall=function(e){return r.isString(e[0])&&0===e[0].indexOf("0x")?"eth_getTransactionByBlockHashAndIndex":"eth_getTransactionByBlockNumberAndIndex"},uncleCall=function(e){return r.isString(e[0])&&0===e[0].indexOf("0x")?"eth_getUncleByBlockHashAndIndex":"eth_getUncleByBlockNumberAndIndex"},getBlockTransactionCountCall=function(e){return r.isString(e[0])&&0===e[0].indexOf("0x")?"eth_getBlockTransactionCountByHash":"eth_getBlockTransactionCountByNumber"},uncleCountCall=function(e){return r.isString(e[0])&&0===e[0].indexOf("0x")?"eth_getUncleCountByBlockHash":"eth_getUncleCountByBlockNumber"},Eth=function(){var e=this;o.packageInit(this,arguments);var t=this.setRequestManager;this.setRequestManager=function(n){return t(n),e.net.setRequestManager(n),e.personal.setRequestManager(n),e.accounts.setRequestManager(n),e.Contract._requestManager=e._requestManager,e.Contract.currentProvider=e._provider,!0};var n=this.setProvider;this.setProvider=function(){n.apply(e,arguments),e.setRequestManager(e._requestManager),e.ens._detectedAddress=null,e.ens._lastSyncCheck=null};var i,k,y,v=!1,x=null,_="latest",w=50,B=24,S=750,T=100;Object.defineProperty(this,"handleRevert",{get:function(){return v},set:function(t){v=t,e.Contract.handleRevert=v,C.forEach((function(e){e.handleRevert=v}))},enumerable:!0}),Object.defineProperty(this,"defaultCommon",{get:function(){return y},set:function(t){y=t,e.Contract.defaultCommon=y,C.forEach((function(e){e.defaultCommon=y}))},enumerable:!0}),Object.defineProperty(this,"defaultHardfork",{get:function(){return k},set:function(t){k=t,e.Contract.defaultHardfork=k,C.forEach((function(e){e.defaultHardfork=k}))},enumerable:!0}),Object.defineProperty(this,"defaultChain",{get:function(){return i},set:function(t){i=t,e.Contract.defaultChain=i,C.forEach((function(e){e.defaultChain=i}))},enumerable:!0}),Object.defineProperty(this,"transactionPollingTimeout",{get:function(){return S},set:function(t){S=t,e.Contract.transactionPollingTimeout=S,C.forEach((function(e){e.transactionPollingTimeout=S}))},enumerable:!0}),Object.defineProperty(this,"transactionConfirmationBlocks",{get:function(){return B},set:function(t){B=t,e.Contract.transactionConfirmationBlocks=B,C.forEach((function(e){e.transactionConfirmationBlocks=B}))},enumerable:!0}),Object.defineProperty(this,"transactionBlockTimeout",{get:function(){return w},set:function(t){w=t,e.Contract.transactionBlockTimeout=w,C.forEach((function(e){e.transactionBlockTimeout=w}))},enumerable:!0}),Object.defineProperty(this,"defaultAccount",{get:function(){return x},set:function(t){return t&&(x=c.toChecksumAddress(b.inputAddressFormatter(t))),e.Contract.defaultAccount=x,e.personal.defaultAccount=x,C.forEach((function(e){e.defaultAccount=x})),t},enumerable:!0}),Object.defineProperty(this,"defaultBlock",{get:function(){return _},set:function(t){return _=t,e.Contract.defaultBlock=_,e.personal.defaultBlock=_,C.forEach((function(e){e.defaultBlock=_})),t},enumerable:!0}),Object.defineProperty(this,"maxListenersWarningThreshold",{get:function(){return T},set:function(t){e.currentProvider&&e.currentProvider.setMaxListeners&&(T=t,e.currentProvider.setMaxListeners(t))},enumerable:!0}),this.clearSubscriptions=e._requestManager.clearSubscriptions.bind(e._requestManager),this.net=new u(this),this.net.getNetworkType=m.bind(this),this.accounts=new d(this),this.personal=new h(this),this.personal.defaultAccount=this.defaultAccount,this.maxListenersWarningThreshold=T;var A=this,Contract=function(){p.apply(this,arguments);var e=this,t=A.setProvider;A.setProvider=function(){t.apply(A,arguments),o.packageInit(e,[A])}};Contract.setProvider=function(){p.setProvider.apply(this,arguments)},Contract.prototype=Object.create(p.prototype),Contract.prototype.constructor=Contract,this.Contract=Contract,this.Contract.defaultAccount=this.defaultAccount,this.Contract.defaultBlock=this.defaultBlock,this.Contract.transactionBlockTimeout=this.transactionBlockTimeout,this.Contract.transactionConfirmationBlocks=this.transactionConfirmationBlocks,this.Contract.transactionPollingTimeout=this.transactionPollingTimeout,this.Contract.handleRevert=this.handleRevert,this.Contract._requestManager=this._requestManager,this.Contract._ethAccounts=this.accounts,this.Contract.currentProvider=this._requestManager.provider,this.Iban=f,this.abi=g,this.ens=new l(this);var C=[new s({name:"getNodeInfo",call:"web3_clientVersion"}),new s({name:"getProtocolVersion",call:"eth_protocolVersion",params:0}),new s({name:"getCoinbase",call:"eth_coinbase",params:0}),new s({name:"isMining",call:"eth_mining",params:0}),new s({name:"getHashrate",call:"eth_hashrate",params:0,outputFormatter:c.hexToNumber}),new s({name:"isSyncing",call:"eth_syncing",params:0,outputFormatter:b.outputSyncingFormatter}),new s({name:"getGasPrice",call:"eth_gasPrice",params:0,outputFormatter:b.outputBigNumberFormatter}),new s({name:"getAccounts",call:"eth_accounts",params:0,outputFormatter:c.toChecksumAddress}),new s({name:"getBlockNumber",call:"eth_blockNumber",params:0,outputFormatter:c.hexToNumber}),new s({name:"getBalance",call:"eth_getBalance",params:2,inputFormatter:[b.inputAddressFormatter,b.inputDefaultBlockNumberFormatter],outputFormatter:b.outputBigNumberFormatter}),new s({name:"getStorageAt",call:"eth_getStorageAt",params:3,inputFormatter:[b.inputAddressFormatter,c.numberToHex,b.inputDefaultBlockNumberFormatter]}),new s({name:"getCode",call:"eth_getCode",params:2,inputFormatter:[b.inputAddressFormatter,b.inputDefaultBlockNumberFormatter]}),new s({name:"getBlock",call:blockCall,params:2,inputFormatter:[b.inputBlockNumberFormatter,function(e){return!!e}],outputFormatter:b.outputBlockFormatter}),new s({name:"getUncle",call:uncleCall,params:2,inputFormatter:[b.inputBlockNumberFormatter,c.numberToHex],outputFormatter:b.outputBlockFormatter}),new s({name:"getBlockTransactionCount",call:getBlockTransactionCountCall,params:1,inputFormatter:[b.inputBlockNumberFormatter],outputFormatter:c.hexToNumber}),new s({name:"getBlockUncleCount",call:uncleCountCall,params:1,inputFormatter:[b.inputBlockNumberFormatter],outputFormatter:c.hexToNumber}),new s({name:"getTransaction",call:"eth_getTransactionByHash",params:1,inputFormatter:[null],outputFormatter:b.outputTransactionFormatter}),new s({name:"getTransactionFromBlock",call:transactionFromBlockCall,params:2,inputFormatter:[b.inputBlockNumberFormatter,c.numberToHex],outputFormatter:b.outputTransactionFormatter}),new s({name:"getTransactionReceipt",call:"eth_getTransactionReceipt",params:1,inputFormatter:[null],outputFormatter:b.outputTransactionReceiptFormatter}),new s({name:"getTransactionCount",call:"eth_getTransactionCount",params:2,inputFormatter:[b.inputAddressFormatter,b.inputDefaultBlockNumberFormatter],outputFormatter:c.hexToNumber}),new s({name:"sendSignedTransaction",call:"eth_sendRawTransaction",params:1,inputFormatter:[null],abiCoder:g}),new s({name:"signTransaction",call:"eth_signTransaction",params:1,inputFormatter:[b.inputTransactionFormatter]}),new s({name:"sendTransaction",call:"eth_sendTransaction",params:1,inputFormatter:[b.inputTransactionFormatter],abiCoder:g}),new s({name:"sign",call:"eth_sign",params:2,inputFormatter:[b.inputSignFormatter,b.inputAddressFormatter],transformPayload:function(e){return e.params.reverse(),e}}),new s({name:"call",call:"eth_call",params:2,inputFormatter:[b.inputCallFormatter,b.inputDefaultBlockNumberFormatter],abiCoder:g}),new s({name:"estimateGas",call:"eth_estimateGas",params:1,inputFormatter:[b.inputCallFormatter],outputFormatter:c.hexToNumber}),new s({name:"submitWork",call:"eth_submitWork",params:3}),new s({name:"getWork",call:"eth_getWork",params:0}),new s({name:"getPastLogs",call:"eth_getLogs",params:1,inputFormatter:[b.inputLogFormatter],outputFormatter:b.outputLogFormatter}),new s({name:"getChainId",call:"eth_chainId",params:0,outputFormatter:c.hexToNumber}),new s({name:"requestAccounts",call:"eth_requestAccounts",params:0,outputFormatter:c.toChecksumAddress}),new s({name:"getProof",call:"eth_getProof",params:3,inputFormatter:[b.inputAddressFormatter,b.inputStorageKeysFormatter,b.inputDefaultBlockNumberFormatter],outputFormatter:b.outputProofFormatter}),new s({name:"getPendingTransactions",call:"eth_pendingTransactions",params:0,outputFormatter:b.outputTransactionFormatter}),new a({name:"subscribe",type:"eth",subscriptions:{newBlockHeaders:{subscriptionName:"newHeads",params:0,outputFormatter:b.outputBlockFormatter},pendingTransactions:{subscriptionName:"newPendingTransactions",params:0},logs:{params:1,inputFormatter:[b.inputLogFormatter],outputFormatter:b.outputLogFormatter,subscriptionHandler:function(e){e.removed?this.emit("changed",e):this.emit("data",e),r.isFunction(this.callback)&&this.callback(null,e,this)}},syncing:{params:0,outputFormatter:b.outputSyncingFormatter,subscriptionHandler:function(e){var t=this;!0!==this._isSyncing?(this._isSyncing=!0,this.emit("changed",t._isSyncing),r.isFunction(this.callback)&&this.callback(null,t._isSyncing,this),setTimeout((function(){t.emit("data",e),r.isFunction(t.callback)&&t.callback(null,e,t)}),0)):(this.emit("data",e),r.isFunction(t.callback)&&this.callback(null,e,this),clearTimeout(this._isSyncingTimeout),this._isSyncingTimeout=setTimeout((function(){e.currentBlock>e.highestBlock-200&&(t._isSyncing=!1,t.emit("changed",t._isSyncing),r.isFunction(t.callback)&&t.callback(null,t._isSyncing,t))}),500))}}}})];C.forEach((function(t){t.attachToObject(e),t.setRequestManager(e._requestManager,e.accounts),t.defaultBlock=e.defaultBlock,t.defaultAccount=e.defaultAccount,t.transactionBlockTimeout=e.transactionBlockTimeout,t.transactionConfirmationBlocks=e.transactionConfirmationBlocks,t.transactionPollingTimeout=e.transactionPollingTimeout,t.handleRevert=e.handleRevert}))};o.addProviders(Eth),e.exports=Eth},function(e,t){e.exports=require("web3-core-subscriptions")},function(e,t){e.exports=require("web3-eth-ens")},function(e,t){e.exports=require("web3-eth-contract")},function(e,t){e.exports=require("web3-eth-iban")},function(e,t,n){"use strict";var r=n(20),o=n(19),i=n(31),a=n(84),s=n(85),c=n(86),u=n(87),l="undefined"==typeof global?n(88):n(24),h=n(89),p=n(90),f=n(21),d=n(30),g=n(12).Transaction,m=n(4).default,isNot=function(e){return r.isUndefined(e)||r.isNull(e)},Accounts=function(){var e=this;o.packageInit(this,arguments),delete this.BatchRequest,delete this.extend;var t=[new i({name:"getNetworkId",call:"net_version",params:0,outputFormatter:parseInt}),new i({name:"getChainId",call:"eth_chainId",params:0,outputFormatter:f.hexToNumber}),new i({name:"getGasPrice",call:"eth_gasPrice",params:0}),new i({name:"getTransactionCount",call:"eth_getTransactionCount",params:2,inputFormatter:[function(e){if(f.isAddress(e))return e;throw new Error("Address "+e+' is not a valid address to get the "transactionCount".')},function(){return"latest"}]})];this._ethereumCall={},r.each(t,(function(t){t.attachToObject(e._ethereumCall),t.setRequestManager(e._requestManager)})),this.wallet=new Wallet(this)};function Wallet(e){this._accounts=e,this.length=0,this.defaultKeyName="web3js_wallet"}Accounts.prototype._addAccountFunctions=function(e){var t=this;return e.signTransaction=function(n,r){return t.signTransaction(n,e.privateKey,r)},e.sign=function(n){return t.sign(n,e.privateKey)},e.encrypt=function(n,r){return t.encrypt(e.privateKey,n,r)},e},Accounts.prototype.create=function(e){return this._addAccountFunctions(a.create(e||f.randomHex(32)))},Accounts.prototype.privateKeyToAccount=function(e,t){if(e.startsWith("0x")||(e="0x"+e),!t&&66!==e.length)throw new Error("Private key must be 32 bytes long");return this._addAccountFunctions(a.fromPrivate(e))},Accounts.prototype.signTransaction=function(e,t,n){var o=!1,i={},a=!(!e||!(e.chain&&e.hardfork||e.common));if(n=n||function(){},!e)return o=new Error("No transaction object given!"),n(o),Promise.reject(o);function signed(e){if(e.common&&e.chain&&e.hardfork&&(o=new Error("Please provide the ethereumjs-common object or the chain and hardfork property but not all together.")),(e.chain&&!e.hardfork||e.hardfork&&!e.chain)&&(o=new Error('When specifying chain and hardfork, both values must be defined. Received "chain": '+e.chain+', "hardfork": '+e.hardfork)),e.gas||e.gasLimit||(o=new Error('"gas" is missing')),(e.nonce<0||e.gas<0||e.gasPrice<0||e.chainId<0)&&(o=new Error("Gas, gasPrice, nonce or chainId is lower than 0")),o)return n(o),Promise.reject(o);try{var s=d.formatters.inputCallFormatter(r.clone(e));s.to=s.to||"0x",s.data=s.data||"0x",s.value=s.value||"0x",s.chainId=f.numberToHex(s.chainId),a?(s.common&&(i.common=m.forCustomChain(s.common.baseChain||"mainnet",{name:s.common.customChain.name||"custom-network",networkId:s.common.customChain.networkId,chainId:s.common.customChain.chainId},s.common.hardfork||"petersburg"),delete s.common),s.chain&&(i.chain=s.chain,delete s.chain),s.hardfork&&(i.hardfork=s.hardfork,delete s.hardfork)):(i.common=m.forCustomChain("mainnet",{name:"custom-network",networkId:s.networkId,chainId:s.chainId},"petersburg"),delete s.networkId),t.startsWith("0x")&&(t=t.substring(2));var c=new g(s,i);c.sign(Buffer.from(t,"hex"));var u=c.validate(!0);if(""!==u)throw new Error("Signer Error: "+u);var l="0x"+c.serialize().toString("hex"),h=f.keccak256(l),p={messageHash:"0x"+Buffer.from(c.hash(!1)).toString("hex"),v:"0x"+Buffer.from(c.v).toString("hex"),r:"0x"+Buffer.from(c.r).toString("hex"),s:"0x"+Buffer.from(c.s).toString("hex"),rawTransaction:l,transactionHash:h};return n(null,p),p}catch(e){return n(e),Promise.reject(e)}}return void 0!==e.nonce&&void 0!==e.chainId&&void 0!==e.gasPrice&&a?Promise.resolve(signed(e)):Promise.all([isNot(e.chainId)?this._ethereumCall.getChainId():e.chainId,isNot(e.gasPrice)?this._ethereumCall.getGasPrice():e.gasPrice,isNot(e.nonce)?this._ethereumCall.getTransactionCount(this.privateKeyToAccount(t).address):e.nonce,isNot(a)?this._ethereumCall.getNetworkId():1]).then((function(t){if(isNot(t[0])||isNot(t[1])||isNot(t[2])||isNot(t[3]))throw new Error('One of the values "chainId", "networkId", "gasPrice", or "nonce" couldn\'t be fetched: '+JSON.stringify(t));return signed(r.extend(e,{chainId:t[0],gasPrice:t[1],nonce:t[2],networkId:t[3]}))}))},Accounts.prototype.recoverTransaction=function(e){var t=c.decode(e),n=a.encodeSignature(t.slice(6,9)),r=u.toNumber(t[6]),o=r<35?[]:[u.fromNumber(r-35>>1),"0x","0x"],i=t.slice(0,6).concat(o),l=c.encode(i);return a.recover(s.keccak256(l),n)},Accounts.prototype.hashMessage=function(e){var t=f.isHexStrict(e)?e:f.utf8ToHex(e),n=f.hexToBytes(t),r=Buffer.from(n),o="Ethereum Signed Message:\n"+n.length,i=Buffer.from(o),a=Buffer.concat([i,r]);return s.keccak256s(a)},Accounts.prototype.sign=function(e,t){if(t.startsWith("0x")||(t="0x"+t),66!==t.length)throw new Error("Private key must be 32 bytes long");var n=this.hashMessage(e),r=a.sign(n,t),o=a.decodeSignature(r);return{message:e,messageHash:n,v:o[0],r:o[1],s:o[2],signature:r}},Accounts.prototype.recover=function(e,t,n){var o=[].slice.apply(arguments);return r.isObject(e)?this.recover(e.messageHash,a.encodeSignature([e.v,e.r,e.s]),!0):(n||(e=this.hashMessage(e)),o.length>=4?(n=o.slice(-1)[0],n=!!r.isBoolean(n)&&!!n,this.recover(e,a.encodeSignature(o.slice(1,4)),n)):a.recover(e,t))},Accounts.prototype.decrypt=function(e,t,n){if(!r.isString(t))throw new Error("No password given.");var o,i,a=r.isObject(e)?e:JSON.parse(n?e.toLowerCase():e);if(3!==a.version)throw new Error("Not a valid V3 wallet");if("scrypt"===a.crypto.kdf)i=a.crypto.kdfparams,o=h.syncScrypt(Buffer.from(t),Buffer.from(i.salt,"hex"),i.n,i.r,i.p,i.dklen);else{if("pbkdf2"!==a.crypto.kdf)throw new Error("Unsupported key derivation scheme");if("hmac-sha256"!==(i=a.crypto.kdfparams).prf)throw new Error("Unsupported parameters to PBKDF2");o=l.pbkdf2Sync(Buffer.from(t),Buffer.from(i.salt,"hex"),i.c,i.dklen,"sha256")}var s=Buffer.from(a.crypto.ciphertext,"hex");if(f.sha3(Buffer.from([...o.slice(16,32),...s])).replace("0x","")!==a.crypto.mac)throw new Error("Key derivation failed - possibly wrong password");var c=l.createDecipheriv(a.crypto.cipher,o.slice(0,16),Buffer.from(a.crypto.cipherparams.iv,"hex")),u="0x"+Buffer.from([...c.update(s),...c.final()]).toString("hex");return this.privateKeyToAccount(u,!0)},Accounts.prototype.encrypt=function(e,t,n){var r,o=this.privateKeyToAccount(e,!0),i=(n=n||{}).salt||l.randomBytes(32),a=n.iv||l.randomBytes(16),s=n.kdf||"scrypt",c={dklen:n.dklen||32,salt:i.toString("hex")};if("pbkdf2"===s)c.c=n.c||262144,c.prf="hmac-sha256",r=l.pbkdf2Sync(Buffer.from(t),Buffer.from(c.salt,"hex"),c.c,c.dklen,"sha256");else{if("scrypt"!==s)throw new Error("Unsupported kdf");c.n=n.n||8192,c.r=n.r||8,c.p=n.p||1,r=h.syncScrypt(Buffer.from(t),Buffer.from(c.salt,"hex"),c.n,c.r,c.p,c.dklen)}var u=l.createCipheriv(n.cipher||"aes-128-ctr",r.slice(0,16),a);if(!u)throw new Error("Unsupported cipher");var d=Buffer.from([...u.update(Buffer.from(o.privateKey.replace("0x",""),"hex")),...u.final()]),g=f.sha3(Buffer.from([...r.slice(16,32),...d])).replace("0x","");return{version:3,id:p.v4({random:n.uuid||l.randomBytes(16)}),address:o.address.toLowerCase().replace("0x",""),crypto:{ciphertext:d.toString("hex"),cipherparams:{iv:a.toString("hex")},cipher:n.cipher||"aes-128-ctr",kdf:s,kdfparams:c,mac:g.toString("hex")}}},Wallet.prototype._findSafeIndex=function(e){return e=e||0,r.has(this,e)?this._findSafeIndex(e+1):e},Wallet.prototype._currentIndexes=function(){return Object.keys(this).map((function(e){return parseInt(e)})).filter((function(e){return e<9e20}))},Wallet.prototype.create=function(e,t){for(var n=0;n<e;++n)this.add(this._accounts.create(t).privateKey);return this},Wallet.prototype.add=function(e){return r.isString(e)&&(e=this._accounts.privateKeyToAccount(e)),this[e.address]?this[e.address]:((e=this._accounts.privateKeyToAccount(e.privateKey)).index=this._findSafeIndex(),this[e.index]=e,this[e.address]=e,this[e.address.toLowerCase()]=e,this.length++,e)},Wallet.prototype.remove=function(e){var t=this[e];return!(!t||!t.address)&&(this[t.address].privateKey=null,delete this[t.address],this[t.address.toLowerCase()].privateKey=null,delete this[t.address.toLowerCase()],this[t.index].privateKey=null,delete this[t.index],this.length--,!0)},Wallet.prototype.clear=function(){var e=this;return this._currentIndexes().forEach((function(t){e.remove(t)})),this},Wallet.prototype.encrypt=function(e,t){var n=this;return this._currentIndexes().map((function(r){return n[r].encrypt(e,t)}))},Wallet.prototype.decrypt=function(e,t){var n=this;return e.forEach((function(e){var r=n._accounts.decrypt(e,t);if(!r)throw new Error("Couldn't decrypt accounts. Password wrong?");n.add(r)})),this},Wallet.prototype.save=function(e,t){return localStorage.setItem(t||this.defaultKeyName,JSON.stringify(this.encrypt(e))),!0},Wallet.prototype.load=function(e,t){var n=localStorage.getItem(t||this.defaultKeyName);if(n)try{n=JSON.parse(n)}catch(e){}return this.decrypt(n||[],e)},function(e){var t;try{t=window[e];var n="__storage_test__";return t.setItem(n,n),t.removeItem(n),!0}catch(e){return e&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}}("localStorage")||(delete Wallet.prototype.save,delete Wallet.prototype.load),e.exports=Accounts},function(e,t){e.exports=require("eth-lib/lib/account")},function(e,t){e.exports=require("eth-lib/lib/hash")},function(e,t){e.exports=require("eth-lib/lib/rlp")},function(e,t){e.exports=require("eth-lib/lib/bytes")},function(e,t){e.exports=require("crypto-browserify")},function(e,t){e.exports=require("scrypt-js")},function(e,t){e.exports=require("uuid")},function(e,t){e.exports=require("web3-eth-abi")},function(e,t,n){"use strict";var r=n(20);e.exports=function(e){var t,n=this;return this.net.getId().then((function(e){return t=e,n.getBlock(0)})).then((function(n){var o="private";return"0xd4e56740f876aef8c010b86a40d5f56745a118d0906a34e69aec8c0db1cb8fa3"===n.hash&&1===t&&(o="main"),"0cd786a2425d16f152c658316c423e6ce1181e15c3295826d7c9904cba9ce303"===n.hash&&2===t&&(o="morden"),"0x41941023680923e0fe4d74a34bdac8141f2540e3ae90623718e47d66d1ca4a2d"===n.hash&&3===t&&(o="ropsten"),"0x6341fd3daf94b748c72ced5a5b26028f2474f5f00d824504e4fa37a75767e177"===n.hash&&4===t&&(o="rinkeby"),"0xbf7e331f7f7c1dd2e05159666b3bf8bc7a8a3a9eb1d518969eab529dd9b88c1a"===n.hash&&5===t&&(o="goerli"),"0xa3c565fc15c7478862d50ccd6561e3c06b24cc509bf388941c25ea985ce32cb9"===n.hash&&42===t&&(o="kovan"),r.isFunction(e)&&e(null,o),o})).catch((function(t){if(!r.isFunction(e))throw t;e(t)}))}},function(e,t){e.exports=require("web3-shh")},function(e,t){e.exports=require("web3-bzz")},function(e,t){e.exports=require("lru-cache")},function(e,t){e.exports=require("eth-sig-util")},function(e,t){e.exports=require("rlp")},function(e,t){e.exports={randomBytes:function(e,t){for(var n=[],r=0;r<e;r++)n.push(255*t());return Buffer.from(n)},randomAlphaNumericString:function(e,t){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let r="";for(var o=0;o<e;o++)r+=n.charAt(Math.floor((t||Math.random)()*n.length));return r}}},function(e){e.exports=JSON.parse('{"name":"ganache-core","version":"2.13.2","main":"./index.js","types":"./typings/index.d.ts","engines":{"node":">=8.9.0"},"directories":{"lib":"./lib"},"scripts":{"_mocha":"mocha --check-leaks --recursive","nyc_mocha":"nyc npm run _mocha","_lint":"eslint --ignore-path .gitignore .","build":"webpack-cli --config ./webpack/node/core.webpack.config.js","build-web":"webpack-cli --config ./webpack/web-experimental/core.webpack.config.js","format":"prettier --write \\"{lib,perf,test}/**/*.js\\" && eslint --fix --ignore-path .gitignore .","prepare":"patch-package --exclude \'nothing\'","prepublishOnly":"npm run test && npm run build && npm run test-build && npm prune --production && mv npm-shrinkwrap.json npm-shrinkwrap.json.bak && npm shrinkwrap","postpublish":"rm npm-shrinkwrap.json && mv npm-shrinkwrap.json.bak npm-shrinkwrap.json && npm ci","test":"npm run _lint && npm run nyc_mocha ./test/local","test-smoke":"npm run _mocha ./test/smoke","test-build":"cross-env TEST_BUILD=node npm run _mocha","test-web-experimental":"cross-env TEST_BUILD=web-experimental npm run _mocha","coverage":"nyc report --reporter=text-lcov | coveralls"},"bundleDependencies":["keccak"],"dependencies":{"abstract-leveldown":"3.0.0","async":"2.6.2","bip39":"2.5.0","cachedown":"1.0.0","clone":"2.1.2","debug":"3.2.6","encoding-down":"5.0.4","eth-sig-util":"3.0.0","ethereumjs-abi":"0.6.8","ethereumjs-account":"3.0.0","ethereumjs-block":"2.2.2","ethereumjs-common":"1.5.0","ethereumjs-tx":"2.1.2","ethereumjs-util":"6.2.1","ethereumjs-vm":"4.2.0","ethereumjs-wallet":"0.6.5","heap":"0.2.6","keccak":"3.0.1","level-sublevel":"6.6.4","levelup":"3.1.1","lodash":"4.17.20","lru-cache":"5.1.1","merkle-patricia-tree":"3.0.0","patch-package":"6.2.2","seedrandom":"3.0.1","source-map-support":"0.5.12","tmp":"0.1.0","web3":"1.2.11","web3-provider-engine":"14.2.1","websocket":"1.0.32"},"devDependencies":{"@types/web3":"^1.0.19","assert-match":"^1.1.1","browserfs":"1.4.3","coveralls":"^3.0.9","cross-env":"6.0.3","eslint":"6.8.0","eslint-config-standard":"14.1.0","eslint-plugin-import":"2.20.0","eslint-plugin-node":"11.0.0","eslint-plugin-promise":"4.2.1","eslint-plugin-standard":"4.0.1","ethereumjs-wallet":"0.6.5","ethers":"4.0.48","husky":"4.0.10","js-scrypt":"0.2.0","lint-staged":"10.0.0","memdown":"5.1.0","mocha":"7.2.0","mocha-lcov-reporter":"^1.3.0","number-to-bn":"1.7.0","nyc":"^15.1.0","pify":"4.0.1","portfinder":"^1.0.25","prettier":"^1.19.1","request":"^2.88.0","semver":"7.1.1","solc":"0.6.1","temp":"0.9.1","terser-webpack-plugin":"2.3.8","web3":"1.2.11","webpack":"4.41.5","webpack-bundle-size-analyzer":"3.1.0","webpack-cli":"3.3.10"},"optionalDependencies":{"ethereumjs-wallet":"0.6.5","web3":"1.2.11"},"repository":{"type":"git","url":"https://github.com/trufflesuite/ganache-core"},"license":"MIT","husky":{"hooks":{"pre-commit":"lint-staged"}},"lint-staged":{"*.js":["prettier --write","eslint --fix --ignore-path .gitignore","git add"]},"eslintConfig":{"root":true,"env":{"node":true,"es6":true},"parserOptions":{"ecmaVersion":8,"sourceType":"module","ecmaFeatures":{"impliedStrict":true}},"extends":"standard","rules":{"brace-style":["error","1tbs",{"allowSingleLine":false}],"curly":["error","all"],"max-len":["error",120,{"ignoreRegExpLiterals":true}],"quotes":["error","double"],"semi":["error","always"],"space-before-function-paren":["error","never"],"wrap-iife":["error","outside"]}},"prettier":{"printWidth":120,"arrowParens":"always"}}')},function(e,t,n){const r=n(17);var o=n(35);function GanacheBlockTracker(e){if(e=e||{},r.apply(this),!e.blockchain)throw new Error("RpcBlockTracker - no blockchain specified.");if(!e.blockchain.on)throw new Error("RpcBlockTracker - blockchain is not an EventEmitter.");this._blockchain=e.blockchain,this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.getTrackingBlock=this.getTrackingBlock.bind(this),this.awaitCurrentBlock=this.awaitCurrentBlock.bind(this),this._setCurrentBlock=this._setCurrentBlock.bind(this)}GanacheBlockTracker.prototype=Object.create(r.prototype),GanacheBlockTracker.prototype.constructor=GanacheBlockTracker,GanacheBlockTracker.prototype.getTrackingBlock=function(){return this._currentBlock},GanacheBlockTracker.prototype.getCurrentBlock=function(){return this._currentBlock},GanacheBlockTracker.prototype.awaitCurrentBlock=function(){const e=this;return this._currentBlock?this._currentBlock:new Promise(e=>this.once("block",e)).then(()=>e._currentBlock)},GanacheBlockTracker.prototype.start=function(e={}){return this._blockchain.on("block",this._setCurrentBlock),Promise.resolve()},GanacheBlockTracker.prototype.stop=function(){this._isRunning=!1,this._blockchain.removeListener("block",this._setCurrentBlock)},GanacheBlockTracker.prototype._setCurrentBlock=function(e){const t=o.toJSON(e,!0);if(this._currentBlock&&this._currentBlock.hash===t.hash)return;const n=this._currentBlock;this._currentBlock=t,this.emit("latest",t),this.emit("sync",{block:t,oldBlock:n}),this.emit("block",t)},e.exports=GanacheBlockTracker},function(e,t,n){n(9);var r=n(22),o=n(102),i=n(104),a=n(8);e.exports={create:function(e){var t=(e=_applyDefaultOptions(e||{})).logger,n=new r(e),a=i(n,t);a.keepAliveTimeout=e.keepAliveTimeout;let s=0;const c={};a.on("connection",e=>{const t=s++;c[t]=e,e.on("close",()=>delete c[t])});var u=a.listen;a.listen=function(){var e=Array.prototype.slice.call(arguments),callback=function(){};if(e.length>0){var t=e[e.length-1];"function"==typeof t&&(callback=e.pop())}var intermediary=function(e){if(e)return callback(e);a.provider.manager.waitForInitialization(callback)};e.push(intermediary),u.apply(a,e)},a.provider=n,e.ws&&o(a,n,t);var l=a.close;return a.close=function(e){var t=Array.prototype.slice.call(arguments);l.apply(a,t),a.provider.close((function(t){if(t)return e(t);Object.keys(c).forEach(e=>{try{c[e].destroy()}catch(e){}})}))},a}};const s={logger:{log:function(){}},ws:!0,keepAliveTimeout:5e3};var _applyDefaultOptions=function(e){return a.merge({},s,e)}},function(e,t,n){var r=n(103),o=r.server;function ConnectionManager(e,t){const n=this;n.provider=e,n.logger=t,n.connectionsBySubscriptionId={},n.connections={},n.connectionCounter=0,n._updateSubscriptions=n._updateSubscriptions.bind(n),n.manageConnection=n.manageConnection.bind(n),n._logPayload=n._logPayload.bind(n),n._handleRequest=n._handleRequest.bind(n),e.on("data",(function(e,t){e||n._updateSubscriptions(t)}))}e.exports=function(e,t,n){var r=new ConnectionManager(t,n),i=new o({httpServer:e,autoAcceptConnections:!0});return i.on("connect",r.manageConnection),i},ConnectionManager.prototype.manageConnection=function(e){const t=this;e.id=++t.connectionCounter,t.connections[e.id]={connection:e,subscriptions:{}},e.on("message",(function(n){let o;try{if("utf8"===n.type)o=JSON.parse(n.utf8Data);else{if("binary"!==n.type)throw new Error("Invalid message type");o=JSON.parse(n.binaryData.toString("utf8").trim())}}catch(t){return void e.close(r.connection.CLOSE_REASON_UNPROCESSABLE_INPUT,t.message)}t._logPayload(o),t._handleRequest(e,o)})),e.on("close",(function(){Object.keys(t.connections[e.id].subscriptions).forEach(e=>{t.provider.send({jsonrpc:"2.0",method:"eth_unsubscribe",params:[e],id:(new Date).getTime()},(function(n,r){n||delete t.connectionsBySubscriptionId[e]}))}),delete t.connections[e.id]}))},ConnectionManager.prototype._handleRequest=function(e,t){const n=this;switch(t.method){case"eth_subscribe":n.provider.send(t,(function(t,r){!t&&r.result&&n.connections[e.id]&&(n.connections[e.id].subscriptions[r.result]=!0,n.connectionsBySubscriptionId[r.result]=n.connections[e.id]),e.send(JSON.stringify(r))}));break;case"eth_unsubscribe":n.provider.send(t,(function(r,o){r||o.error?e&&e.send&&e.send(JSON.stringify(o)):(n.connections[e.id]&&delete n.connections[e.id].subscriptions[t.params[0]],delete n.connectionsBySubscriptionId[t.params[0]],e.send(JSON.stringify(o)))}));break;default:n.provider.send(t,(function(t,n){e.send(JSON.stringify(n))}))}},ConnectionManager.prototype._logPayload=function(e){const t=this;if(e instanceof Array)for(var n=0;n<e.length;n++){var r=e[n];t.logger.log(r.method)}else t.logger.log(e.method)},ConnectionManager.prototype._updateSubscriptions=function(e){const t=this.connectionsBySubscriptionId[e.params.subscription];t&&t.connection.send(JSON.stringify(e))}},function(e,t){e.exports=require("websocket")},function(e,t,n){const r=n(105),{rpcError:o}=n(0),i=Object.prototype.hasOwnProperty;function sendResponse(e,t,n,r){e.writeHead(t,n),e.end(r)}e.exports=function(e,t){var n=r.createServer((function(n,r){var a=n.method,s=[];n.on("data",(function(e){s.push(e)})).on("end",(function(){s=Buffer.concat(s).toString();const c=function(e,t){const n={};return i.call(t,"origin")&&("OPTIONS"===e&&(n["Access-Control-Allow-Methods"]="POST",i.call(t,"access-control-request-headers")&&(n["Access-Control-Allow-Headers"]=t["access-control-request-headers"]),n["Content-Length"]=0,n["Access-Control-Max-Age"]=600),n["Access-Control-Allow-Credentials"]=!0,n["Access-Control-Allow-Origin"]=t.origin),n}(a,n.headers);switch(a){case"POST":var u;try{u=JSON.parse(s)}catch(e){return c["Content-Type"]="text/plain",void sendResponse(r,400,c,"400 Bad Request")}if(u instanceof Array)for(var l=0;l<u.length;l++){var h=u[l];t.log(h.method)}else t.log(u.method);if("eth_subscribe"===u.method||"eth_unsubscribe"===u.method){c["Content-Type"]="application/json",sendResponse(r,400,c,o(u.id,-32e3,"notifications not supported"));break}e.send(u,(function(e,t){c["Content-Type"]="application/json",sendResponse(r,200,c,JSON.stringify(t))}));break;case"OPTIONS":sendResponse(r,204,c);break;default:c["Content-Type"]="text/plain",sendResponse(r,400,c,"400 Bad Request")}}))}));return n.ganacheProvider=e,n}},function(e,t){e.exports=require("http")}])}));
//# sourceMappingURL=ganache.core.node.js.map