{"version":3,"file":"Popover.js","sourceRoot":"","sources":["../src/Popover.tsx"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA,+BAQe;AACf,iDAAgD;AAQhD,+BAAkD;AAClD,2CAA0C;AAKjC,2FALA,uBAAU,OAKA;AAJnB,uDAAsD;AAEtD,yDAAwD;AAA/C,sHAAA,iBAAiB,OAAA;AAC1B,mDAAkD;AAAzC,gHAAA,cAAc,OAAA;AAGvB,IAAM,eAAe,GAAG,kBAAU,CAChC,UACE,EAeC,EACD,WAAW;QAfT,MAAM,YAAA,EACN,QAAQ,cAAA,EACR,OAAO,aAAA,EACP,iBAA0D,EAA/C,iBAAiB,mBAAG,gBAAS,CAAC,iBAAiB,KAAA,EAC1D,aAA+B,EAA/B,KAAK,mBAAG,gBAAS,CAAC,aAAa,KAAA,EAC/B,eAAW,EAAX,OAAO,mBAAG,CAAC,KAAA,EACX,kBAAiB,EAAjB,UAAU,mBAAG,IAAI,KAAA,EACjB,qBAAoC,EAApC,aAAa,mBAAG,MAAM,CAAC,QAAQ,CAAC,IAAI,KAAA,EACpC,uBAA+B,EAA/B,eAAe,mBAAG,aAAa,KAAA,EAC/B,0BAAmD,EAAnD,kBAAkB,mBAAG,8BAA8B,KAAA,EACnD,cAAc,oBAAA,EACd,eAAe,qBAAA,EACf,qBAAiB,EAAjB,aAAa,mBAAG,CAAC,KAAA,EACjB,cAAc,oBAAA;IAIhB,IAAM,SAAS,GAAG,mCAAgB,CAAC,iBAAiB,CAAC,CAAC;IAEtD,kDAAkD;IAClD,IAAM,UAAU,GAAG,cAAM,CAAC,KAAK,CAAC,CAAC;IACjC,IAAM,aAAa,GAAG,cAAM,EAAiC,CAAC;IAC9D,IAAM,mBAAmB,GAAG,cAAM,EAAuD,CAAC;IAC1F,IAAM,cAAc,GAAG,cAAM,CAAC,UAAU,CAAC,CAAC;IAE1C,IAAM,QAAQ,GAAG,cAAM,EAA2B,CAAC;IAE7C,IAAA,KAAkC,gBAAQ,CAAe;QAC7D,KAAK,OAAA;QACL,UAAU,EAAE,CAAC;QACb,SAAS,EAAE,CAAC;QACZ,QAAQ,EAAE,SAAS,CAAC,CAAC,CAAC;QACtB,OAAO,SAAA;QACP,SAAS,EAAE,gBAAS,CAAC,iBAAiB;QACtC,WAAW,EAAE,gBAAS,CAAC,iBAAiB;QACxC,UAAU,EAAE,gBAAS,CAAC,iBAAiB;QACvC,YAAY,EAAE,gBAAS,CAAC,iBAAiB;QACzC,aAAa,eAAA;QACb,UAAU,EAAE,gBAAS,CAAC,iBAAiB;QACvC,aAAa,EAAE,KAAK;KACrB,CAAC,EAbK,YAAY,QAAA,EAAE,eAAe,QAalC,CAAC;IAEH,IAAM,iBAAiB,GAAG,mBAAW,CACnC,UAAC,YAA0B,IAAK,OAAA,eAAe,CAAC,YAAY,CAAC,EAA7B,CAA6B,EAC7D,EAAE,CACH,CAAC;IAEI,IAAA,KAA4C,uBAAU,CAAC;QAC3D,MAAM,QAAA;QACN,QAAQ,UAAA;QACR,kBAAkB,oBAAA;QAClB,aAAa,eAAA;QACb,eAAe,iBAAA;QACf,eAAe,iBAAA;QACf,SAAS,WAAA;QACT,KAAK,OAAA;QACL,OAAO,SAAA;QACP,aAAa,eAAA;QACb,UAAU,YAAA;QACV,iBAAiB,mBAAA;KAClB,CAAC,EAbM,eAAe,qBAAA,EAAE,UAAU,gBAAA,EAAE,QAAQ,cAa3C,CAAC;IAEH,uBAAe,CAAC;QACd,IAAI,YAAY,GAAG,IAAI,CAAC;QACxB,IAAM,aAAa,GAAG;;YACpB,IAAI,MAAM,IAAI,YAAY,EAAE;gBAC1B,IAAM,SAAS,GAAG,MAAA,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,OAAO,0CAAE,qBAAqB,EAAE,CAAC;gBAC7D,IAAM,WAAW,GAAG,MAAA,UAAU,aAAV,UAAU,uBAAV,UAAU,CAAE,OAAO,0CAAE,qBAAqB,EAAE,CAAC;gBACjE,IACE,SAAS,IAAI,IAAI;oBACjB,WAAW,IAAI,IAAI;oBACnB,CAAC,CAAC,oBAAa,CAAC,SAAS,EAAE;wBACzB,GAAG,EAAE,YAAY,CAAC,SAAS,CAAC,GAAG;wBAC/B,IAAI,EAAE,YAAY,CAAC,SAAS,CAAC,IAAI;wBACjC,KAAK,EAAE,YAAY,CAAC,SAAS,CAAC,KAAK;wBACnC,MAAM,EAAE,YAAY,CAAC,SAAS,CAAC,MAAM;wBACrC,MAAM,EAAE,YAAY,CAAC,SAAS,CAAC,GAAG,GAAG,YAAY,CAAC,SAAS,CAAC,MAAM;wBAClE,KAAK,EAAE,YAAY,CAAC,SAAS,CAAC,IAAI,GAAG,YAAY,CAAC,SAAS,CAAC,KAAK;qBAClE,CAAC;wBACA,WAAW,CAAC,KAAK,KAAK,YAAY,CAAC,WAAW,CAAC,KAAK;wBACpD,WAAW,CAAC,MAAM,KAAK,YAAY,CAAC,WAAW,CAAC,MAAM;wBACtD,YAAY,CAAC,OAAO,KAAK,OAAO;wBAChC,YAAY,CAAC,KAAK,KAAK,KAAK;wBAC5B,SAAS,KAAK,aAAa,CAAC,OAAO;wBACnC,eAAe,KAAK,mBAAmB,CAAC,OAAO;wBAC/C,UAAU,KAAK,cAAc,CAAC,OAAO,CAAC,EACxC;oBACA,eAAe,EAAE,CAAC;iBACnB;gBAED,0DAA0D;gBAC1D,IAAI,SAAS,KAAK,aAAa,CAAC,OAAO,EAAE;oBACvC,aAAa,CAAC,OAAO,GAAG,SAAS,CAAC;iBACnC;gBACD,IAAI,eAAe,KAAK,mBAAmB,CAAC,OAAO,EAAE;oBACnD,mBAAmB,CAAC,OAAO,GAAG,eAAe,CAAC;iBAC/C;gBACD,IAAI,UAAU,KAAK,cAAc,CAAC,OAAO,EAAE;oBACzC,cAAc,CAAC,OAAO,GAAG,UAAU,CAAC;iBACrC;gBAED,IAAI,YAAY,EAAE;oBAChB,MAAM,CAAC,qBAAqB,CAAC,aAAa,CAAC,CAAC;iBAC7C;aACF;YAED,UAAU,CAAC,OAAO,GAAG,MAAM,CAAC;QAC9B,CAAC,CAAC;QAEF,MAAM,CAAC,qBAAqB,CAAC,aAAa,CAAC,CAAC;QAE5C,OAAO;YACL,YAAY,GAAG,KAAK,CAAC;QACvB,CAAC,CAAC;IACJ,CAAC,EAAE;QACD,KAAK;QACL,eAAe;QACf,MAAM;QACN,OAAO;QACP,UAAU;QACV,YAAY,CAAC,KAAK;QAClB,YAAY,CAAC,SAAS,CAAC,MAAM;QAC7B,YAAY,CAAC,SAAS,CAAC,IAAI;QAC3B,YAAY,CAAC,SAAS,CAAC,GAAG;QAC1B,YAAY,CAAC,SAAS,CAAC,KAAK;QAC5B,YAAY,CAAC,OAAO;QACpB,YAAY,CAAC,WAAW,CAAC,MAAM;QAC/B,YAAY,CAAC,WAAW,CAAC,KAAK;QAC9B,eAAe;QACf,SAAS;QACT,UAAU;KACX,CAAC,CAAC;IAEH,iBAAS,CAAC;QACR,IAAM,cAAc,GAAG,UAAU,CAAC,OAAO,CAAC;QAE1C,MAAM,CAAC,MAAM,CAAC,cAAc,CAAC,KAAK,EAAE,cAAc,CAAC,CAAC;QAEpD,OAAO;YACL,MAAM,CAAC,IAAI,CAAC,cAAc,aAAd,cAAc,cAAd,cAAc,GAAI,EAAE,CAAC,CAAC,OAAO,CACvC,UAAC,GAAG;gBACF,OAAA,OAAO,cAAc,CAAC,KAAK,CACzB,GAAiE,CAClE;YAFD,CAEC,CACJ,CAAC;QACJ,CAAC,CAAC;IACJ,CAAC,EAAE,CAAC,cAAc,EAAE,MAAM,EAAE,UAAU,CAAC,CAAC,CAAC;IAEzC,IAAM,oBAAoB,GAAG,mBAAW,CACtC,UAAC,CAAa;;QACZ,IACE,MAAM;YACN,CAAC,CAAA,MAAA,UAAU,CAAC,OAAO,0CAAE,QAAQ,CAAC,CAAC,CAAC,MAAc,CAAC,CAAA;YAC/C,CAAC,CAAA,MAAA,QAAQ,CAAC,OAAO,0CAAE,QAAQ,CAAC,CAAC,CAAC,MAAc,CAAC,CAAA,EAC7C;YACA,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAG,CAAC,CAAC,CAAC;SACrB;IACH,CAAC,EACD,CAAC,MAAM,EAAE,cAAc,EAAE,UAAU,CAAC,CACrC,CAAC;IAEF,IAAM,kBAAkB,GAAG,mBAAW,CAAC;QACrC,IAAI,QAAQ,CAAC,OAAO,EAAE;YACpB,MAAM,CAAC,qBAAqB,CAAC,cAAM,OAAA,eAAe,EAAE,EAAjB,CAAiB,CAAC,CAAC;SACvD;IACH,CAAC,EAAE,CAAC,eAAe,CAAC,CAAC,CAAC;IAEtB,iBAAS,CAAC;QACR,MAAM,CAAC,gBAAgB,CAAC,OAAO,EAAE,oBAAoB,EAAE,IAAI,CAAC,CAAC;QAC7D,MAAM,CAAC,gBAAgB,CAAC,QAAQ,EAAE,kBAAkB,CAAC,CAAC;QACtD,OAAO;YACL,MAAM,CAAC,mBAAmB,CAAC,OAAO,EAAE,oBAAoB,EAAE,IAAI,CAAC,CAAC;YAChE,MAAM,CAAC,mBAAmB,CAAC,QAAQ,EAAE,kBAAkB,CAAC,CAAC;QAC3D,CAAC,CAAC;IACJ,CAAC,EAAE,CAAC,oBAAoB,EAAE,kBAAkB,CAAC,CAAC,CAAC;IAE/C,IAAM,SAAS,GAAG,mBAAW,CAC3B,UAAC,IAAiB;QAChB,QAAQ,CAAC,OAAO,GAAG,IAAI,CAAC;QACxB,IAAI,WAAW,IAAI,IAAI,EAAE;YACvB,IAAI,OAAO,WAAW,KAAK,QAAQ,EAAE;gBAClC,WAAmD,CAAC,OAAO,GAAG,IAAI,CAAC;aACrE;iBAAM,IAAI,OAAO,WAAW,KAAK,UAAU,EAAE;gBAC3C,WAA+C,CAAC,IAAI,CAAC,CAAC;aACxD;SACF;IACH,CAAC,EACD,CAAC,WAAW,CAAC,CACd,CAAC;IAEF,IAAM,WAAW,GAAG;QAClB,OAAA,oBAAY,CAAC,QAAuB,EAAE;YACpC,GAAG,EAAE,SAAS;SACf,CAAC;IAFF,CAEE,CAAC;IAEL,IAAM,aAAa,GAAG;QACpB,IAAI,CAAC,MAAM;YAAE,OAAO,IAAI,CAAC;QACzB,OAAO,CACL,kBAAC,6BAAa,aACZ,OAAO,EAAE,UAAU,CAAC,OAAO,EAC3B,YAAY,EAAE,QAAQ,CAAC,OAAO,EAC9B,SAAS,EAAE,aAAa,gBAEvB,OAAO,OAAO,KAAK,UAAU,CAAC,CAAC,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,OAAO,YAClD,CACjB,CAAC;IACJ,CAAC,CAAC;IAEF,OAAO,CACL,wDACG,WAAW,EAAE,EACb,aAAa,EAAE,YACf,CACJ,CAAC;AACJ,CAAC,CACF,CAAC;AAEW,QAAA,OAAO,GAAG,kBAAU,CAA4B,UAAC,KAAK,EAAE,GAAG;IACtE,IAAI,OAAO,MAAM,KAAK,WAAW;QAAE,OAAO,KAAK,CAAC,QAAQ,CAAC;IACzD,OAAO,kBAAC,eAAe,eAAK,KAAK,IAAE,GAAG,EAAE,GAAG,YAAI,CAAC;AAClD,CAAC,CAAC,CAAC","sourcesContent":["import {\n  useRef,\n  useLayoutEffect,\n  useState,\n  useCallback,\n  useEffect,\n  forwardRef,\n  cloneElement,\n} from 'react';\nimport { PopoverPortal } from './PopoverPortal';\nimport {\n  ContentLocation,\n  ContentLocationGetter,\n  PopoverPosition,\n  PopoverProps,\n  PopoverState,\n} from '.';\nimport { Constants, rectsAreEqual } from './util';\nimport { usePopover } from './usePopover';\nimport { useMemoizedArray } from './useMemoizedArray';\n\nexport { useArrowContainer } from './useArrowContainer';\nexport { ArrowContainer } from './ArrowContainer';\nexport { usePopover };\n\nconst PopoverInternal = forwardRef<HTMLElement, PopoverProps>(\n  (\n    {\n      isOpen,\n      children,\n      content,\n      positions: externalPositions = Constants.DEFAULT_POSITIONS,\n      align = Constants.DEFAULT_ALIGN,\n      padding = 0,\n      reposition = true,\n      parentElement = window.document.body,\n      boundaryElement = parentElement,\n      containerClassName = 'react-tiny-popover-container',\n      containerStyle,\n      contentLocation,\n      boundaryInset = 0,\n      onClickOutside,\n    },\n    externalRef,\n  ) => {\n    const positions = useMemoizedArray(externalPositions);\n\n    // TODO: factor prevs out into a custom prevs hook\n    const prevIsOpen = useRef(false);\n    const prevPositions = useRef<PopoverPosition[] | undefined>();\n    const prevContentLocation = useRef<ContentLocation | ContentLocationGetter | undefined>();\n    const prevReposition = useRef(reposition);\n\n    const childRef = useRef<HTMLElement | undefined>();\n\n    const [popoverState, setPopoverState] = useState<PopoverState>({\n      align,\n      nudgedLeft: 0,\n      nudgedTop: 0,\n      position: positions[0],\n      padding,\n      childRect: Constants.EMPTY_CLIENT_RECT,\n      popoverRect: Constants.EMPTY_CLIENT_RECT,\n      parentRect: Constants.EMPTY_CLIENT_RECT,\n      boundaryRect: Constants.EMPTY_CLIENT_RECT,\n      boundaryInset,\n      violations: Constants.EMPTY_CLIENT_RECT,\n      hasViolations: false,\n    });\n\n    const onPositionPopover = useCallback(\n      (popoverState: PopoverState) => setPopoverState(popoverState),\n      [],\n    );\n\n    const { positionPopover, popoverRef, scoutRef } = usePopover({\n      isOpen,\n      childRef,\n      containerClassName,\n      parentElement,\n      boundaryElement,\n      contentLocation,\n      positions,\n      align,\n      padding,\n      boundaryInset,\n      reposition,\n      onPositionPopover,\n    });\n\n    useLayoutEffect(() => {\n      let shouldUpdate = true;\n      const updatePopover = () => {\n        if (isOpen && shouldUpdate) {\n          const childRect = childRef?.current?.getBoundingClientRect();\n          const popoverRect = popoverRef?.current?.getBoundingClientRect();\n          if (\n            childRect != null &&\n            popoverRect != null &&\n            (!rectsAreEqual(childRect, {\n              top: popoverState.childRect.top,\n              left: popoverState.childRect.left,\n              width: popoverState.childRect.width,\n              height: popoverState.childRect.height,\n              bottom: popoverState.childRect.top + popoverState.childRect.height,\n              right: popoverState.childRect.left + popoverState.childRect.width,\n            }) ||\n              popoverRect.width !== popoverState.popoverRect.width ||\n              popoverRect.height !== popoverState.popoverRect.height ||\n              popoverState.padding !== padding ||\n              popoverState.align !== align ||\n              positions !== prevPositions.current ||\n              contentLocation !== prevContentLocation.current ||\n              reposition !== prevReposition.current)\n          ) {\n            positionPopover();\n          }\n\n          // TODO: factor prev checks out into the custom prevs hook\n          if (positions !== prevPositions.current) {\n            prevPositions.current = positions;\n          }\n          if (contentLocation !== prevContentLocation.current) {\n            prevContentLocation.current = contentLocation;\n          }\n          if (reposition !== prevReposition.current) {\n            prevReposition.current = reposition;\n          }\n\n          if (shouldUpdate) {\n            window.requestAnimationFrame(updatePopover);\n          }\n        }\n\n        prevIsOpen.current = isOpen;\n      };\n\n      window.requestAnimationFrame(updatePopover);\n\n      return () => {\n        shouldUpdate = false;\n      };\n    }, [\n      align,\n      contentLocation,\n      isOpen,\n      padding,\n      popoverRef,\n      popoverState.align,\n      popoverState.childRect.height,\n      popoverState.childRect.left,\n      popoverState.childRect.top,\n      popoverState.childRect.width,\n      popoverState.padding,\n      popoverState.popoverRect.height,\n      popoverState.popoverRect.width,\n      positionPopover,\n      positions,\n      reposition,\n    ]);\n\n    useEffect(() => {\n      const popoverElement = popoverRef.current;\n\n      Object.assign(popoverElement.style, containerStyle);\n\n      return () => {\n        Object.keys(containerStyle ?? {}).forEach(\n          (key) =>\n            delete popoverElement.style[\n              key as keyof Omit<typeof containerStyle, 'length' | 'parentRule'>\n            ],\n        );\n      };\n    }, [containerStyle, isOpen, popoverRef]);\n\n    const handleOnClickOutside = useCallback(\n      (e: MouseEvent) => {\n        if (\n          isOpen &&\n          !popoverRef.current?.contains(e.target as Node) &&\n          !childRef.current?.contains(e.target as Node)\n        ) {\n          onClickOutside?.(e);\n        }\n      },\n      [isOpen, onClickOutside, popoverRef],\n    );\n\n    const handleWindowResize = useCallback(() => {\n      if (childRef.current) {\n        window.requestAnimationFrame(() => positionPopover());\n      }\n    }, [positionPopover]);\n\n    useEffect(() => {\n      window.addEventListener('click', handleOnClickOutside, true);\n      window.addEventListener('resize', handleWindowResize);\n      return () => {\n        window.removeEventListener('click', handleOnClickOutside, true);\n        window.removeEventListener('resize', handleWindowResize);\n      };\n    }, [handleOnClickOutside, handleWindowResize]);\n\n    const handleRef = useCallback(\n      (node: HTMLElement) => {\n        childRef.current = node;\n        if (externalRef != null) {\n          if (typeof externalRef === 'object') {\n            (externalRef as React.MutableRefObject<HTMLElement>).current = node;\n          } else if (typeof externalRef === 'function') {\n            (externalRef as (instance: HTMLElement) => void)(node);\n          }\n        }\n      },\n      [externalRef],\n    );\n\n    const renderChild = () =>\n      cloneElement(children as JSX.Element, {\n        ref: handleRef,\n      });\n\n    const renderPopover = () => {\n      if (!isOpen) return null;\n      return (\n        <PopoverPortal\n          element={popoverRef.current}\n          scoutElement={scoutRef.current}\n          container={parentElement}\n        >\n          {typeof content === 'function' ? content(popoverState) : content}\n        </PopoverPortal>\n      );\n    };\n\n    return (\n      <>\n        {renderChild()}\n        {renderPopover()}\n      </>\n    );\n  },\n);\n\nexport const Popover = forwardRef<HTMLElement, PopoverProps>((props, ref) => {\n  if (typeof window === 'undefined') return props.children;\n  return <PopoverInternal {...props} ref={ref} />;\n});\n"]}